function CtoH(e) {
    for (var t = e.value, n = "", i = 0; i < t.length; i++) n += 12288 != t.charCodeAt(i) ? t.charCodeAt(i) > 65280 && t.charCodeAt(i) < 65375 ? String.fromCharCode(t.charCodeAt(i) - 65248) : String.fromCharCode(t.charCodeAt(i)) : String.fromCharCode(t.charCodeAt(i) - 12256);
    return e.value = n, n
}
function refreshAuth() {
    var e = "./verify.shtml?v=" + Math.random();
    $("#imgCode").attr("src", e), $("#code").val(""), $("#regBtn").removeClass("btn-active")
}
function makeParams() {
    var e = {};
    e.mobile = $("#telphone").val(), e.pwd = $("#password").val(), e.checkcode = $("#telCode").val();
    return e
}
$(function() {
    function e() {
        navigator.cookieEnabled || $(".notice").html("您的手机浏览器不支持或已经禁止使用cookie，无法正常登录，请开启或更换其他浏览器"), !location.search || -1 == location.search.indexOf("&inApp=1") && -1 == location.search.indexOf("?inApp=1") || $("#header").hide()
    }
    function t() {
        function e() {
            $(".txt-input").on("input", function() {
                $(this).siblings("i").show(), t() ? $("#regBtn").addClass("btn-active") : $("#regBtn").removeClass("btn-active")
            })
        }
        function t() {
            var e = !0;
            return $(".txt-input").each(function() {
                return $(this).val() ? void 0 : (e = !1, !1)
            }), e
        }
        function a(t) {
            var n = {
                mobile: t
            };
            if (_need_ck) {
                var i = $("#code").val();
                if (0 === i.length) return $(".notice").html("请输入图片验证码"), void $("#code").parent().addClass("input-error");
                $("#code").parent().removeClass("input-error"), n.authcode = i
            }
            var r = (new Date).getTime();
            $.ajax({
                url: "./register/verify/codeandphonenumber.shtml",
                type: "POST",
                data: n,
                dataType: "json",
                success: function(i) {
                    var a = (new Date).getTime() - r;
                    if (0 == i.code) $(".notice").html(""), l({
                        msg: "我们将发送短信验证码至<br />" + t,
                        btn: "确定",
                        unbind: 0
                    });
                    else switch (i.needauth ? ($("#input-code").show().find("input").addClass("txt-input"), refreshAuth(), e(), _need_ck = !0) : ($("#input-code").hide().find("input").removeClass("txt-input"), e(), _need_ck = !1), i.code) {
                        case '28':
                        case '29':
                            $(".notice").html(i.msg), $("#telphone").parent().addClass("input-error");
                            break;
                        case '22':
                            $(".notice").html(""), l({
                                msg: "<span>手机号" + t + "已绑定其它帐号，</span><br />继续注册将解除该手机与原帐号的绑定，并绑定新注册的账号",
                                btn: "继续注册",
                                unbind: 1
                            });
                            break;
                        case '257':
                            $(".notice").html(i.msg), $("#code").parent().addClass("input-error"), refreshAuth();
                            break;
                        default:
                            $(".notice").html(i.msg)
                    }
                },
                error: function() {
                    $(".notice").html("服务器开小差，请稍后重试");
                    var e = (new Date).getTime() - r;
                }
            })
        }
        function r(e) {
            var t = /^1[3-9][0-9]{9}$/;
            return t.test(e)
        }
        function o() {
            if ($(".input-container").removeClass("input-error"), !r($("#telphone").val())) return $(".notice").html("手机号格式错误"), void $("#telphone").parent().addClass("input-error");
            var e = makeParams();
            if (!s($("#password").val())) return $(".notice").html("请将密码位数设置为6-20位"), void $("#password").parent().addClass("input-error");
            $("#regBtn").addClass("btn-active-disable").html("注册中");
            var n = (new Date).getTime();
            $.ajax({
                url: "./register/do.shtml",
                type: "POST",
                data: e,
                dataType: "json",
                success: function(t) {
                    var i = (new Date).getTime() - n;
                    if (0 == t.code) $(".toast-mask").show(), setTimeout(function() {
                        location.href = t.succcb
                    }, 1500);
                    else switch ($("#regBtn").removeClass("btn-active-disable").html("注册"), t.code) {
                        case 49:
                        case 51:
                        case 29:
                        case 28:
                        case 22:
                            $(".notice").html(t.msg), $("#telphone").parent().addClass("input-error");
                            break;
                        case 52:
                        case 30:
                        case 25:
                            $(".notice").html(t.msg), $("#telCode").parent().addClass("input-error");
                            break;
                        case 41:
                            $(".notice").html(t.msg), $("#password").parent().addClass("input-error");
                            break;
                        case 105:
                            location.href = t.succcb;
                            break;
                        default:
                            $(".notice").html(t.msg)
                    }
                },
                error: function() {
                    $("#regBtn").removeClass("btn-active-disable").html("注册"), $(".notice").html("服务器开小差，请稍后重试");
                    var t = (new Date).getTime() - n;
                }
            })
        }
        function s(e) {
            return !(e.length < 6 || e.length > 20)
        }
        function c(e, t) {
            var a = (new Date).getTime(),
                r = t ? 524293 : 524291,
                o = "";
            try {
                o = getJdEid()
            } catch (s) {}
            $.ajax({
                url: "./sms/sendcode.shtml",
                type: "POST",
                data: {
                    mobile: e,
                    is_unbind: t
                },
                dataType: "json",
                success: function(t) {
                    var o = (new Date).getTime() - a;
                    0 == t.code ? (n = !1, d(), $("#input-code").hide().find("input").removeClass("txt-input"), i = !1, _need_ck = !1) : (_need_ck && refreshAuth(), $(".notice").html(t.msg))
                },
                error: function() {
                    _need_ck && refreshAuth(), $(".notice").html("服务器开小差，请稍后重试");
                    var t = (new Date).getTime() - a;
                }
            })
        }
        function d() {
            var e = 120;
            $(".mesg-code").addClass("mesg-disable").html("重新发送(" + e + "s)");
            var t = setInterval(function() {
                if (e--, $(".mesg-code").html("重新发送(" + e + "s)"), 0 === e) {
                    clearInterval(t);
                    var i = $("#telphone").val();
                    i ? r(i) ? ($("#telphone").parent().removeClass("input-error"), $(".notice").html(""), $(".mesg-code").html("获取短信验证码").removeClass("mesg-disable")) : ($("#telphone").parent().addClass("input-error"), $(".notice").html("手机号格式错误"), $(".mesg-code").html("获取短信验证码")) : $(".mesg-code").html("获取短信验证码"), n = !0
                }
            }, 1e3)
        }
        function l(e) {
            $(".pop-msg").html(e.msg), 1 === e.unbind ? ($(".btn-continue").attr("report-eventid", "MLoginRegister_UnbundlingContinue").attr("data-bind", e.unbind), $(".btn-cancel").attr("report-eventid", "MLoginRegister_UnbundlingCancel")) : ($(".btn-continue").attr("report-eventid", "MLoginRegister_RegisterConfirm").attr("data-bind", e.unbind), $(".btn-cancel").attr("report-eventid", "MLoginRegister_RegisterCancel")), $(".btn-continue").html(e.btn), $(".pop-dialog").show()
        }
        _need_ck && $("#code").addClass("txt-input"), $(".J_ping").click(function() {
            var e = "";
            $(this).attr("data-mesCode") ? (e = i ? $(this).attr("report-eventid") : $(this).attr("data-eventid")) : (e = $(this).attr("report-eventid"))
        }), $(".icon-goback").on("click", function() {
            window.history.back()
        }), $(".label-checkbox").on("click", function() {
            var e = $(this).find("input").prop("checked");
            e ? $(this).siblings("input").attr("type", "password") : $(this).siblings("input").attr("type", "text"), $(this).find("input").prop("checked", !e)
        }), $("#imgCode").on("click", function() {
            refreshAuth()
        }), $(".acc-input").on("focus", function() {
            $(this).siblings("i").show()
        }).on("blur", function() {
            var e = this;
            setTimeout(function() {
                $(e).siblings("i").hide()
            }, 200)
        }), $(".icon-clear").on("click", function() {
            $(this).siblings("input").val("").focus(), $(this).hide(), $("#telphone").val() || $(".mesg-code").addClass("mesg-disable"), t() || $("#regBtn").removeClass("btn-active")
        }), $("#telphone").on("input", function() {
            $(this).val() && n ? $(".mesg-code").removeClass("mesg-disable") : $(".mesg-code").addClass("mesg-disable")
        }), e(), $(".mesg-code").on("click", function() {
            if ($(this).hasClass("mesg-disable")) return !1;
            var e = $("#telphone").val();
            r(e) ? ($("#telphone").parent().removeClass("input-error"), $(".notice").html(""), n && a(e)) : ($("#telphone").parent().addClass("input-error"), $(".notice").html("手机号格式错误"))
        }), $("#regBtn").on("click", function() {
            $(this).hasClass("btn-active") && o()
        }), $(".btn-cancel").on("click", function() {
            $(this).parents(".pop-dialog").hide(), 0 == $(this).next().attr("data-bind") && refreshAuth(), n = !0
        }), $(".btn-continue").on("click", function() {
            var e = $("#telphone").val(),
                t = $(this).attr("data-bind");
            c(e, t), $(this).parents(".pop-dialog").hide()
        })
    }
    var n = !0,
        i = !0;
    e(), t()
});