<!-- jstree与jquery.jstree.js 有冲突 该页暂时不做pjax请求 研究结果：后期从jquery指定js方法入手 -->
#if($!session.getAttribute("HTTP_X_PJAX") == "true")
	#set($layout="/sys/menu.vm")
	$session.setAttribute("HTTP_X_PJAX","false")
#end
<!-- TableSorter -->
<div id="panel-tablesorter" class="panel panel-default">
	<input type="hidden" id="pageFlag" value="menu"/>
    <div class="panel-heading bg-white">
	<label>当前路径：</label>
	<span id="curPath"></span>
    </div><!-- /panel-heading -->
    <div class="panel-body">
		<form id="editModal" data-validate="form" class="modal fade" tabindex="-1">
        	<div class="modal-dialog">
        		<div class="modal-content">
        			<div class="modal-header">
        				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        				<h4 class="modal-title"><strong>菜单管理</strong></h4>
        			</div>
        			<div class="modal-body">
        				<div class="form-horizontal">
        					<input type="hidden" id="menuId"/>
                			<div class="form-group">
                				<label class="col-sm-3 control-label" for="name">名称：</label> 
                				<div class="col-sm-7">
                					<input class="form-control" type="text" id="menuName" maxlength="20" required />
                				</div>
                            </div>
                			<div class="form-group">
                				<label class="col-sm-3 control-label" for="name">链接：</label> 
                				<div class="col-sm-7">
                					<input class="form-control" type="text" id="menuHref" maxlength="100"/>
                				</div>
                            </div>
                			<div class="form-group">
                				<label class="col-sm-3 control-label" for="name">排序：</label> 
                				<div class="col-sm-7">
                					<input class="form-control" type="text" id="sort" number="true" />
                				</div>
                            </div>
                			<div class="form-group" style="display:none;">
                				<label class="col-sm-3 control-label" for="name">JSP：</label> 
                				<div class="col-sm-7">
                					<input class="form-control" type="text" id="jspName" maxlength="100"/>
                				</div>
                            </div>
                			<div class="form-group">
                				<label class="col-sm-3 control-label" for="name">样式：</label> 
                				<div class="col-sm-7">
                					<input class="form-control" type="text" id="jsSel" maxlength="200"/>
                				</div>
                            </div>
                			<div class="form-group">
                				<label class="col-sm-3 control-label" for="name">菜单：</label> 
                				<div class="col-sm-7">
									<select class="form-control" id="isMenu">
										<option value="1">是</option>
										<option value="0">否</option>
                                    </select>
                				</div>
                            </div>
        				</div>
        			</div>
        			<div class="modal-footer">
        				<button class="btn btn-cloud" data-dismiss="modal" >
        					 取消 <i class="fa fa-mail-reply"></i>
        				</button>
        				<button type="button" class="btn btn-success" id="btnOk">
							确定 <i class="fa fa-check"></i>
						</button>
        			</div>
        		</div>
        	</div>
        </form>
		<div id="demo1" class="form-horizontal">loading...</div>
		<div class="contextMenu" id="myMenu1" style="display: none;">
	     <ul>
	       <li id="addP">添加节点</li>
	       <li id="addC">添加子节点</li>
	       <li id="modify">修改</li>
	       <li id="delete">删除</li>
	     </ul>
	   </div>
	</div><!--/panel-body-->
</div><!--/panel-tablesorter-->
<link href="$request.getContextPath()/stilearn2.0/scripts/custom/themes/default/style.css" rel="stylesheet">
<script type="text/javascript">
globleUrl = projectRootPath + "/sys/menu/";
// 菜单树初始化
function initMenu(){
	$.getJSON(globleUrl+"init.shtml?random="+Math.random(),function(json){
		$("#demo1").jstree({ 
			"json_data" : $.parseJSON(json),
			"plugins" : [ "themes", "json_data","ui"]
		});
		$("#demo1").jstree("open_all"); // 默认打开所有节点
		$("#demo1 a").click(function(){
			var obj = $(this);
		    var name = obj.attr("menuName");
		    $("#curPath").html(findParend(obj));
		    var menuId = obj.attr("menuId");
		    var menuName = obj.attr("menuName");
		    var menuHref = obj.attr("menuHref");
		    var sort = obj.attr("sort");
		    var isMenu = obj.attr("isMenu");
		    var jspName = obj.attr("jspName");
		    var jsSel = obj.attr("jsSel");
		    $("#menuId").val(menuId);
		    $("#menuName").val(menuName);
		    $("#menuHref").val(menuHref);
		    $("#sort").val(sort);
		    $("#jspName").val(jspName);
		    $("#jsSel").val(jsSel);
		    $("#isMenu").val(isMenu);
		});
	});
	$('#demo1').contextMenu('myMenu1', {
          bindings: 
          {
            'addP': function() {
				$("#btnOk").attr("onclick","addP()");
				$("#editModal").modal("show");
            },
            'addC':function(){
            	var data = getData();
				if(!data.menuId){
					bootbox.alert("请选择父节点");
					return;
				}
				$("#btnOk").attr("onclick","addC()");
	            $("#editModal").modal("show");
            },
            'delete':function(){
            	var data = getData();
				if(!data.menuId){
					bootbox.alert("请选择节点");
					return;
				}
				remove();
            },
            'modify':function(){
            	var data = getData();
				if(!data.menuId){
					bootbox.alert("请选择节点");
					return;
				}
            	$("#btnOk").attr("onclick","modify()");
	            $("#editModal").modal("show");
            }
          }
    });
	function findParend(obj,name) {
		obj = $(obj);
		if(!name){
			name="";
		}
		var temp1 = obj.attr("menuName");
		if(temp1){
			name = temp1 + " / " + name;
			return findParend(obj.parent().parent().prev(),name);
		} else {
			if(name.indexOf("/")>=0){
				return name.substring(0,name.length-2);
			}
			return name;
		}
	}
}
// 取得菜单数据
function getData(){
	var menuId = $("#menuId").val();
	var menuName = $("#menuName").val();
	var menuHref = $("#menuHref").val();
	var sort = $("#sort").val();
	var jspName = $("#jspName").val();
	var jsSel = $("#jsSel").val();
	var isMenu = $("#isMenu").val();
	return {menuId:menuId,menuName:menuName,menuHref:menuHref,sort:sort,isMenu:isMenu,jspName:jspName,jsSel:jsSel}
}

// 增加父节点
function addP(){
	var data = getData();
	if($("#editModal").valid()){
		data.type = 0;
		$.post(globleUrl + "add.shtml",data,function(){
			initMenu();
			$("#editModal").modal("hide");
		});
	}
}

// 增加子节点
function addC(){
	var data = getData();
	if($("#editModal").valid()){
		data.type = 1;
		$.post(globleUrl + "add.shtml",data,function(){
			initMenu();
			$("#editModal").modal("hide");
		});
	}
}

// 删除节点
function remove(){
	bootbox.confirm("确定要删除吗？",function(sure){
		if(sure){
		var data = getData();
    		$.post(globleUrl + "remove.shtml",data,function(){
    			initMenu();
    			$("#editModal").modal("hide");
    		});
		}
	});
}

// 修改菜单
function modify(){
	var data = getData();
	$.post(globleUrl + "modify.shtml",data,function(){
		initMenu();
		$("#editModal").modal("hide");
	});	
}

// 压缩版的jquery.jstree.js和jquery.contextmenu.js，jquery.jstree.js有部分修改
(function(b){function a(a,l,k,q){var m=g[a];f=b("#"+m.id).find("ul:first").clone(!0);f.css(m.menuStyle).find("li").css(m.itemStyle).hover(function(){b(this).css(m.itemHoverStyle)},function(){b(this).css(m.itemStyle)}).find("img").css({verticalAlign:"middle",paddingRight:"2px"});d.html(f);m.onShowMenu&&(d=m.onShowMenu(k,d));b.each(m.bindings,function(a,g){b("#"+a,d).bind("click",function(a){c();g(l,h)})});d.css({left:k[m.eventPosX],top:k[m.eventPosY]}).show();m.shadow&&e.css({width:d.width(),height:d.height(),left:k.pageX+2,top:k.pageY+2}).show();b(document).one("click",c)}function c(){d.hide();e.hide()}var d,e,f,g,h,l={menuStyle:{listStyle:"none",padding:"1px",margin:"0px",backgroundColor:"#fff",border:"1px solid #999",width:"100px"},itemStyle:{margin:"0px",color:"#000",display:"block",cursor:"default",padding:"3px",border:"1px solid #fff",backgroundColor:"transparent"},itemHoverStyle:{border:"1px solid #0a246a",backgroundColor:"#b6bdd2"},eventPosX:"pageX",eventPosY:"pageY",shadow:!0,onContextMenu:null,onShowMenu:null};b.fn.contextMenu=function(c,h){d||(d=b('\x3cdiv id\x3d"jqContextMenu"\x3e\x3c/div\x3e').hide().css({position:"absolute",zIndex:"500"}).appendTo("body").bind("click",function(a){a.stopPropagation()}));e||(e=b("\x3cdiv\x3e\x3c/div\x3e").css({backgroundColor:"#000",position:"absolute",opacity:.2,zIndex:499}).appendTo("body").hide());g=g||[];g.push({id:c,menuStyle:b.extend({},l.menuStyle,h.menuStyle||{}),itemStyle:b.extend({},l.itemStyle,h.itemStyle||{}),itemHoverStyle:b.extend({},l.itemHoverStyle,h.itemHoverStyle||{}),bindings:h.bindings||{},shadow:h.shadow||!1===h.shadow?h.shadow:l.shadow,onContextMenu:h.onContextMenu||l.onContextMenu,onShowMenu:h.onShowMenu||l.onShowMenu,eventPosX:h.eventPosX||l.eventPosX,eventPosY:h.eventPosY||l.eventPosY});var f=g.length-1;b(this).bind("contextmenu",function(b){(g[f].onContextMenu?g[f].onContextMenu(b):1)&&a(f,this,b,h);return!1});return this};b.contextMenu={defaults:function(a){b.each(a,function(a,g){"object"==typeof g&&l[a]?b.extend(l[a],g):l[a]=g})}}})(jQuery);$(function(){$("div.contextMenu").hide()});"use strict";(function(b){b.vakata={};b.vakata.css={get_css:function(a,b,d){a=a.toLowerCase();var e=d.cssRules||d.rules,f=0;do{if(e.length&&f>e.length+5)break;if(e[f].selectorText&&e[f].selectorText.toLowerCase()==a)return!0===b?(d.removeRule&&d.removeRule(f),d.deleteRule&&d.deleteRule(f),!0):e[f]}while(e[++f]);return!1},add_css:function(a,c){if(b.jstree.css.get_css(a,!1,c))return!1;c.insertRule?c.insertRule(a+" { }",0):c.addRule(a,null,0);return b.vakata.css.get_css(a)},remove_css:function(a,c){return b.vakata.css.get_css(a,!0,c)},add_sheet:function(a){var b;if(a.str)return b=document.createElement("style"),b.setAttribute("type","text/css"),b.styleSheet?(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet.cssText=a.str):(b.appendChild(document.createTextNode(a.str)),document.getElementsByTagName("head")[0].appendChild(b)),b.sheet||b.styleSheet;if(a.url)if(document.createStyleSheet)try{document.createStyleSheet(a.url)}catch(d){}else return b=document.createElement("link"),b.rel="stylesheet",b.type="text/css",b.media="all",b.href=a.url,document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet}}})(jQuery);(function(b){var a=[],c=-1,d={},e={},f=!1;b.fn.jstree=function(g){var c="string"==typeof g,e=Array.prototype.slice.call(arguments,1),f=this;!c&&b.meta&&e.push(b.metadata.get(this).jstree);g=!c&&e.length?b.extend.apply(null,[!0,g].concat(e)):g;if(c&&"_"==g.substring(0,1))return f;c?this.each(function(){var c=a[b.data(this,"jstree-instance-id")],c=c&&b.isFunction(c[g])?c[g].apply(c,e):c;if("undefined"!==typeof c&&(g.indexOf(!1)||!0!==c&&!1!==c))return f=c,!1}):this.each(function(){var c=b.data(this,"jstree-instance-id"),h=!1;"undefined"!==typeof c&&a[c]&&a[c].destroy();c=parseInt(a.push({}),10)-1;b.data(this,"jstree-instance-id",c);g||(g={});g.plugins=b.isArray(g.plugins)?g.plugins:b.jstree.defaults.plugins;-1===b.inArray("core",g.plugins)&&g.plugins.unshift("core");h=b.extend(!0,{},b.jstree.defaults,g);h.plugins=g.plugins;b.each(d,function(a,g){-1===b.inArray(a,h.plugins)&&(h[a]=null,delete h[a])});a[c]=new b.jstree._instance(c,b(this).addClass("jstree jstree-"+c),h);b.each(a[c]._get_settings().plugins,function(b,g){a[c].data[g]={}});b.each(a[c]._get_settings().plugins,function(b,g){d[g]&&d[g].__init.apply(a[c])});a[c].init()});return f};b.jstree={defaults:{plugins:[]},_focused:function(){return a[c]||null},_reference:function(g){if(a[g])return a[g];var c=b(g);c.length||"string"!==typeof g||(c=b("#"+g));return c.length?a[c.closest(".jstree").data("jstree-instance-id")]||null:null},_instance:function(a,c,d){this.data={core:{}};this.get_settings=function(){return b.extend(!0,{},d)};this._get_settings=function(){return d};this.get_index=function(){return a};this.get_container=function(){return c};this._set_settings=function(a){d=b.extend(!0,{},d,a)}},_fn:{},plugin:function(a,c){c=b.extend({},{__init:b.noop,__destroy:b.noop,_fn:{},defaults:!1},c);d[a]=c;b.jstree.defaults[a]=c.defaults;b.each(c._fn,function(c,d){d.plugin=a;d.old=b.jstree._fn[c];b.jstree._fn[c]=function(){var a,g=d,h=Array.prototype.slice.call(arguments);a=new b.Event("before.jstree");var e=!1;do{if(g&&g.plugin&&-1!==b.inArray(g.plugin,this._get_settings().plugins))break;g=g.old}while(g);if(g&&(a=this.get_container().triggerHandler(a,{func:c,inst:this,args:h}),!1!==a))return"undefined"!==typeof a&&(h=a),a=0===c.indexOf("_")?g.apply(this,h):g.apply(b.extend({},this,{__callback:function(a){this.get_container().triggerHandler(c+".jstree",{inst:this,args:h,rslt:a,rlbk:e})},__rollback:function(){return e=this.get_rollback()},__call_old:function(a){return g.old.apply(this,a?Array.prototype.slice.call(arguments,1):h)}}),h)};b.jstree._fn[c].old=d.old;b.jstree._fn[c].plugin=a})},rollback:function(g){g&&(b.isArray(g)||(g=[g]),b.each(g,function(b,g){a[g.i].set_rollback(g.h,g.d)}))}};b.jstree._fn=b.jstree._instance.prototype={};b(function(){var a=navigator.userAgent.toLowerCase(),c=(a.match(/.+?(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],d=".jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } .jstree li { display:block; min-height:18px; line-height:18px; white-space:nowrap; margin-left:18px; } .jstree-rtl li { margin-left:0; margin-right:18px; } .jstree \x3e ul \x3e li { margin-left:0px; } .jstree-rtl \x3e ul \x3e li { margin-right:0px; } .jstree ins { display:inline-block; text-decoration:none; width:18px; height:18px; margin:0 0 0 0; padding:0; } .jstree a { display:inline-block; line-height:16px; height:16px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } .jstree a:focus { outline: none; } .jstree a \x3e ins { height:16px; width:16px; } .jstree a \x3e .jstree-icon { margin-right:3px; } .jstree-rtl a \x3e .jstree-icon { margin-left:3px; margin-right:0; } li.jstree-open \x3e ul { display:block; } li.jstree-closed \x3e ul { display:none; } ";/msie/.test(a)&&6==parseInt(c,10)&&(f=!0,d+=".jstree li { height:18px; margin-left:0; margin-right:0; } .jstree li li { margin-left:18px; } .jstree-rtl li li { margin-left:0px; margin-right:18px; } li.jstree-open ul { display:block; } li.jstree-closed ul { display:none !important; } .jstree li a { display:inline; border-width:0 !important; padding:0px 2px !important; } .jstree li a ins { height:16px; width:16px; margin-right:3px; } .jstree-rtl li a ins { margin-right:0px; margin-left:3px; } ");/msie/.test(a)&&7==parseInt(c,10)&&(d+=".jstree li a { border-width:0 !important; padding:0px 2px !important; } ");b.vakata.css.add_sheet({str:d})});b.jstree.plugin("core",{__init:function(){this.data.core.to_open=b.map(b.makeArray(this.get_settings().core.initially_open),function(a){return"#"+a.toString().replace(/^#/,"").replace("\\/","/").replace("/","\\/")})},defaults:{html_titles:!1,animation:500,initially_open:[],rtl:!1,strings:{loading:"Loading ...",new_node:"New node"}},_fn:{init:function(){this.set_focus();this._get_settings().core.rtl&&this.get_container().addClass("jstree-rtl").css("direction","rtl");this.get_container().html("\x3cul\x3e\x3cli class\x3d'jstree-last jstree-leaf'\x3e\x3cins\x3e\x26#160;\x3c/ins\x3e\x3ca class\x3d'jstree-loading' href\x3d'#'\x3e\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e"+this._get_settings().core.strings.loading+"\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e");this.data.core.li_height=this.get_container().find("ul li.jstree-closed, ul li.jstree-leaf").eq(0).height()||18;this.get_container().delegate("li \x3e ins","click.jstree",b.proxy(function(a){var c=b(a.target);c.is("ins")&&a.pageY-c.offset().top<this.data.core.li_height&&this.toggle_node(c)},this)).bind("mousedown.jstree",b.proxy(function(){this.set_focus()},this)).bind("dblclick.jstree",function(a){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(b){}}});this.__callback();this.load_node(-1,function(){this.loaded();this.reopen()})},destroy:function(){var g,h=this.get_index(),e=this._get_settings(),f=this;b.each(e.plugins,function(a,b){try{d[b].__destroy.apply(f)}catch(g){}});this.__callback();if(this.is_focused())for(g in a)if(a.hasOwnProperty(g)&&g!=h){a[g].set_focus();break}h===c&&(c=-1);this.get_container().unbind(".jstree").undelegate(".jstree").removeData("jstree-instance-id").find("[class^\x3d'jstree']").andSelf().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});a[h]=null;delete a[h]},save_opened:function(){var a=this;this.data.core.to_open=[];this.get_container().find(".jstree-open").each(function(){a.data.core.to_open.push("#"+this.id.toString().replace(/^#/,"").replace("\\/","/").replace("/","\\/"))});this.__callback(a.data.core.to_open)},reopen:function(a){var c=this,d=!0,e=[],f=[];a||(this.data.core.reopen=!1,this.data.core.refreshing=!0);this.data.core.to_open.length&&(b.each(this.data.core.to_open,function(a,g){if("#"==g)return!0;b(g).length&&b(g).is(".jstree-closed")?e.push(g):f.push(g)}),e.length&&(this.data.core.to_open=f,b.each(e,function(a,b){c.open_node(b,function(){c.reopen(!0)},!0)}),d=!1));d&&(this.data.core.reopen&&clearTimeout(this.data.core.reopen),this.data.core.reopen=setTimeout(function(){c.__callback({},c)},50),this.data.core.refreshing=!1)},refresh:function(a){var b=this;this.save_opened();a||(a=-1);(a=this._get_node(a))||(a=-1);-1!==a&&a.children("UL").remove();this.load_node(a,function(){b.__callback({obj:a});b.reopen()})},loaded:function(){this.__callback()},set_focus:function(){var a=b.jstree._focused();a&&a!==this&&a.get_container().removeClass("jstree-focused");a!==this&&(this.get_container().addClass("jstree-focused"),c=this.get_index());this.__callback()},is_focused:function(){return c==this.get_index()},_get_node:function(a){var c=b(a,this.get_container());if($obj.is(".jstree")||-1==a)return-1;c=c.closest("li",this.get_container());return c.length?c:!1},_get_next:function(a,b){a=this._get_node(a);return-1===a?this.get_container().find("\x3e ul \x3e li:first-child"):a.length?b?0<a.nextAll("li").size()?a.nextAll("li:eq(0)"):!1:a.hasClass("jstree-open")?a.find("li:eq(0)"):0<a.nextAll("li").size()?a.nextAll("li:eq(0)"):a.parentsUntil(".jstree","li").next("li").eq(0):!1},_get_prev:function(a,b){a=this._get_node(a);if(-1===a)return this.get_container().find("\x3e ul \x3e li:last-child");if(!a.length)return!1;if(b)return 0<a.prevAll("li").length?a.prevAll("li:eq(0)"):!1;if(a.prev("li").length){for(a=a.prev("li").eq(0);a.hasClass("jstree-open");)a=a.children("ul:eq(0)").children("li:last");return a}var c=a.parentsUntil(".jstree","li:eq(0)");return c.length?c:!1},_get_parent:function(a){a=this._get_node(a);if(-1==a||!a.length)return!1;a=a.parentsUntil(".jstree","li:eq(0)");return a.length?a:-1},_get_children:function(a){a=this._get_node(a);return-1===a?this.get_container().children("ul:eq(0)").children("li"):a.length?a.children("ul:eq(0)").children("li"):!1},get_path:function(a,b){var c=[],d=this;a=this._get_node(a);if(-1===a||!a||!a.length)return!1;a.parentsUntil(".jstree","li").each(function(){c.push(b?this.id:d.get_text(this))});c.reverse();c.push(b?a.attr("id"):this.get_text(a));return c},is_open:function(a){return(a=this._get_node(a))&&-1!==a&&a.hasClass("jstree-open")},is_closed:function(a){return(a=this._get_node(a))&&-1!==a&&a.hasClass("jstree-closed")},is_leaf:function(a){return(a=this._get_node(a))&&-1!==a&&a.hasClass("jstree-leaf")},open_node:function(a,b,c){a=this._get_node(a);if(!a.length)return!1;if(!a.hasClass("jstree-closed"))return b&&b.call(),!1;var d=c||f?0:this._get_settings().core.animation,e=this;this._is_loaded(a)?(d&&a.children("ul").css("display","none"),a.removeClass("jstree-closed").addClass("jstree-open").children("a").removeClass("jstree-loading"),d&&a.children("ul").stop(!0).slideDown(d,function(){this.style.display=""}),this.__callback({obj:a}),b&&b.call()):(a.children("a").addClass("jstree-loading"),this.load_node(a,function(){e.open_node(a,b,c)},b))},close_node:function(a,b){a=this._get_node(a);var c=b||f?0:this._get_settings().core.animation;if(!a.length||!a.hasClass("jstree-open"))return!1;c&&a.children("ul").attr("style","display:block !important");a.removeClass("jstree-open").addClass("jstree-closed");c&&a.children("ul").stop(!0).slideUp(c,function(){this.style.display=""});this.__callback({obj:a})},toggle_node:function(a){a=this._get_node(a);if(a.hasClass("jstree-closed"))return this.open_node(a);if(a.hasClass("jstree-open"))return this.close_node(a)},open_all:function(a,b){(a=a?this._get_node(a):this.get_container())&&-1!==a||(a=this.get_container());b?a=a.find("li.jstree-closed"):(b=a,a=a.is(".jstree-closed")?a.find("li.jstree-closed").andSelf():a.find("li.jstree-closed"));var c=this;a.each(function(){var a=this;c._is_loaded(this)?c.open_node(this,!1,!0):c.open_node(this,function(){c.open_all(a,b)},!0)});0===b.find("li.jstree-closed").length&&this.__callback({obj:b})},close_all:function(a){var b=this;(a=a?this._get_node(a):this.get_container())&&-1!==a||(a=this.get_container());a.find("li.jstree-open").andSelf().each(function(){b.close_node(this)});this.__callback({obj:a})},clean_node:function(a){a=a&&-1!=a?b(a):this.get_container();a=a.is("li")?a.find("li").andSelf():a.find("li");a.removeClass("jstree-last").filter("li:last-child").addClass("jstree-last").end().filter(":has(li)").not(".jstree-open").removeClass("jstree-leaf").addClass("jstree-closed");a.not(".jstree-open, .jstree-closed").addClass("jstree-leaf").children("ul").remove();this.__callback({obj:a})},get_rollback:function(){this.__callback();return{i:this.get_index(),h:this.get_container().children("ul").clone(!0),d:this.data}},set_rollback:function(a,b){this.get_container().empty().append(a);this.data=b;this.__callback()},load_node:function(a,b,c){this.__callback({obj:a})},_is_loaded:function(a){return!0},create_node:function(a,c,d,e,f){a=this._get_node(a);c="undefined"===typeof c?"last":c;var k=b("\x3cli\x3e"),q=this._get_settings().core,m;if(-1!==a&&!a.length)return!1;if(!f&&!this._is_loaded(a))return this.load_node(a,function(){this.create_node(a,c,d,e,!0)}),!1;this.__rollback();"string"===typeof d&&(d={data:d});d||(d={});d.attr&&k.attr(d.attr);d.state&&k.addClass("jstree-"+d.state);d.data||(d.data=q.strings.new_node);b.isArray(d.data)||(m=d.data,d.data=[],d.data.push(m));b.each(d.data,function(a,c){m=b("\x3ca\x3e");b.isFunction(c)&&(c=c.call(this,d));if("string"==typeof c)m.attr("href","#")[q.html_titles?"html":"text"](c);else c.attr||(c.attr={}),c.attr.href||(c.attr.href="#"),m.attr(c.attr)[q.html_titles?"html":"text"](c.title),c.language&&m.addClass(c.language);m.prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e");c.icon&&(-1===c.icon.indexOf("/")?m.children("ins").addClass(c.icon):m.children("ins").css("background","url('"+c.icon+"') center center no-repeat"));k.append(m)});k.prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e");-1===a&&(a=this.get_container(),"before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":a.before(k);m=this._get_parent(a);break;case "after":a.after(k);m=this._get_parent(a);break;case "inside":case "first":a.children("ul").length||a.append("\x3cul\x3e");a.children("ul").prepend(k);m=a;break;case "last":a.children("ul").length||a.append("\x3cul\x3e");a.children("ul").append(k);m=a;break;default:a.children("ul").length||a.append("\x3cul\x3e"),c||(c=0),m=a.children("ul").children("li").eq(c),m.length?m.before(k):a.children("ul").append(k),m=a}if(-1===m||m.get(0)===this.get_container().get(0))m=-1;this.clean_node(m);this.__callback({obj:k,parent:m});e&&e.call(this,k);return k},get_text:function(a){a=this._get_node(a);if(!a.length)return!1;var b=this._get_settings().core.html_titles;a=a.children("a:eq(0)");if(b)return a=a.clone(),a.children("INS").remove(),a.html();a=a.contents().filter(function(){return 3==this.nodeType})[0];return a.nodeValue},set_text:function(a,b){a=this._get_node(a);if(!a.length)return!1;a=a.children("a:eq(0)");if(this._get_settings().core.html_titles){var c=a.children("INS").clone();a.html(b).prepend(c);this.__callback({obj:a,name:b});return!0}a=a.contents().filter(function(){return 3==this.nodeType})[0];this.__callback({obj:a,name:b});return a.nodeValue=b},rename_node:function(a,b){a=this._get_node(a);this.__rollback();a&&a.length&&this.set_text.apply(this,Array.prototype.slice.call(arguments))&&this.__callback({obj:a,name:b})},delete_node:function(a){a=this._get_node(a);if(!a.length)return!1;this.__rollback();var b=this._get_parent(a),c=this._get_prev(a);a=a.remove();-1!==b&&0===b.find("\x3e ul \x3e li").length&&b.removeClass("jstree-open jstree-closed").addClass("jstree-leaf");this.clean_node(b);this.__callback({obj:a,prev:c});return a},prepare_move:function(a,c,d,f,p){var k={};k.ot=b.jstree._reference(k.o)||this;k.o=k.ot._get_node(a);k.r=-1===c?-1:this._get_node(c);k.p="undefined"===typeof k?"last":d;if(p||!e.o||e.o[0]!==k.o[0]||e.r[0]!==k.r[0]||e.p!==k.p){k.ot=b.jstree._reference(k.o)||this;k.rt=-1===c?k.ot:b.jstree._reference(k.r)||this;if(-1===k.r)switch(k.cr=-1,k.p){case "first":case "before":case "inside":k.cp=0;break;case "after":case "last":k.cp=k.rt.get_container().find(" \x3e ul \x3e li").length;break;default:k.cp=k.p}else{if(!/^(before|after)$/.test(k.p)&&!this._is_loaded(k.r))return this.load_node(k.r,function(){this.prepare_move(a,c,d,f,!0)});switch(k.p){case "before":k.cp=k.r.index();k.cr=k.rt._get_parent(k.r);break;case "after":k.cp=k.r.index()+1;k.cr=k.rt._get_parent(k.r);break;case "inside":case "first":k.cp=0;k.cr=k.r;break;case "last":k.cp=k.r.find(" \x3e ul \x3e li").length;k.cr=k.r;break;default:k.cp=k.p,k.cr=k.r}}k.np=-1==k.cr?k.rt.get_container():k.cr;k.op=k.ot._get_parent(k.o);k.or=k.np.find(" \x3e ul \x3e li:nth-child("+(k.cp+1)+")");e=k}this.__callback(e);f&&f.call(this,e)},check_move:function(){var a=e,b=!0;if(a.or[0]===a.o[0])return!1;a.o.each(function(){if(-1!==a.r.parentsUntil(".jstree").andSelf().filter("li").index(this))return b=!1});return b},move_node:function(a,c,d,f,p,k){if(!p)return this.prepare_move(a,c,d,function(a){this.move_node(a,!1,!1,f,!0,k)});if(!k&&!this.check_move())return!1;this.__rollback();c=!1;f?(c=a.o.clone(),c.find("*[id]").andSelf().each(function(){this.id&&(this.id="copy_"+this.id)})):c=a.o;a.or.length?a.or.before(c):(a.np.children("ul").length||b("\x3cul\x3e").appendTo(a.np),a.np.children("ul:eq(0)").append(c));try{a.ot.clean_node(a.op),a.rt.clean_node(a.np),a.op.find("\x3e ul \x3e li").length||a.op.removeClass("jstree-open jstree-closed").addClass("jstree-leaf").children("ul").remove()}catch(q){}f&&(e.cy=!0,e.oc=c);this.__callback(e);return e},_get_move:function(){return e}}})})(jQuery);(function(b){b.jstree.plugin("ui",{__init:function(){this.data.ui.selected=b();this.data.ui.last_selected=!1;this.data.ui.hovered=null;this.data.ui.to_select=this.get_settings().ui.initially_select;this.get_container().delegate("a","click.jstree",b.proxy(function(a){a.preventDefault();this.select_node(a.currentTarget,!0,a)},this)).delegate("a","mouseenter.jstree",b.proxy(function(a){this.hover_node(a.target)},this)).delegate("a","mouseleave.jstree",b.proxy(function(a){this.dehover_node(a.target)},this)).bind("reopen.jstree",b.proxy(function(){this.reselect()},this)).bind("get_rollback.jstree",b.proxy(function(){this.dehover_node();this.save_selected()},this)).bind("set_rollback.jstree",b.proxy(function(){this.reselect()},this)).bind("close_node.jstree",b.proxy(function(a,c){var d=this._get_settings().ui,e=this._get_node(c.rslt.obj),f=e&&e.length?e.children("ul").find(".jstree-clicked"):b(),g=this;!1!==d.selected_parent_close&&f.length&&f.each(function(){g.deselect_node(this);"select_parent"===d.selected_parent_close&&g.select_node(e)})},this)).bind("delete_node.jstree",b.proxy(function(a,b){var d=this._get_settings().ui.select_prev_on_delete,e=this._get_node(b.rslt.obj),e=e&&e.length?e.find(".jstree-clicked"):[],f=this;e.each(function(){f.deselect_node(this)});d&&e.length&&this.select_node(b.rslt.prev)},this)).bind("move_node.jstree",b.proxy(function(a,b){b.rslt.cy&&b.rslt.oc.find(".jstree-clicked").removeClass("jstree-clicked")},this))},defaults:{select_limit:-1,select_multiple_modifier:"ctrl",selected_parent_close:"select_parent",select_prev_on_delete:!0,disable_selecting_children:!1,initially_select:[]},_fn:{_get_node:function(a,c){if("undefined"===typeof a||null===a)return c?this.data.ui.selected:this.data.ui.last_selected;var d=b(a,this.get_container());if(d.is(".jstree")||-1==a)return-1;d=d.closest("li",this.get_container());return d.length?d:!1},save_selected:function(){var a=this;this.data.ui.to_select=[];this.data.ui.selected.each(function(){a.data.ui.to_select.push("#"+this.id.toString().replace(/^#/,"").replace("\\/","/").replace("/","\\/"))});this.__callback(this.data.ui.to_select)},reselect:function(){var a=this,c=this.data.ui.to_select,c=b.map(b.makeArray(c),function(a){return"#"+a.toString().replace(/^#/,"").replace("\\/","/").replace("/","\\/")});this.deselect_all();b.each(c,function(b,c){c&&"#"!==c&&a.select_node(c)});this.__callback()},refresh:function(a){this.save_selected();return this.__call_old()},hover_node:function(a){a=this._get_node(a);if(!a.length)return!1;a.hasClass("jstree-hovered")||this.dehover_node();this.data.ui.hovered=a.children("a").addClass("jstree-hovered").parent();this.__callback({obj:a})},dehover_node:function(){var a=this.data.ui.hovered,b;if(!a||!a.length)return!1;b=a.children("a").removeClass("jstree-hovered").parent();this.data.ui.hovered[0]===b[0]&&(this.data.ui.hovered=null);this.__callback({obj:a})},select_node:function(a,b,d){a=this._get_node(a);if(-1==a||!a||!a.length)return!1;var e=this._get_settings().ui;d="on"==e.select_multiple_modifier||!1!==e.select_multiple_modifier&&d&&d[e.select_multiple_modifier+"Key"];var f=this.is_selected(a),g=!0;if(b){if(e.disable_selecting_children&&d&&a.parents("li",this.get_container()).children(".jstree-clicked").length)return!1;g=!1;switch(!0){case f&&!d:this.deselect_all();f=!1;g=!0;break;case !f&&!d:if(-1==e.select_limit||0<e.select_limit)this.deselect_all(),g=!0;break;case f&&d:this.deselect_node(a);break;case !f&&d:if(-1==e.select_limit||this.data.ui.selected.length+1<=e.select_limit)g=!0}}g&&!f&&(a.children("a").addClass("jstree-clicked"),this.data.ui.selected=this.data.ui.selected.add(a),this.data.ui.last_selected=a,this.__callback({obj:a}))},deselect_node:function(a){a=this._get_node(a);if(!a.length)return!1;this.is_selected(a)&&(a.children("a").removeClass("jstree-clicked"),this.data.ui.selected=this.data.ui.selected.not(a),this.data.ui.last_selected.get(0)===a.get(0)&&(this.data.ui.last_selected=this.data.ui.selected.eq(0)),this.__callback({obj:a}))},toggle_select:function(a){a=this._get_node(a);if(!a.length)return!1;this.is_selected(a)?this.deselect_node(a):this.select_node(a)},is_selected:function(a){return 0<=this.data.ui.selected.index(this._get_node(a))},get_selected:function(a){return a?b(a).find(".jstree-clicked").parent():this.data.ui.selected},deselect_all:function(a){a?b(a).find(".jstree-clicked").removeClass("jstree-clicked"):this.get_container().find(".jstree-clicked").removeClass("jstree-clicked");this.data.ui.selected=b([]);this.data.ui.last_selected=!1;this.__callback()}}});b.jstree.defaults.plugins.push("ui")})(jQuery);(function(b){b.jstree.plugin("crrm",{__init:function(){this.get_container().bind("move_node.jstree",b.proxy(function(a,b){if(this._get_settings().crrm.move.open_onmove){var d=this;b.rslt.np.parentsUntil(".jstree").andSelf().filter(".jstree-closed").each(function(){d.open_node(this,!1,!0)})}},this))},defaults:{input_width_limit:200,move:{always_copy:!1,open_onmove:!0,default_position:"last",check_move:function(a){return!0}}},_fn:{_show_input:function(a,c){a=this._get_node(a);var d=this._get_settings().core.rtl,e=this._get_settings().crrm.input_width_limit,f=a.children("ins").width(),g=a.find("\x3e a:visible \x3e ins").width()*a.find("\x3e a:visible \x3e ins").length,h=this.get_text(a),l=b("\x3cdiv\x3e",{css:{position:"absolute",top:"-200px",left:d?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),n=a.css("position","relative").append(b("\x3cinput\x3e",{value:h,css:{padding:"0",border:"1px solid silver",position:"absolute",left:d?"auto":f+g+4+"px",right:d?f+g+4+"px":"auto",top:"0px",height:this.data.core.li_height-2+"px",lineHeight:this.data.core.li_height-2+"px",width:"150px"},blur:b.proxy(function(){var b=a.children("input"),d=b.val();""===d&&(d=h);b.remove();this.set_text(a,h);this.rename_node(a,d);c.call(this,a,d,h);a.css("position","")},this),keyup:function(a){a=a.keyCode||a.which;27==a?(this.value=h,this.blur()):13==a?this.blur():n.width(Math.min(l.text("pW"+this.value).width(),e))}})).children("input");this.set_text(a,"");l.css({fontFamily:n.css("fontFamily")||"",fontSize:n.css("fontSize")||"",fontWeight:n.css("fontWeight")||"",fontStyle:n.css("fontStyle")||"",fontStretch:n.css("fontStretch")||"",fontVariant:n.css("fontVariant")||"",letterSpacing:n.css("letterSpacing")||"",wordSpacing:n.css("wordSpacing")||""});n.width(Math.min(l.text("pW"+n[0].value).width(),e))[0].select()},rename:function(a){a=this._get_node(a);this.__rollback();var b=this.__callback;this._show_input(a,function(a,e,f){b.call(this,{obj:a,new_name:e,old_name:f})})},create:function(a,c,d,e,f){var g=this;(a=this._get_node(a))||(a=-1);this.__rollback();return this.create_node(a,c,d,function(a){var c=this._get_parent(a),d=b(a).index();e&&e.call(this,a);c.length&&c.hasClass("jstree-closed")&&this.open_node(c,!1,!0);f?g.__callback({obj:a,name:this.get_text(a),parent:c,position:d}):this._show_input(a,function(a,b,e){g.__callback({obj:a,name:b,parent:c,position:d})})})},remove:function(a){a=this._get_node(a,!0);this.__rollback();this.delete_node(a);this.__callback({obj:a})},check_move:function(){return this.__call_old()&&this._get_settings().crrm.move.check_move.call(this,this._get_move())?!0:!1},move_node:function(a,b,d,e,f,g){var h=this._get_settings().crrm.move;if(!f)return d||(d=h.default_position),"inside"!==d||h.default_position.match(/^(before|after)$/)||(d=h.default_position),this.__call_old(!0,a,b,d,e,!1,g);if(!0===h.always_copy||"multitree"===h.always_copy&&a.rt.get_index()!==a.ot.get_index())e=!0;this.__call_old(!0,a,b,d,e,!0,g)},cut:function(a){a=this._get_node(a);this.data.crrm.cp_nodes=!1;this.data.crrm.ct_nodes=!1;if(!a||!a.length)return!1;this.data.crrm.ct_nodes=a},copy:function(a){a=this._get_node(a);this.data.crrm.cp_nodes=!1;this.data.crrm.ct_nodes=!1;if(!a||!a.length)return!1;this.data.crrm.cp_nodes=a},paste:function(a){a=this._get_node(a);if(!a||!a.length||!this.data.crrm.ct_nodes&&!this.data.crrm.cp_nodes)return!1;this.data.crrm.ct_nodes&&this.move_node(this.data.crrm.ct_nodes,a);this.data.crrm.cp_nodes&&this.move_node(this.data.crrm.cp_nodes,a,!1,!0);this.data.crrm.cp_nodes=!1;this.data.crrm.ct_nodes=!1}}});b.jstree.defaults.plugins.push("crrm")})(jQuery);(function(b){var a=[];b.jstree._themes=!1;b.jstree.plugin("themes",{__init:function(){this.get_container().bind("init.jstree",b.proxy(function(){var a=this._get_settings().themes;this.data.themes.dots=a.dots;this.data.themes.icons=a.icons;this.set_theme(a.theme,a.url)},this)).bind("loaded.jstree",b.proxy(function(){this.data.themes.dots?this.show_dots():this.hide_dots();this.data.themes.icons?this.show_icons():this.hide_icons()},this))},defaults:{theme:"default",url:!1,dots:!0,icons:!0},_fn:{set_theme:function(c,d){if(!c)return!1;d||(d="$request.getContextPath()/stilearn2.0/scripts/custom/themes/default/style.css");-1==b.inArray(d,a)&&a.push(d);this.data.themes.theme!=c&&(this.get_container().removeClass("jstree-"+this.data.themes.theme),this.data.themes.theme=c);this.get_container().addClass("jstree-"+c);this.data.themes.dots?this.show_dots():this.hide_dots();this.data.themes.icons?this.show_icons():this.hide_icons();this.__callback()},get_theme:function(){return this.data.themes.theme},show_dots:function(){this.data.themes.dots=!0;this.get_container().children("ul").removeClass("jstree-no-dots")},hide_dots:function(){this.data.themes.dots=!1;this.get_container().children("ul").addClass("jstree-no-dots")},toggle_dots:function(){this.data.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this.data.themes.icons=!0;this.get_container().children("ul").removeClass("jstree-no-icons")},hide_icons:function(){this.data.themes.icons=!1;this.get_container().children("ul").addClass("jstree-no-icons")},toggle_icons:function(){this.data.themes.icons?this.hide_icons():this.show_icons()}}});b(function(){!1===b.jstree._themes&&b("script").each(function(){if(this.src.toString().match(/jquery\.jstree[^\/]*?\.js(\?.*)?$/))return b.jstree._themes=this.src.toString().replace(/jquery\.jstree[^\/]*?\.js(\?.*)?$/,"")+"themes/",!1});!1===b.jstree._themes&&(b.jstree._themes="themes/")});b.jstree.defaults.plugins.push("themes")})(jQuery);(function(b){var a=[];b.jstree.plugin("hotkeys",{__init:function(){if("undefined"===typeof b.hotkeys)throw"jsTree hotkeys: jQuery hotkeys plugin not included.";if(!this.data.ui)throw"jsTree hotkeys: jsTree UI plugin not included.";b.each(this._get_settings().hotkeys,function(c,d){-1==b.inArray(c,a)&&(b(document).bind("keydown",c,function(a){a:{var d=b.jstree._focused(),g;if(d&&d.data&&d.data.hotkeys&&d.data.hotkeys.enabled&&(g=d._get_settings().hotkeys[c])){a=g.call(d,a);break a}a=void 0}return a}),a.push(c))});this.enable_hotkeys()},defaults:{up:function(){this.hover_node(this._get_prev(this.data.ui.hovered||this.data.ui.last_selected||-1));return!1},down:function(){this.hover_node(this._get_next(this.data.ui.hovered||this.data.ui.last_selected||-1));return!1},left:function(){var a=this.data.ui.hovered||this.data.ui.last_selected;a&&(a.hasClass("jstree-open")?this.close_node(a):this.hover_node(this._get_prev(a)));return!1},right:function(){var a=this.data.ui.hovered||this.data.ui.last_selected;a&&a.length&&(a.hasClass("jstree-closed")?this.open_node(a):this.hover_node(this._get_next(a)));return!1},space:function(){this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").click();return!1},"ctrl+space":function(a){a.type="click";this.data.ui.hovered&&this.data.ui.hovered.children("a:eq(0)").trigger(a);return!1},f2:function(){this.rename(this.data.ui.hovered||this.data.ui.last_selected)},del:function(){this.remove(this.data.ui.hovered||this._get_node(null))}},_fn:{enable_hotkeys:function(){this.data.hotkeys.enabled=!0},disable_hotkeys:function(){this.data.hotkeys.enabled=!1}}})})(jQuery);(function(b){b.jstree.plugin("json_data",{defaults:{data:!1,ajax:!1,correct_state:!0,progressive_render:!1},_fn:{load_node:function(a,b,d){var e=this;this.load_node_json(a,function(){e.__callback({obj:a});b.call(this)},d)},_is_loaded:function(a){var c=this._get_settings().json_data;if((a=this._get_node(a))&&-1!==a&&c.progressive_render&&!a.is(".jstree-open, .jstree-leaf")&&0===a.children("ul").children("li").length&&a.data("jstree-children")){if(c=this._parse_json(a.data("jstree-children")))a.append(c),b.removeData(a,"jstree-children");this.clean_node(a);return!0}return-1==a||!a||!c.ajax||a.is(".jstree-open, .jstree-leaf")||0<a.children("ul").children("li").size()},load_node_json:function(a,c,d){var e=this.get_settings().json_data,f,g=function(){};f=function(){};if((a=this._get_node(a))&&-1!==a){if(a.data("jstree-is-loading"))return;a.data("jstree-is-loading",!0)}switch(!0){case !e.data&&!e.ajax:throw"Neither data nor ajax settings supplied.";case !!e.data&&!e.ajax||!!e.data&&!!e.ajax&&(!a||-1===a):a&&-1!=a||((f=this._parse_json(e.data))?(this.get_container().children("ul").empty().append(f.children()),this.clean_node()):e.correct_state&&this.get_container().children("ul").empty());c&&c.call(this);break;case !e.data&&!!e.ajax||!!e.data&&!!e.ajax&&a&&-1!==a:g=function(b,c,f){var g=this.get_settings().json_data.ajax.error;g&&g.call(this,b,c,f);-1!=a&&a.length?(a.children(".jstree-loading").removeClass("jstree-loading"),a.data("jstree-is-loading",!1),"success"===c&&e.correct_state&&a.removeClass("jstree-open jstree-closed").addClass("jstree-leaf")):"success"===c&&e.correct_state&&this.get_container().children("ul").empty();d&&d.call(this)},f=function(d,f,n){var p=this.get_settings().json_data.ajax.success;p&&(d=p.call(this,d,f,n)||d);if(""===d||!b.isArray(d)&&!b.isPlainObject(d))return g.call(this,n,f,"");(d=this._parse_json(d))?(-1!==a&&a?(a.append(d).children(".jstree-loading").removeClass("jstree-loading"),a.data("jstree-is-loading",!1)):this.get_container().children("ul").empty().append(d.children()),this.clean_node(a),c&&c.call(this)):-1!==a&&a?(a.children(".jstree-loading").removeClass("jstree-loading"),a.data("jstree-is-loading",!1),e.correct_state&&(a.removeClass("jstree-open jstree-closed").addClass("jstree-leaf"),c&&c.call(this))):e.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this))},e.ajax.context=this,e.ajax.error=g,e.ajax.success=f,e.ajax.dataType||(e.ajax.dataType="json"),b.isFunction(e.ajax.url)&&(e.ajax.url=e.ajax.url.call(this,a)),b.isFunction(e.ajax.data)&&(e.ajax.data=e.ajax.data.call(this,a)),b.ajax(e.ajax)}},_parse_json:function(a,c){var d=!1,e=this._get_settings(),f=e.json_data,g=e.core.html_titles,h;if(!a)return d;b.isFunction(a)&&(a=a.call(this));if(b.isArray(a)){d=b();if(!a.length)return!1;e=0;for(f=a.length;e<f;e++)h=this._parse_json(a[e],!0),h.length&&(d=d.add(h))}else{"string"==typeof a&&(a={data:a});if(!a.data&&""!==a.data)return d;d=b("\x3cli\x3e");a.attr&&d.attr(a.attr);a.metadata&&d.data("jstree",a.metadata);a.state&&d.addClass("jstree-"+a.state);b.isArray(a.data)||(h=a.data,a.data=[],a.data.push(h));b.each(a.data,function(c,e){h=b("\x3ca\x3e");b.isFunction(e)&&(e=e.call(this,a));if("string"==typeof e)h.attr("href","#")[g?"html":"text"](e);else e.attr||(e.attr={}),e.attr.href||(e.attr.href="#"),h.attr(e.attr)[g?"html":"text"](e.title),e.language&&h.addClass(e.language);h.prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e");!e.icon&&a.icon&&(e.icon=a.icon);e.icon&&(-1===e.icon.indexOf("/")?h.children("ins").addClass(e.icon):h.children("ins").css("background","url('"+e.icon+"') center center no-repeat"));d.append(h)});d.prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e");a.children&&(f.progressive_render&&"open"!==a.state?d.addClass("jstree-closed").data("jstree-children",a.children):(b.isFunction(a.children)&&(a.children=a.children.call(this,a)),b.isArray(a.children)&&a.children.length&&(h=this._parse_json(a.children,!0),h.length&&(e=b("\x3cul\x3e"),e.append(h),d.append(e)))))}c||(e=b("\x3cul\x3e"),e.append(d),d=e);return d},get_json:function(a,c,d,e){var f=[],g=this._get_settings(),h=this,l,n,p,k,q,m;(a=this._get_node(a))&&-1!==a||(a=this.get_container().find("\x3e ul \x3e li"));c=b.isArray(c)?c:["id","class"];!e&&this.data.types&&c.push(g.types.type_attr);d=b.isArray(d)?d:[];a.each(function(){p=b(this);l={data:[]};c.length&&(l.attr={});b.each(c,function(a,b){(n=p.attr(b))&&n.length&&n.replace(/jstree[^ ]*|$/ig,"").length&&(l.attr[b]=n.replace(/jstree[^ ]*|$/ig,""))});p.hasClass("jstree-open")&&(l.state="open");p.hasClass("jstree-closed")&&(l.state="closed");k=p.children("a");k.each(function(){q=b(this);d.length||-1!==b.inArray("languages",g.plugins)||q.children("ins").get(0).style.backgroundImage.length||q.children("ins").get(0).className&&q.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").length?(m=!1,-1!==b.inArray("languages",g.plugins)&&b.isArray(g.languages)&&g.languages.length&&b.each(g.languages,function(a,b){if(q.hasClass(b))return m=b,!1}),n={attr:{},title:h.get_text(q,m)},b.each(d,function(a,b){l.attr[b]=(q.attr(b)||"").replace(/jstree[^ ]*|$/ig,"")}),b.each(g.languages,function(a,b){if(q.hasClass(b))return n.language=b,!0}),q.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"").length&&(n.icon=q.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"")),q.children("ins").get(0).style.backgroundImage.length&&(n.icon=q.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")",""))):n=h.get_text(q);1<k.length?l.data.push(n):l.data=n});p=p.find("\x3e ul \x3e li");p.length&&(l.children=h.get_json(p,c,d,!0));f.push(l)});return f}}})})(jQuery);(function(b){b.jstree.plugin("languages",{__init:function(){this._load_css()},defaults:[],_fn:{set_lang:function(a){var c=this._get_settings().languages,d=".jstree-"+this.get_index()+" a";if(!b.isArray(c)||0===c.length)return!1;if(-1==b.inArray(a,c))if(c[a])a=c[a];else return!1;if(a==this.data.languages.current_language)return!0;c=b.vakata.css.get_css(d+"."+this.data.languages.current_language,!1,this.data.languages.language_css);!1!==c&&(c.style.display="none");c=b.vakata.css.get_css(d+"."+a,!1,this.data.languages.language_css);!1!==c&&(c.style.display="");this.data.languages.current_language=a;this.__callback(a);return!0},get_lang:function(){return this.data.languages.current_language},get_text:function(a,c){a=this._get_node(a)||this.data.ui.last_selected;if(!a.size())return!1;var d=this._get_settings().languages,e=this._get_settings().core.html_titles;b.isArray(d)&&d.length?(c=c&&-1!=b.inArray(c,d)?c:this.data.languages.current_language,a=a.children("a."+c)):a=a.children("a:eq(0)");if(e)return a=a.clone(),a.children("INS").remove(),a.html();a=a.contents().filter(function(){return 3==this.nodeType})[0];return a.nodeValue},set_text:function(a,c,d){a=this._get_node(a)||this.data.ui.last_selected;if(!a.size())return!1;var e=this._get_settings().languages,f=this._get_settings().core.html_titles;b.isArray(e)&&e.length?(d=d&&-1!=b.inArray(d,e)?d:this.data.languages.current_language,a=a.children("a."+d)):a=a.children("a:eq(0)");if(f)return e=a.children("INS").clone(),a.html(c).prepend(e),this.__callback({obj:a,name:c,lang:d}),!0;a=a.contents().filter(function(){return 3==this.nodeType})[0];this.__callback({obj:a,name:c,lang:d});return a.nodeValue=c},_load_css:function(){var a=this._get_settings().languages,c="/* languages css */",d=".jstree-"+this.get_index()+" a",e;if(b.isArray(a)&&a.length){this.data.languages.current_language=a[0];for(e=0;e<a.length;e++)c+=d+"."+a[e]+" {",a[e]!=this.data.languages.current_language&&(c+=" display:none; "),c+=" } ";this.data.languages.language_css=b.vakata.css.add_sheet({str:c})}},create_node:function(a,c,d,e){return this.__call_old(!0,a,c,d,function(a){var c=this._get_settings().languages,d=a.children("a"),l;if(b.isArray(c)&&c.length){for(l=0;l<c.length;l++)d.is("."+c[l])||a.append(d.eq(0).clone().removeClass(c.join(" ")).addClass(c[l]));d.not("."+c.join(", .")).remove()}e&&e.call(this,a)})}}})})(jQuery);(function(b){b.jstree.plugin("cookies",{__init:function(){if("undefined"===typeof b.cookie)throw"jsTree cookie: jQuery cookie plugin not included.";var a=this._get_settings().cookies,c;a.save_opened&&(c=b.cookie(a.save_opened))&&c.length&&(this.data.core.to_open=c.split(","));a.save_selected&&(c=b.cookie(a.save_selected))&&c.length&&this.data.ui&&(this.data.ui.to_select=c.split(","));this.get_container().one((this.data.ui?"reselect":"reopen")+".jstree",b.proxy(function(){this.get_container().bind("open_node.jstree close_node.jstree select_node.jstree deselect_node.jstree",b.proxy(function(a){this._get_settings().cookies.auto_save&&this.save_cookie((a.handleObj.namespace+a.handleObj.type).replace("jstree",""))},this))},this))},defaults:{save_opened:"jstree_open",save_selected:"jstree_select",auto_save:!0,cookie_options:{}},_fn:{save_cookie:function(a){if(!this.data.core.refreshing){var c=this._get_settings().cookies;if(a)switch(a){case "open_node":case "close_node":c.save_opened&&(this.save_opened(),b.cookie(c.save_opened,this.data.core.to_open.join(","),c.cookie_options));break;case "select_node":case "deselect_node":c.save_selected&&this.data.ui&&(this.save_selected(),b.cookie(c.save_selected,this.data.ui.to_select.join(","),c.cookie_options))}else c.save_opened&&(this.save_opened(),b.cookie(c.save_opened,this.data.core.to_open.join(","),c.cookie_options)),c.save_selected&&this.data.ui&&(this.save_selected(),b.cookie(c.save_selected,this.data.ui.to_select.join(","),c.cookie_options))}}}});b.jstree.defaults.plugins.push("cookies")})(jQuery);(function(b){b.jstree.plugin("sort",{__init:function(){this.get_container().bind("load_node.jstree",b.proxy(function(a,b){var d=this._get_node(b.rslt.obj),d=-1===d?this.get_container().children("ul"):d.children("ul");this.sort(d)},this)).bind("rename_node.jstree",b.proxy(function(a,b){this.sort(b.rslt.obj.parent())},this)).bind("move_node.jstree",b.proxy(function(a,b){var d=-1==b.rslt.np?this.get_container():b.rslt.np;this.sort(d.children("ul"))},this))},defaults:function(a,b){return this.get_text(a)>this.get_text(b)?1:-1},_fn:{sort:function(a){var c=this._get_settings().sort,d=this;a.append(b.makeArray(a.children("li")).sort(b.proxy(c,d)));a.find("\x3e li \x3e ul").each(function(){d.sort(b(this))});this.clean_node(a)}}})})(jQuery);(function(b){var a=!1,c=!1,d=!1,e=!1,f=!1,g=!1,h=!1;b.vakata.dnd={is_down:!1,is_drag:!1,helper:!1,scroll_spd:10,init_x:0,init_y:0,threshold:5,user_data:{},drag_start:function(a,c,d){b.vakata.dnd.is_drag&&b.vakata.drag_stop({});try{a.currentTarget.unselectable="on",a.currentTarget.onselectstart=function(){return!1},a.currentTarget.style&&(a.currentTarget.style.MozUserSelect="none")}catch(e){}b.vakata.dnd.init_x=a.pageX;b.vakata.dnd.init_y=a.pageY;b.vakata.dnd.user_data=c;b.vakata.dnd.is_down=!0;b.vakata.dnd.helper=b("\x3cdiv id\x3d'vakata-dragged'\x3e").html(d).css("opacity","0.75");b(document).bind("mousemove",b.vakata.dnd.drag);b(document).bind("mouseup",b.vakata.dnd.drag_stop);return!1},drag:function(a){if(b.vakata.dnd.is_down){if(!b.vakata.dnd.is_drag)if(5<Math.abs(a.pageX-b.vakata.dnd.init_x)||5<Math.abs(a.pageY-b.vakata.dnd.init_y))b.vakata.dnd.helper.appendTo("body"),b.vakata.dnd.is_drag=!0,b(document).triggerHandler("drag_start.vakata",{event:a,data:b.vakata.dnd.user_data});else return;if("mousemove"===a.type){var c=b(document),d=c.scrollTop(),c=c.scrollLeft();20>a.pageY-d?(f&&"down"===g&&(clearInterval(f),f=!1),f||(g="up",f=setInterval(function(){b(document).scrollTop(b(document).scrollTop()-b.vakata.dnd.scroll_spd)},150))):f&&"up"===g&&(clearInterval(f),f=!1);20>b(window).height()-(a.pageY-d)?(f&&"up"===g&&(clearInterval(f),f=!1),f||(g="down",f=setInterval(function(){b(document).scrollTop(b(document).scrollTop()+b.vakata.dnd.scroll_spd)},150))):f&&"down"===g&&(clearInterval(f),f=!1);20>a.pageX-c?(e&&"right"===h&&(clearInterval(e),e=!1),e||(h="left",e=setInterval(function(){b(document).scrollLeft(b(document).scrollLeft()-b.vakata.dnd.scroll_spd)},150))):e&&"left"===h&&(clearInterval(e),e=!1);20>b(window).width()-(a.pageX-c)?(e&&"left"===h&&(clearInterval(e),e=!1),e||(h="right",e=setInterval(function(){b(document).scrollLeft(b(document).scrollLeft()+b.vakata.dnd.scroll_spd)},150))):e&&"right"===h&&(clearInterval(e),e=!1)}b.vakata.dnd.helper.css({left:a.pageX+5+"px",top:a.pageY+10+"px"});b(document).triggerHandler("drag.vakata",{event:a,data:b.vakata.dnd.user_data})}},drag_stop:function(a){b(document).unbind("mousemove",b.vakata.dnd.drag);b(document).unbind("mouseup",b.vakata.dnd.drag_stop);b(document).triggerHandler("drag_stop.vakata",{event:a,data:b.vakata.dnd.user_data});b.vakata.dnd.helper.remove();b.vakata.dnd.init_x=0;b.vakata.dnd.init_y=0;b.vakata.dnd.user_data={};b.vakata.dnd.is_down=!1;b.vakata.dnd.is_drag=!1}};b(function(){b.vakata.css.add_sheet({str:"#vakata-dragged { display:block; margin:0 0 0 0; padding:4px 4px 4px 24px; position:absolute; top:-2000px; line-height:16px; z-index:10000; } "})});b.jstree.plugin("dnd",{__init:function(){this.data.dnd={active:!1,after:!1,inside:!1,before:!1,off:!1,prepared:!1,w:0,to1:!1,to2:!1,cof:!1,cw:!1,ch:!1,i1:!1,i2:!1};this.get_container().bind("mouseenter.jstree",b.proxy(function(){b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree&&this.data.themes&&(d.attr("class","jstree-"+this.data.themes.theme),b.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme))},this)).bind("mouseleave.jstree",b.proxy(function(){b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree&&(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i2&&clearInterval(this.data.dnd.i2))},this)).bind("mousemove.jstree",b.proxy(function(a){if(b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree){var c=this.get_container()[0];a.pageX+24>this.data.dnd.cof.left+this.data.dnd.cw?(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i1=setInterval(b.proxy(function(){this.scrollLeft+=b.vakata.dnd.scroll_spd},c),100)):a.pageX-24<this.data.dnd.cof.left?(this.data.dnd.i1&&clearInterval(this.data.dnd.i1),this.data.dnd.i1=setInterval(b.proxy(function(){this.scrollLeft-=b.vakata.dnd.scroll_spd},c),100)):this.data.dnd.i1&&clearInterval(this.data.dnd.i1);a.pageY+24>this.data.dnd.cof.top+this.data.dnd.ch?(this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.i2=setInterval(b.proxy(function(){this.scrollTop+=b.vakata.dnd.scroll_spd},c),100)):a.pageY-24<this.data.dnd.cof.top?(this.data.dnd.i2&&clearInterval(this.data.dnd.i2),this.data.dnd.i2=setInterval(b.proxy(function(){this.scrollTop-=b.vakata.dnd.scroll_spd},c),100)):this.data.dnd.i2&&clearInterval(this.data.dnd.i2)}},this)).delegate("a","mousedown.jstree",b.proxy(function(a){if(1===a.which)return this.start_drag(a.currentTarget,a),!1},this)).delegate("a","mouseenter.jstree",b.proxy(function(a){b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree&&this.dnd_enter(a.currentTarget)},this)).delegate("a","mousemove.jstree",b.proxy(function(a){b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree&&("undefined"===typeof this.data.dnd.off.top&&(this.data.dnd.off=b(a.target).offset()),this.data.dnd.w=(a.pageY-(this.data.dnd.off.top||0))%this.data.core.li_height,0>this.data.dnd.w&&(this.data.dnd.w+=this.data.core.li_height),this.dnd_show())},this)).delegate("a","mouseleave.jstree",b.proxy(function(a){b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree&&(this.data.dnd.after=!1,this.data.dnd.before=!1,this.data.dnd.inside=!1,b.vakata.dnd.helper.children("ins").attr("class","jstree-invalid"),d.hide(),c&&c[0]===a.target.parentNode&&(this.data.dnd.to1&&(clearTimeout(this.data.dnd.to1),this.data.dnd.to1=!1),this.data.dnd.to2&&(clearTimeout(this.data.dnd.to2),this.data.dnd.to2=!1)))},this)).delegate("a","mouseup.jstree",b.proxy(function(a){b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree&&this.dnd_finish(a)},this));b(document).bind("drag_stop.vakata",b.proxy(function(){this.data.dnd.after=!1;this.data.dnd.before=!1;this.data.dnd.inside=!1;this.data.dnd.off=!1;this.data.dnd.prepared=!1;this.data.dnd.w=!1;this.data.dnd.to1=!1;this.data.dnd.to2=!1;this.data.dnd.active=!1;this.data.dnd.foreign=!1;d&&d.css({top:"-2000px"})},this)).bind("drag_start.vakata",b.proxy(function(a,c){if(c.data.jstree){var d=b(c.event.target);d.closest(".jstree").hasClass("jstree-"+this.get_index())&&this.dnd_enter(d)}},this));var e=this._get_settings().dnd;e.drag_target&&b(document).delegate(e.drag_target,"mousedown.jstree",b.proxy(function(c){a=c.target;b.vakata.dnd.drag_start(c,{jstree:!0,obj:c.target},"\x3cins class\x3d'jstree-icon'\x3e\x3c/ins\x3e"+b(c.target).text());this.data.themes&&(d.attr("class","jstree-"+this.data.themes.theme),b.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme));b.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");c=this.get_container();this.data.dnd.cof=c.offset();this.data.dnd.cw=parseInt(c.width(),10);this.data.dnd.ch=parseInt(c.height(),10);this.data.dnd.foreign=!0;return!1},this));e.drop_target&&b(document).delegate(e.drop_target,"mouseenter.jstree",b.proxy(function(c){this.data.dnd.active&&this._get_settings().dnd.drop_check.call(this,{o:a,r:b(c.target)})&&b.vakata.dnd.helper.children("ins").attr("class","jstree-ok")},this)).delegate(e.drop_target,"mouseleave.jstree",b.proxy(function(a){this.data.dnd.active&&b.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")},this)).delegate(e.drop_target,"mouseup.jstree",b.proxy(function(c){this.data.dnd.active&&b.vakata.dnd.helper.children("ins").hasClass("jstree-ok")&&this._get_settings().dnd.drop_finish.call(this,{o:a,r:b(c.target)})},this))},defaults:{copy_modifier:"ctrl",check_timeout:200,open_timeout:500,drop_target:".jstree-drop",drop_check:function(a){return!0},drop_finish:b.noop,drag_target:".jstree-draggable",drag_finish:b.noop,drag_check:function(a){return{after:!1,before:!1,inside:!0}}},_fn:{dnd_prepare:function(){if(c&&c.length){this.data.dnd.off=c.offset();this._get_settings().core.rtl&&(this.data.dnd.off.right=this.data.dnd.off.left+c.width());if(this.data.dnd.foreign){var b=this._get_settings().dnd.drag_check.call(this,{o:a,r:c});this.data.dnd.after=b.after;this.data.dnd.before=b.before;this.data.dnd.inside=b.inside;this.data.dnd.prepared=!0;return this.dnd_show()}this.prepare_move(a,c,"before");this.data.dnd.before=this.check_move();this.prepare_move(a,c,"after");this.data.dnd.after=this.check_move();this._is_loaded(c)?(this.prepare_move(a,c,"inside"),this.data.dnd.inside=this.check_move()):this.data.dnd.inside=!1;this.data.dnd.prepared=!0;return this.dnd_show()}},dnd_show:function(){if(this.data.dnd.prepared){var a=["before","inside","after"],c=!1,e=this._get_settings().core.rtl,a=this.data.dnd.w<this.data.core.li_height/3?["before","inside","after"]:this.data.dnd.w<=2*this.data.core.li_height/3?this.data.dnd.w<this.data.core.li_height/2?["inside","before","after"]:["inside","after","before"]:["after","inside","before"];b.each(a,b.proxy(function(a,d){if(this.data.dnd[d])return b.vakata.dnd.helper.children("ins").attr("class","jstree-ok"),c=d,!1},this));!1===c&&b.vakata.dnd.helper.children("ins").attr("class","jstree-invalid");a=e?this.data.dnd.off.right-18:this.data.dnd.off.left+10;switch(c){case "before":d.css({left:a+"px",top:this.data.dnd.off.top-6+"px"}).show();break;case "after":d.css({left:a+"px",top:this.data.dnd.off.top+this.data.core.li_height-7+"px"}).show();break;case "inside":d.css({left:a+(e?-4:4)+"px",top:this.data.dnd.off.top+this.data.core.li_height/2-5+"px"}).show();break;default:d.hide()}return c}},dnd_open:function(){this.data.dnd.to2=!1;this.open_node(c,b.proxy(this.dnd_prepare,this),!0)},dnd_finish:function(b){this.data.dnd.foreign?(this.data.dnd.after||this.data.dnd.before||this.data.dnd.inside)&&this._get_settings().dnd.drag_finish.call(this,{o:a,r:c}):(this.dnd_prepare(),this.move_node(a,c,this.dnd_show(),b[this._get_settings().dnd.copy_modifier+"Key"]));c=a=!1;d.hide()},dnd_enter:function(a){var d=this._get_settings().dnd;this.data.dnd.prepared=!1;c=this._get_node(a);d.check_timeout?(this.data.dnd.to1&&clearTimeout(this.data.dnd.to1),this.data.dnd.to1=setTimeout(b.proxy(this.dnd_prepare,this),d.check_timeout)):this.dnd_prepare();d.open_timeout?(this.data.dnd.to2&&clearTimeout(this.data.dnd.to2),c&&c.length&&c.hasClass("jstree-closed")&&(this.data.dnd.to2=setTimeout(b.proxy(this.dnd_open,this),d.open_timeout))):c&&c.length&&c.hasClass("jstree-closed")&&this.dnd_open()},start_drag:function(c,e){a=this._get_node(c);this.data.ui&&this.is_selected(a)&&(a=this._get_node(null,!0));b.vakata.dnd.drag_start(e,{jstree:!0,obj:a},"\x3cins class\x3d'jstree-icon'\x3e\x3c/ins\x3e"+(1<a.length?"Multiple selection":this.get_text(a)));this.data.themes&&(d.attr("class","jstree-"+this.data.themes.theme),b.vakata.dnd.helper.attr("class","jstree-dnd-helper jstree-"+this.data.themes.theme));var f=this.get_container();this.data.dnd.cof=f.children("ul").offset();this.data.dnd.cw=parseInt(f.width(),10);this.data.dnd.ch=parseInt(f.height(),10);this.data.dnd.active=!0}}});b(function(){b.vakata.css.add_sheet({str:"#vakata-dragged ins { display:block; text-decoration:none; width:16px; height:16px; margin:0 0 0 0; padding:0; position:absolute; top:4px; left:4px; } #vakata-dragged .jstree-ok { background:green; } #vakata-dragged .jstree-invalid { background:red; } #jstree-marker { padding:0; margin:0; line-height:12px; font-size:1px; overflow:hidden; height:12px; width:8px; position:absolute; top:-30px; z-index:10000; background-repeat:no-repeat; display:none; background-color:silver; } "});d=b("\x3cdiv\x3e").attr({id:"jstree-marker"}).hide().appendTo("body");b(document).bind("drag_start.vakata",function(a,b){b.data.jstree&&d.show()});b(document).bind("drag_stop.vakata",function(a,b){b.data.jstree&&d.hide()})})})(jQuery);(function(b){b.jstree.plugin("checkbox",{__init:function(){this.select_node=this.deselect_node=this.deselect_all=b.noop;this.get_selected=this.get_checked;this.get_container().bind("open_node.jstree create_node.jstree clean_node.jstree",b.proxy(function(a,b){this._prepare_checkboxes(b.rslt.obj)},this)).bind("loaded.jstree",b.proxy(function(a){this._prepare_checkboxes()},this)).delegate("a","click.jstree",b.proxy(function(a){this._get_node(a.target).hasClass("jstree-checked")?this.uncheck_node(a.target):this.check_node(a.target);this.data.ui&&this.save_selected();this.data.cookies&&this.save_cookie("select_node");a.preventDefault()},this))},__destroy:function(){this.get_container().find(".jstree-checkbox").remove()},_fn:{_prepare_checkboxes:function(a){a=a&&-1!=a?this._get_node(a):this.get_container();var c,d=this,e;a.each(function(){e=b(this);c=e.is("li")&&e.hasClass("jstree-checked")?"jstree-checked":"jstree-unchecked";e.find("a").not(":has(.jstree-checkbox)").prepend("\x3cins class\x3d'jstree-checkbox'\x3e\x26#160;\x3c/ins\x3e").parent().not(".jstree-checked, .jstree-unchecked").addClass(c)});a.is("li")?this._repair_state(a):a.find("\x3e ul \x3e li").each(function(){d._repair_state(this)})},change_state:function(a,c){a=this._get_node(a);(c=!1===c||!0===c?c:a.hasClass("jstree-checked"))?a.find("li").andSelf().removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked"):(a.find("li").andSelf().removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked"),this.data.ui&&(this.data.ui.last_selected=a),this.data.checkbox.last_selected=a);a.parentsUntil(".jstree","li").each(function(){var a=b(this);if(c){if(a.children("ul").children(".jstree-checked, .jstree-undetermined").length)return a.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),!1;a.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked")}else{if(a.children("ul").children(".jstree-unchecked, .jstree-undetermined").length)return a.parentsUntil(".jstree","li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined"),!1;a.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked")}});this.data.ui&&(this.data.ui.selected=this.get_checked());this.__callback(a)},check_node:function(a){this.change_state(a,!1)},uncheck_node:function(a){this.change_state(a,!0)},check_all:function(){var a=this;this.get_container().children("ul").children("li").each(function(){a.check_node(this,!1)})},uncheck_all:function(){var a=this;this.get_container().children("ul").children("li").each(function(){a.change_state(this,!0)})},is_checked:function(a){a=this._get_node(a);return a.length?a.is(".jstree-checked"):!1},get_checked:function(a){a=a&&-1!==a?this._get_node(a):this.get_container();return a.find("\x3e ul \x3e .jstree-checked, .jstree-undetermined \x3e ul \x3e .jstree-checked")},get_unchecked:function(a){a=a&&-1!==a?this._get_node(a):this.get_container();return a.find("\x3e ul \x3e .jstree-unchecked, .jstree-undetermined \x3e ul \x3e .jstree-unchecked")},show_checkboxes:function(){this.get_container().children("ul").removeClass("jstree-no-checkboxes")},hide_checkboxes:function(){this.get_container().children("ul").addClass("jstree-no-checkboxes")},_repair_state:function(a){a=this._get_node(a);if(a.length){var b=a.find("\x3e ul \x3e .jstree-checked").length,d=a.find("\x3e ul \x3e .jstree-undetermined").length,e=a.find("\x3e ul \x3e li").length;0===e?a.hasClass("jstree-undetermined")&&this.check_node(a):0===b&&0===d?this.uncheck_node(a):b===e?this.check_node(a):a.parentsUntil(".jstree","li").removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined")}},reselect:function(){if(this.data.ui){var a=this,c=this.data.ui.to_select,c=b.map(b.makeArray(c),function(a){return"#"+a.toString().replace(/^#/,"").replace("\\/","/").replace("/","\\/")});this.deselect_all();b.each(c,function(b,c){a.check_node(c)});this.__callback()}}}})})(jQuery);(function(b){b.vakata.xslt=function(a,d,e){var f="",g;if(document.recalc)return g=document.createElement("xml"),f=document.createElement("xml"),g.innerHTML=a,f.innerHTML=d,b("body").append(g).append(f),setTimeout(function(a,b,c){return function(){c.call(null,a.transformNode(b.XMLDocument));setTimeout(function(a,b){return function(){jQuery("body").remove(a).remove(b)}}(a,b),200)}}(g,f,e),100),!0;if("undefined"!==typeof window.DOMParser&&"undefined"!==typeof window.XMLHttpRequest&&"undefined"!==typeof window.XSLTProcessor){g=new XSLTProcessor;f=b.isFunction(g.transformDocument)?"undefined"!==typeof window.XMLSerializer:!0;if(!f)return!1;a=(new DOMParser).parseFromString(a,"text/xml");d=(new DOMParser).parseFromString(d,"text/xml");b.isFunction(g.transformDocument)?(f=document.implementation.createDocument("","",null),g.transformDocument(a,d,f,null),e.call(null,XMLSerializer().serializeToString(f))):(g.importStylesheet(d),f=g.transformToFragment(a,document),e.call(null,b("\x3cdiv\x3e").append(f).html()));return!0}return!1};var a={nest:'\x3c?xml version\x3d"1.0" encoding\x3d"utf-8" ?\x3e\x3cxsl:stylesheet version\x3d"1.0" xmlns:xsl\x3d"http://www.w3.org/1999/XSL/Transform" \x3e\x3cxsl:output method\x3d"html" encoding\x3d"utf-8" omit-xml-declaration\x3d"yes" standalone\x3d"no" indent\x3d"no" media-type\x3d"text/html" /\x3e\x3cxsl:template match\x3d"/"\x3e\t\x3cxsl:call-template name\x3d"nodes"\x3e\t\t\x3cxsl:with-param name\x3d"node" select\x3d"/root" /\x3e\t\x3c/xsl:call-template\x3e\x3c/xsl:template\x3e\x3cxsl:template name\x3d"nodes"\x3e\t\x3cxsl:param name\x3d"node" /\x3e\t\x3cul\x3e\t\x3cxsl:for-each select\x3d"$node/item"\x3e\t\t\x3cxsl:variable name\x3d"children" select\x3d"count(./item) \x26gt; 0" /\x3e\t\t\x3cli\x3e\t\t\t\x3cxsl:attribute name\x3d"class"\x3e\t\t\t\t\x3cxsl:if test\x3d"position() \x3d last()"\x3ejstree-last \x3c/xsl:if\x3e\t\t\t\t\x3cxsl:choose\x3e\t\t\t\t\t\x3cxsl:when test\x3d"@state \x3d \'open\'"\x3ejstree-open \x3c/xsl:when\x3e\t\t\t\t\t\x3cxsl:when test\x3d"$children or @hasChildren or @state \x3d \'closed\'"\x3ejstree-closed \x3c/xsl:when\x3e\t\t\t\t\t\x3cxsl:otherwise\x3ejstree-leaf \x3c/xsl:otherwise\x3e\t\t\t\t\x3c/xsl:choose\x3e\t\t\t\t\x3cxsl:value-of select\x3d"@class" /\x3e\t\t\t\x3c/xsl:attribute\x3e\t\t\t\x3cxsl:for-each select\x3d"@*"\x3e\t\t\t\t\x3cxsl:if test\x3d"name() !\x3d \'class\' and name() !\x3d \'state\' and name() !\x3d \'hasChildren\'"\x3e\t\t\t\t\t\x3cxsl:attribute name\x3d"{name()}"\x3e\x3cxsl:value-of select\x3d"." /\x3e\x3c/xsl:attribute\x3e\t\t\t\t\x3c/xsl:if\x3e\t\t\t\x3c/xsl:for-each\x3e\t\x3cins class\x3d"jstree-icon"\x3e\x3cxsl:text\x3e\x26#xa0;\x3c/xsl:text\x3e\x3c/ins\x3e\t\t\t\x3cxsl:for-each select\x3d"content/name"\x3e\t\t\t\t\x3ca\x3e\t\t\t\t\x3cxsl:attribute name\x3d"href"\x3e\t\t\t\t\t\x3cxsl:choose\x3e\t\t\t\t\t\x3cxsl:when test\x3d"@href"\x3e\x3cxsl:value-of select\x3d"@href" /\x3e\x3c/xsl:when\x3e\t\t\t\t\t\x3cxsl:otherwise\x3e#\x3c/xsl:otherwise\x3e\t\t\t\t\t\x3c/xsl:choose\x3e\t\t\t\t\x3c/xsl:attribute\x3e\t\t\t\t\x3cxsl:attribute name\x3d"class"\x3e\x3cxsl:value-of select\x3d"@lang" /\x3e \x3cxsl:value-of select\x3d"@class" /\x3e\x3c/xsl:attribute\x3e\t\t\t\t\x3cxsl:attribute name\x3d"style"\x3e\x3cxsl:value-of select\x3d"@style" /\x3e\x3c/xsl:attribute\x3e\t\t\t\t\x3cxsl:for-each select\x3d"@*"\x3e\t\t\t\t\t\x3cxsl:if test\x3d"name() !\x3d \'style\' and name() !\x3d \'class\' and name() !\x3d \'href\'"\x3e\t\t\t\t\t\t\x3cxsl:attribute name\x3d"{name()}"\x3e\x3cxsl:value-of select\x3d"." /\x3e\x3c/xsl:attribute\x3e\t\t\t\t\t\x3c/xsl:if\x3e\t\t\t\t\x3c/xsl:for-each\x3e\t\t\t\t\t\x3cins\x3e\t\t\t\t\t\t\x3cxsl:attribute name\x3d"class"\x3ejstree-icon \t\t\t\t\t\t\t\x3cxsl:if test\x3d"string-length(attribute::icon) \x3e 0 and not(contains(@icon,\'/\'))"\x3e\x3cxsl:value-of select\x3d"@icon" /\x3e\x3c/xsl:if\x3e\t\t\t\t\t\t\x3c/xsl:attribute\x3e\t\t\t\t\t\t\x3cxsl:if test\x3d"string-length(attribute::icon) \x3e 0 and contains(@icon,\'/\')"\x3e\x3cxsl:attribute name\x3d"style"\x3ebackground:url(\x3cxsl:value-of select\x3d"@icon" /\x3e) center center no-repeat;\x3c/xsl:attribute\x3e\x3c/xsl:if\x3e\t\t\t\t\t\t\x3cxsl:text\x3e\x26#xa0;\x3c/xsl:text\x3e\t\t\t\t\t\x3c/ins\x3e\t\t\t\t\t\x3cxsl:value-of select\x3d"current()" /\x3e\t\t\t\t\x3c/a\x3e\t\t\t\x3c/xsl:for-each\x3e\t\t\t\x3cxsl:if test\x3d"$children or @hasChildren"\x3e\x3cxsl:call-template name\x3d"nodes"\x3e\x3cxsl:with-param name\x3d"node" select\x3d"current()" /\x3e\x3c/xsl:call-template\x3e\x3c/xsl:if\x3e\t\t\x3c/li\x3e\t\x3c/xsl:for-each\x3e\t\x3c/ul\x3e\x3c/xsl:template\x3e\x3c/xsl:stylesheet\x3e',flat:'\x3c?xml version\x3d"1.0" encoding\x3d"utf-8" ?\x3e\x3cxsl:stylesheet version\x3d"1.0" xmlns:xsl\x3d"http://www.w3.org/1999/XSL/Transform" \x3e\x3cxsl:output method\x3d"html" encoding\x3d"utf-8" omit-xml-declaration\x3d"yes" standalone\x3d"no" indent\x3d"no" media-type\x3d"text/xml" /\x3e\x3cxsl:template match\x3d"/"\x3e\t\x3cul\x3e\t\x3cxsl:for-each select\x3d"//item[not(@parent_id) or @parent_id\x3d0 or not(@parent_id \x3d //item/@id)]"\x3e\t\t\x3cxsl:call-template name\x3d"nodes"\x3e\t\t\t\x3cxsl:with-param name\x3d"node" select\x3d"." /\x3e\t\t\t\x3cxsl:with-param name\x3d"is_last" select\x3d"number(position() \x3d last())" /\x3e\t\t\x3c/xsl:call-template\x3e\t\x3c/xsl:for-each\x3e\t\x3c/ul\x3e\x3c/xsl:template\x3e\x3cxsl:template name\x3d"nodes"\x3e\t\x3cxsl:param name\x3d"node" /\x3e\t\x3cxsl:param name\x3d"is_last" /\x3e\t\x3cxsl:variable name\x3d"children" select\x3d"count(//item[@parent_id\x3d$node/attribute::id]) \x26gt; 0" /\x3e\t\x3cli\x3e\t\x3cxsl:attribute name\x3d"class"\x3e\t\t\x3cxsl:if test\x3d"$is_last \x3d true()"\x3ejstree-last \x3c/xsl:if\x3e\t\t\x3cxsl:choose\x3e\t\t\t\x3cxsl:when test\x3d"@state \x3d \'open\'"\x3ejstree-open \x3c/xsl:when\x3e\t\t\t\x3cxsl:when test\x3d"$children or @hasChildren or @state \x3d \'closed\'"\x3ejstree-closed \x3c/xsl:when\x3e\t\t\t\x3cxsl:otherwise\x3ejstree-leaf \x3c/xsl:otherwise\x3e\t\t\x3c/xsl:choose\x3e\t\t\x3cxsl:value-of select\x3d"@class" /\x3e\t\x3c/xsl:attribute\x3e\t\x3cxsl:for-each select\x3d"@*"\x3e\t\t\x3cxsl:if test\x3d"name() !\x3d \'parent_id\' and name() !\x3d \'hasChildren\' and name() !\x3d \'class\' and name() !\x3d \'state\'"\x3e\t\t\x3cxsl:attribute name\x3d"{name()}"\x3e\x3cxsl:value-of select\x3d"." /\x3e\x3c/xsl:attribute\x3e\t\t\x3c/xsl:if\x3e\t\x3c/xsl:for-each\x3e\t\x3cins class\x3d"jstree-icon"\x3e\x3cxsl:text\x3e\x26#xa0;\x3c/xsl:text\x3e\x3c/ins\x3e\t\x3cxsl:for-each select\x3d"content/name"\x3e\t\t\x3ca\x3e\t\t\x3cxsl:attribute name\x3d"href"\x3e\t\t\t\x3cxsl:choose\x3e\t\t\t\x3cxsl:when test\x3d"@href"\x3e\x3cxsl:value-of select\x3d"@href" /\x3e\x3c/xsl:when\x3e\t\t\t\x3cxsl:otherwise\x3e#\x3c/xsl:otherwise\x3e\t\t\t\x3c/xsl:choose\x3e\t\t\x3c/xsl:attribute\x3e\t\t\x3cxsl:attribute name\x3d"class"\x3e\x3cxsl:value-of select\x3d"@lang" /\x3e \x3cxsl:value-of select\x3d"@class" /\x3e\x3c/xsl:attribute\x3e\t\t\x3cxsl:attribute name\x3d"style"\x3e\x3cxsl:value-of select\x3d"@style" /\x3e\x3c/xsl:attribute\x3e\t\t\x3cxsl:for-each select\x3d"@*"\x3e\t\t\t\x3cxsl:if test\x3d"name() !\x3d \'style\' and name() !\x3d \'class\' and name() !\x3d \'href\'"\x3e\t\t\t\t\x3cxsl:attribute name\x3d"{name()}"\x3e\x3cxsl:value-of select\x3d"." /\x3e\x3c/xsl:attribute\x3e\t\t\t\x3c/xsl:if\x3e\t\t\x3c/xsl:for-each\x3e\t\t\t\x3cins\x3e\t\t\t\t\x3cxsl:attribute name\x3d"class"\x3ejstree-icon \t\t\t\t\t\x3cxsl:if test\x3d"string-length(attribute::icon) \x3e 0 and not(contains(@icon,\'/\'))"\x3e\x3cxsl:value-of select\x3d"@icon" /\x3e\x3c/xsl:if\x3e\t\t\t\t\x3c/xsl:attribute\x3e\t\t\t\t\x3cxsl:if test\x3d"string-length(attribute::icon) \x3e 0 and contains(@icon,\'/\')"\x3e\x3cxsl:attribute name\x3d"style"\x3ebackground:url(\x3cxsl:value-of select\x3d"@icon" /\x3e) center center no-repeat;\x3c/xsl:attribute\x3e\x3c/xsl:if\x3e\t\t\t\t\x3cxsl:text\x3e\x26#xa0;\x3c/xsl:text\x3e\t\t\t\x3c/ins\x3e\t\t\t\x3cxsl:value-of select\x3d"current()" /\x3e\t\t\x3c/a\x3e\t\x3c/xsl:for-each\x3e\t\x3cxsl:if test\x3d"$children"\x3e\t\t\x3cul\x3e\t\t\x3cxsl:for-each select\x3d"//item[@parent_id\x3d$node/attribute::id]"\x3e\t\t\t\x3cxsl:call-template name\x3d"nodes"\x3e\t\t\t\t\x3cxsl:with-param name\x3d"node" select\x3d"." /\x3e\t\t\t\t\x3cxsl:with-param name\x3d"is_last" select\x3d"number(position() \x3d last())" /\x3e\t\t\t\x3c/xsl:call-template\x3e\t\t\x3c/xsl:for-each\x3e\t\t\x3c/ul\x3e\t\x3c/xsl:if\x3e\t\x3c/li\x3e\x3c/xsl:template\x3e\x3c/xsl:stylesheet\x3e'};b.jstree.plugin("xml_data",{defaults:{data:!1,ajax:!1,xsl:"flat",clean_node:!1,correct_state:!0},_fn:{load_node:function(a,b,e){var f=this;this.load_node_xml(a,function(){f.__callback({obj:a});b.call(this)},e)},_is_loaded:function(a){var b=this._get_settings().xml_data;a=this._get_node(a);return-1==a||!a||!b.ajax||a.is(".jstree-open, .jstree-leaf")||0<a.children("ul").children("li").size()},load_node_xml:function(a,d,e){var f=this.get_settings().xml_data,g=function(){},h=function(){};if((a=this._get_node(a))&&-1!==a){if(a.data("jstree-is-loading"))return;a.data("jstree-is-loading",!0)}switch(!0){case !f.data&&!f.ajax:throw"Neither data nor ajax settings supplied.";case !!f.data&&!f.ajax||!!f.data&&!!f.ajax&&(!a||-1===a):a&&-1!=a||this.parse_xml(f.data,b.proxy(function(e){e?(e=e.replace(/ ?xmlns="[^"]*"/ig,""),10<e.length&&(e=b(e),this.get_container().children("ul").empty().append(e.children()),f.clean_node&&this.clean_node(a),d&&d.call(this))):f.correct_state&&(this.get_container().children("ul").empty(),d&&d.call(this))},this));break;case !f.data&&!!f.ajax||!!f.data&&!!f.ajax&&a&&-1!==a:g=function(b,d,g){var h=this.get_settings().xml_data.ajax.error;h&&h.call(this,b,d,g);-1!==a&&a.length?(a.children(".jstree-loading").removeClass("jstree-loading"),a.data("jstree-is-loading",!1),"success"===d&&f.correct_state&&a.removeClass("jstree-open jstree-closed").addClass("jstree-leaf")):"success"===d&&f.correct_state&&this.get_container().children("ul").empty();e&&e.call(this)},h=function(e,h,p){e=p.responseText;var k=this.get_settings().xml_data.ajax.success;k&&(e=k.call(this,e,h,p)||e);if(""==e)return g.call(this,p,h,"");this.parse_xml(e,b.proxy(function(e){e&&(e=e.replace(/ ?xmlns="[^"]*"/ig,""),10<e.length?(e=b(e),-1!==a&&a?(a.children(".jstree-loading").removeClass("jstree-loading"),a.append(e),a.data("jstree-is-loading",!1)):this.get_container().children("ul").empty().append(e.children()),f.clean_node&&this.clean_node(a),d&&d.call(this)):a&&-1!==a?(a.children(".jstree-loading").removeClass("jstree-loading"),a.data("jstree-is-loading",!1),f.correct_state&&(a.removeClass("jstree-open jstree-closed").addClass("jstree-leaf"),d&&d.call(this))):f.correct_state&&(this.get_container().children("ul").empty(),d&&d.call(this)))},this))},f.ajax.context=this,f.ajax.error=g,f.ajax.success=h,f.ajax.dataType||(f.ajax.dataType="xml"),b.isFunction(f.ajax.url)&&(f.ajax.url=f.ajax.url.call(this,a)),b.isFunction(f.ajax.data)&&(f.ajax.data=f.ajax.data.call(this,a)),b.ajax(f.ajax)}},parse_xml:function(c,d){var e=this._get_settings().xml_data;b.vakata.xslt(c,a[e.xsl],d)},get_xml:function(a,d,e,f,g){var h="",l=this._get_settings(),n=this,p,k,q,m,r;a||(a="flat");g||(g=0);(d=this._get_node(d))&&-1!==d||(d=this.get_container().find("\x3e ul \x3e li"));e=b.isArray(e)?e:["id","class"];!g&&this.data.types&&-1===b.inArray(l.types.type_attr,e)&&e.push(l.types.type_attr);f=b.isArray(f)?f:[];g||(h+="\x3croot\x3e");d.each(function(){h+="\x3citem";q=b(this);b.each(e,function(a,b){h+=" "+b+'\x3d"'+(q.attr(b)||"").replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"")+'"'});q.hasClass("jstree-open")&&(h+=' state\x3d"open"');q.hasClass("jstree-closed")&&(h+=' state\x3d"closed"');"flat"===a&&(h+=' parent_id\x3d"'+g+'"');h+="\x3e";h+="\x3ccontent\x3e";m=q.children("a");m.each(function(){p=b(this);r=!1;h+="\x3cname";-1!==b.inArray("languages",l.plugins)&&b.each(l.languages,function(a,b){if(p.hasClass(b))return h+=' lang\x3d"'+b+'"',r=b,!1});f.length&&b.each(f,function(a,b){h+=" "+b+'\x3d"'+(p.attr(b)||"").replace(/jstree[^ ]*|$/ig,"")+'"'});p.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"").length&&(h+=' icon\x3d"'+p.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig,"").replace(/^\s+$/ig,"")+'"');p.children("ins").get(0).style.backgroundImage.length&&(h+=' icon\x3d"'+p.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")+'"');h+="\x3e";h+="\x3c![CDATA["+n.get_text(p,r)+"]]\x3e";h+="\x3c/name\x3e"});h+="\x3c/content\x3e";k=q[0].id;q=q.find("\x3e ul \x3e li");k=q.length?n.get_xml(a,q,e,f,k):"";"nest"==a&&(h+=k);h+="\x3c/item\x3e";"flat"==a&&(h+=k)});g||(h+="\x3c/root\x3e");return h}}})})(jQuery);(function(b){b.expr[":"].jstree_contains=function(a,b,d){return 0<=(a.textContent||a.innerText||"").toLowerCase().indexOf(d[3].toLowerCase())};b.jstree.plugin("search",{__init:function(){this.data.search.str="";this.data.search.result=b()},defaults:{ajax:!1,case_insensitive:!1},_fn:{search:function(a,c){if(""!==a){var d=this.get_settings().search,e=this,f=function(){};this.data.search.str=a;if(!c&&!1!==d.ajax&&0<this.get_container().find(".jstree-closed:eq(0)").length){this.search.supress_callback=!0;f=function(a,b,c){var d=this.get_settings().search.ajax.success;d&&(a=d.call(this,a,b,c)||a);this.data.search.to_open=a;this._search_open()};d.ajax.context=this;d.ajax.error=function(){};d.ajax.success=f;b.isFunction(d.ajax.url)&&(d.ajax.url=d.ajax.url.call(this,a));b.isFunction(d.ajax.data)&&(d.ajax.data=d.ajax.data.call(this,a));d.ajax.data||(d.ajax.data={search_string:a});if(!d.ajax.dataType||/^json/.exec(d.ajax.dataType))d.ajax.dataType="json";b.ajax(d.ajax)}else this.data.search.result.length&&this.clear_search(),this.data.search.result=this.get_container().find("a"+(this.data.languages?"."+this.get_lang():"")+":"+(d.case_insensitive?"jstree_contains":"contains")+"("+this.data.search.str+")"),this.data.search.result.addClass("jstree-search").parents(".jstree-closed").each(function(){e.open_node(this,!1,!0)}),this.__callback({nodes:this.data.search.result,str:a})}},clear_search:function(a){this.data.search.result.removeClass("jstree-search");this.__callback(this.data.search.result);this.data.search.result=b()},_search_open:function(a){var c=this;a=!0;var d=[],e=[];this.data.search.to_open.length&&(b.each(this.data.search.to_open,function(a,c){if("#"==c)return!0;b(c).length&&b(c).is(".jstree-closed")?d.push(c):e.push(c)}),d.length&&(this.data.search.to_open=e,b.each(d,function(a,b){c.open_node(b,function(){c._search_open(!0)})}),a=!1));a&&this.search(this.data.search.str,!0)}}})})(jQuery);(function(b){b.vakata.context={cnt:b("\x3cdiv id\x3d'vakata-contextmenu'\x3e"),vis:!1,tgt:!1,par:!1,func:!1,data:!1,show:function(a,c,d,e,f,g){if(a=b.vakata.context.parse(a))b.vakata.context.vis=!0,b.vakata.context.tgt=c,b.vakata.context.par=g||c||null,b.vakata.context.data=f||null,b.vakata.context.cnt.html(a).css({visibility:"hidden",display:"block",left:0,top:0}),f=b.vakata.context.cnt.height(),g=b.vakata.context.cnt.width(),d+g>b(document).width()&&(d=b(document).width()-(g+5),b.vakata.context.cnt.find("li \x3e ul").addClass("right")),e+f>b(document).height()&&(e-=f+c[0].offsetHeight,b.vakata.context.cnt.find("li \x3e ul").addClass("bottom")),b.vakata.context.cnt.css({left:d,top:e}).find("li:has(ul)").bind("mouseenter",function(a){a=b(document).width();var c=b(document).height(),d=b(this).children("ul").show();a!==b(document).width()&&d.toggleClass("right");c!==b(document).height()&&d.toggleClass("bottom")}).bind("mouseleave",function(a){b(this).children("ul").hide()}).end().css({visibility:"visible"}).show(),b(document).triggerHandler("context_show.vakata")},hide:function(){b.vakata.context.vis=!1;b.vakata.context.cnt.attr("class","").hide();b(document).triggerHandler("context_hide.vakata")},parse:function(a,c){if(!a)return!1;var d="",e=!1,f=!0;c||(b.vakata.context.func={});d+="\x3cul\x3e";b.each(a,function(a,c){if(!c)return!0;b.vakata.context.func[a]=c.action;!f&&c.separator_before&&(d+="\x3cli class\x3d'vakata-separator vakata-separator-before'\x3e\x3c/li\x3e");f=!1;d+="\x3cli class\x3d'"+(c._class||"")+(c._disabled?" jstree-contextmenu-disabled ":"")+"'\x3e\x3cins ";c.icon&&-1===c.icon.indexOf("/")&&(d+=" class\x3d'"+c.icon+"' ");c.icon&&-1!==c.icon.indexOf("/")&&(d+=" style\x3d'background:url("+c.icon+") center center no-repeat;' ");d+="\x3e\x26#160;\x3c/ins\x3e\x3ca href\x3d'#' rel\x3d'"+a+"'\x3e";c.submenu&&(d+="\x3cspan style\x3d'float:right;'\x3e\x26raquo;\x3c/span\x3e");d+=c.label+"\x3c/a\x3e";c.submenu&&(e=b.vakata.context.parse(c.submenu,!0))&&(d+=e);d+="\x3c/li\x3e";c.separator_after&&(d+="\x3cli class\x3d'vakata-separator vakata-separator-after'\x3e\x3c/li\x3e",f=!0)});d=d.replace(/<li class\='vakata-separator vakata-separator-after'\><\/li\>$/,"");d+="\x3c/ul\x3e";return 10<d.length?d:!1},exec:function(a){return b.isFunction(b.vakata.context.func[a])?(b.vakata.context.func[a].call(b.vakata.context.data,b.vakata.context.par),!0):!1}};b(function(){b.vakata.css.add_sheet({str:"#vakata-contextmenu { display:none; position:absolute; margin:0; padding:0; min-width:180px; background:#ebebeb; border:1px solid silver; z-index:10000; *width:180px; } #vakata-contextmenu ul { min-width:180px; *width:180px; } #vakata-contextmenu ul, #vakata-contextmenu li { margin:0; padding:0; list-style-type:none; display:block; } #vakata-contextmenu li { line-height:20px; min-height:20px; position:relative; padding:0px; } #vakata-contextmenu li a { padding:1px 6px; line-height:17px; display:block; text-decoration:none; margin:1px 1px 0 1px; } #vakata-contextmenu li ins { float:left; width:16px; height:16px; text-decoration:none; margin-right:2px; } #vakata-contextmenu li a:hover, #vakata-contextmenu li.vakata-hover \x3e a { background:gray; color:white; } #vakata-contextmenu li ul { display:none; position:absolute; top:-2px; left:100%; background:#ebebeb; border:1px solid gray; } #vakata-contextmenu .right { right:100%; left:auto; } #vakata-contextmenu .bottom { bottom:-1px; top:auto; } #vakata-contextmenu li.vakata-separator { min-height:0; height:1px; line-height:1px; font-size:1px; overflow:hidden; margin:0 2px; background:silver; /* border-top:1px solid #fefefe; */ padding:0; } "});b.vakata.context.cnt.delegate("a","click",function(a){a.preventDefault()}).delegate("a","mouseup",function(a){!b(this).parent().hasClass("jstree-contextmenu-disabled")&&b.vakata.context.exec(b(this).attr("rel"))?b.vakata.context.hide():b(this).blur()}).delegate("a","mouseover",function(){b.vakata.context.cnt.find(".vakata-hover").removeClass("vakata-hover")}).appendTo("body");b(document).bind("mousedown",function(a){b.vakata.context.vis&&!b.contains(b.vakata.context.cnt[0],a.target)&&b.vakata.context.hide()});"undefined"!==typeof b.hotkeys&&b(document).bind("keydown","up",function(a){if(b.vakata.context.vis){var c=b.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").prevAll("li:not(.vakata-separator)").first();c.length||(c=b.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").last());c.addClass("vakata-hover");a.stopImmediatePropagation();a.preventDefault()}}).bind("keydown","down",function(a){if(b.vakata.context.vis){var c=b.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").nextAll("li:not(.vakata-separator)").first();c.length||(c=b.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").first());c.addClass("vakata-hover");a.stopImmediatePropagation();a.preventDefault()}}).bind("keydown","right",function(a){b.vakata.context.vis&&(b.vakata.context.cnt.find(".vakata-hover").children("ul").show().children("li:not(.vakata-separator)").removeClass("vakata-hover").first().addClass("vakata-hover"),a.stopImmediatePropagation(),a.preventDefault())}).bind("keydown","left",function(a){b.vakata.context.vis&&(b.vakata.context.cnt.find(".vakata-hover").children("ul").hide().children(".vakata-separator").removeClass("vakata-hover"),a.stopImmediatePropagation(),a.preventDefault())}).bind("keydown","esc",function(a){b.vakata.context.hide();a.preventDefault()}).bind("keydown","space",function(a){b.vakata.context.cnt.find(".vakata-hover").last().children("a").click();a.preventDefault()})});b.jstree.plugin("contextmenu",{__init:function(){this.get_container().delegate("a","contextmenu.jstree",b.proxy(function(a){a.preventDefault();this.show_contextmenu(a.currentTarget,a.pageX,a.pageY)},this)).bind("destroy.jstree",b.proxy(function(){this.data.contextmenu&&b.vakata.context.hide()},this));b(document).bind("context_hide.vakata",b.proxy(function(){this.data.contextmenu=!1},this))},defaults:{select_node:!1,show_at_node:!0,items:{create:{separator_before:!1,separator_after:!0,label:"Create",action:function(a){this.create(a)}},rename:{separator_before:!1,separator_after:!1,label:"Rename",action:function(a){this.rename(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,label:"Delete",action:function(a){this.remove(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(a){this.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){this.copy(a)}},paste:{separator_before:!1,icon:!1,separator_after:!1,label:"Paste",action:function(a){this.paste(a)}}}}}},_fn:{show_contextmenu:function(a,c,d){a=this._get_node(a);var e=this.get_settings().contextmenu,f=a.children("a:visible:eq(0)");e.select_node&&this.data.ui&&!this.is_selected(a)&&(this.deselect_all(),this.select_node(a,!0));if(e.show_at_node||"undefined"===typeof c||"undefined"===typeof d)d=f.offset(),c=d.left,d=d.top+this.data.core.li_height;b.isFunction(e.items)&&(e.items=e.items.call(this,a));this.data.contextmenu=!0;b.vakata.context.show(e.items,f,c,d,this,a);this.data.themes&&b.vakata.context.cnt.attr("class","jstree-"+this.data.themes.theme+"-context")}}})})(jQuery);(function(b){b.jstree.plugin("types",{__init:function(){var a=this._get_settings().types;this.data.types.attach_to=[];this.get_container().bind("init.jstree",b.proxy(function(){var c=a.type_attr,d="",e=this;b.each(a.types,function(a,g){b.each(g,function(a,b){/^(max_depth|max_children|icon|valid_children)$/.test(a)||e.data.types.attach_to.push(a)});if(!g.icon)return!0;if(g.icon.image||g.icon.position)d="default"==a?d+(".jstree-"+e.get_index()+" a \x3e .jstree-icon { "):d+(".jstree-"+e.get_index()+" li["+c+"\x3d"+a+"] \x3e a \x3e .jstree-icon { "),g.icon.image&&(d+=" background-image:url("+g.icon.image+"); "),d=g.icon.position?d+(" background-position:"+g.icon.position+"; "):d+" background-position:0 0; ",d+="} "});""!=d&&b.vakata.css.add_sheet({str:d})},this)).bind("before.jstree",b.proxy(function(a,d){if(-1!==b.inArray(d.func,this.data.types.attach_to)){var e=this._get_settings().types.types,f=this._get_type(d.args[0]);if((e[f]&&"undefined"!==typeof e[f][d.func]||e["default"]&&"undefined"!==typeof e["default"][d.func])&&!this._check(d.func,d.args[0]))return a.stopImmediatePropagation(),!1}},this))},defaults:{max_children:-1,max_depth:-1,valid_children:"all",type_attr:"rel",types:{"default":{max_children:-1,max_depth:-1,valid_children:"all"}}},_fn:{_get_type:function(a){return(a=this._get_node(a))&&a.length?a.attr(this._get_settings().types.type_attr)||"default":!1},set_type:function(a,b){b=this._get_node(b);return b.length&&a?b.attr(this._get_settings().types.type_attr,a):!1},_check:function(a,c,d){var e=!1,f=this._get_type(c),g=0,h=this,l=this._get_settings().types;if(-1===c)if(l[a])e=l[a];else return;else{if(!1===f)return;l.types[f]&&l.types[f][a]?e=l.types[f][a]:l.types["default"]&&l.types["default"][a]&&(e=l.types["default"][a])}b.isFunction(e)&&(e=e.call(this,c));"max_depth"===a&&-1!==c&&!1!==d&&-2!==l.max_depth&&0!==e&&this._get_node(c).children("a:eq(0)").parentsUntil(".jstree","li").each(function(b){if(-1!==l.max_depth&&0>=l.max_depth-(b+1))return e=0,!1;g=0===b?e:h._check(a,this,!1);if(-1!==g&&0>=g-(b+1))return e=0,!1;0<=g&&(g-(b+1)<e||0>e)&&(e=g-(b+1));0<=l.max_depth&&(l.max_depth-(b+1)<e||0>e)&&(e=l.max_depth-(b+1))});return e},check_move:function(){if(!this.__call_old())return!1;var a=this._get_move(),c=a.rt._get_settings().types,d=a.rt._check("max_children",a.cr),e=a.rt._check("max_depth",a.cr),f=a.rt._check("valid_children",a.cr),g=0,h=1;if("none"===f||b.isArray(f)&&a.ot&&a.ot._get_type&&(a.o.each(function(){if(-1===b.inArray(a.ot._get_type(this),f))return h=!1}),!1===h)||-2!==c.max_children&&-1!==d&&(g=-1===a.cr?this.get_container().children("\x3e ul \x3e li").not(a.o).length:a.cr.children("\x3e ul \x3e li").not(a.o).length,g+a.o.length>d))return!1;if(-2!==c.max_depth&&-1!==e){h=0;if(0===e)return!1;if("undefined"===typeof a.o.d){for(c=a.o;0<c.length;)c=c.find("\x3e ul \x3e li"),h++;a.o.d=h}if(0>e-a.o.d)return!1}return!0},create_node:function(a,c,d,e,f,g){if(!g&&(f||this._is_loaded(a))){var h=c&&c.match(/^before|after$/i)&&-1!==a?this._get_parent(a):this._get_node(a),l=this._get_settings().types,n=this._check("max_children",h),p=this._check("max_depth",h),k=this._check("valid_children",h);d||(d={});if("none"===k)return!1;if(b.isArray(k))if(!d.attr||!d.attr[l.type_attr])d.attr||(d.attr={}),d.attr[l.type_attr]=k[0];else if(-1===b.inArray(d.attr[l.type_attr],k))return!1;if(-2!==l.max_children&&-1!==n&&(h=-1===h?this.get_container().children("\x3e ul \x3e li").length:h.children("\x3e ul \x3e li").length,h+1>n)||-2!==l.max_depth&&-1!==p&&0>p-1)return!1}return this.__call_old(!0,a,c,d,e,f,g)}}})})(jQuery);(function(b){b.jstree.plugin("html_data",{__init:function(){this.data.html_data.original_container_html=this.get_container().find(" \x3e ul \x3e li").clone(!0);this.data.html_data.original_container_html.find("li").andSelf().contents().filter(function(){return 3==this.nodeType}).remove()},defaults:{data:!1,ajax:!1,correct_state:!0},_fn:{load_node:function(a,b,d){var e=this;this.load_node_html(a,function(){e.__callback({obj:a});b.call(this)},d)},_is_loaded:function(a){a=this._get_node(a);return-1==a||!a||!this._get_settings().html_data.ajax||a.is(".jstree-open, .jstree-leaf")||0<a.children("ul").children("li").size()},load_node_html:function(a,c,d){var e,f=this.get_settings().html_data,g=function(){};e=function(){};if((a=this._get_node(a))&&-1!==a){if(a.data("jstree-is-loading"))return;a.data("jstree-is-loading",!0)}switch(!0){case !f.data&&!f.ajax:a&&-1!=a||(this.get_container().children("ul").empty().append(this.data.html_data.original_container_html).find("li, a").filter(function(){return"INS"!==this.firstChild.tagName}).prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node());c&&c.call(this);break;case !!f.data&&!f.ajax||!!f.data&&!!f.ajax&&(!a||-1===a):a&&-1!=a||(e=b(f.data),e.is("ul")||(e=b("\x3cul\x3e").append(e)),this.get_container().children("ul").empty().append(e.children()).find("li, a").filter(function(){return"INS"!==this.firstChild.tagName}).prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node());c&&c.call(this);break;case !f.data&&!!f.ajax||!!f.data&&!!f.ajax&&a&&-1!==a:a=this._get_node(a),g=function(b,c,e){var g=this.get_settings().html_data.ajax.error;g&&g.call(this,b,c,e);-1!=a&&a.length?(a.children(".jstree-loading").removeClass("jstree-loading"),a.data("jstree-is-loading",!1),"success"===c&&f.correct_state&&a.removeClass("jstree-open jstree-closed").addClass("jstree-leaf")):"success"===c&&f.correct_state&&this.get_container().children("ul").empty();d&&d.call(this)},e=function(d,e,n){var p=this.get_settings().html_data.ajax.success;p&&(d=p.call(this,d,e,n)||d);if(""==d)return g.call(this,n,e,"");d?(d=b(d),d.is("ul")||(d=b("\x3cul\x3e").append(d)),-1!=a&&a?(a.children(".jstree-loading").removeClass("jstree-loading"),a.append(d).find("li, a").filter(function(){return"INS"!==this.firstChild.tagName}).prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),a.data("jstree-is-loading",!1)):this.get_container().children("ul").empty().append(d.children()).find("li, a").filter(function(){return"INS"!==this.firstChild.tagName}).prepend("\x3cins class\x3d'jstree-icon'\x3e\x26#160;\x3c/ins\x3e").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon"),this.clean_node(a),c&&c.call(this)):a&&-1!==a?(a.children(".jstree-loading").removeClass("jstree-loading"),a.data("jstree-is-loading",!1),f.correct_state&&(a.removeClass("jstree-open jstree-closed").addClass("jstree-leaf"),c&&c.call(this))):f.correct_state&&(this.get_container().children("ul").empty(),c&&c.call(this))},f.ajax.context=this,f.ajax.error=g,f.ajax.success=e,f.ajax.dataType||(f.ajax.dataType="html"),b.isFunction(f.ajax.url)&&(f.ajax.url=f.ajax.url.call(this,a)),b.isFunction(f.ajax.data)&&(f.ajax.data=f.ajax.data.call(this,a)),b.ajax(f.ajax)}}}});b.jstree.defaults.plugins.push("html_data")})(jQuery);(function(b){b.jstree.plugin("themeroller",{__init:function(){var a=this._get_settings().themeroller;this.get_container().addClass("ui-widget-content").delegate("a","mouseenter.jstree",function(){b(this).addClass(a.item_h)}).delegate("a","mouseleave.jstree",function(){b(this).removeClass(a.item_h)}).bind("open_node.jstree create_node.jstree",b.proxy(function(a,b){this._themeroller(b.rslt.obj)},this)).bind("loaded.jstree refresh.jstree",b.proxy(function(a){this._themeroller()},this)).bind("close_node.jstree",b.proxy(function(b,d){d.rslt.obj.children("ins").removeClass(a.opened).addClass(a.closed)},this)).bind("select_node.jstree",b.proxy(function(b,d){d.rslt.obj.children("a").addClass(a.item_a)},this)).bind("deselect_node.jstree deselect_all.jstree",b.proxy(function(b,d){this.get_container().find("."+a.item_a).removeClass(a.item_a).end().find(".jstree-clicked").addClass(a.item_a)},this)).bind("move_node.jstree",b.proxy(function(a,b){this._themeroller(b.rslt.o)},this))},__destroy:function(){var a=this._get_settings().themeroller,c=["ui-icon"];b.each(a,function(a,b){b=b.split(" ");b.length&&(c=c.concat(b))});this.get_container().removeClass("ui-widget-content").find("."+c.join(", .")).removeClass(c.join(" "))},_fn:{_themeroller:function(a){var b=this._get_settings().themeroller;a=a&&-1!=a?this._get_node(a).parent():this.get_container();a.find("li.jstree-closed \x3e ins.jstree-icon").removeClass(b.opened).addClass("ui-icon "+b.closed).end().find("li.jstree-open \x3e ins.jstree-icon").removeClass(b.closed).addClass("ui-icon "+b.opened).end().find("a").addClass(b.item).children("ins.jstree-icon").addClass("ui-icon "+b.item_icon)}},defaults:{opened:"ui-icon-triangle-1-se",closed:"ui-icon-triangle-1-e",item:"ui-state-default",item_h:"ui-state-hover",item_a:"ui-state-active",item_icon:"ui-icon-folder-collapsed"}});b(function(){b.vakata.css.add_sheet({str:".jstree .ui-icon { overflow:visible; } .jstree a { padding:0 2px; }"})})})(jQuery);(function(b){b.jstree.plugin("unique",{__init:function(){this.get_container().bind("before.jstree",b.proxy(function(a,c){var d=[],e=!0,f;"move_node"==c.func&&!0===c.args[4]&&c.args[0].o&&c.args[0].o.length&&(c.args[0].o.children("a").each(function(){d.push(b(this).text().replace(/^\s+/g,""))}),e=this._check_unique(d,c.args[0].np.find("\x3e ul \x3e li").not(c.args[0].o)));"create_node"==c.func&&(c.args[4]||this._is_loaded(c.args[0]))&&(e=this._get_node(c.args[0]),!c.args[1]||"before"!==c.args[1]&&"after"!==c.args[1]||(e=this._get_parent(c.args[0]))&&-1!==e||(e=this.get_container()),"string"===typeof c.args[2]?d.push(c.args[2]):c.args[2]&&c.args[2].data?d.push(c.args[2].data):d.push(this._get_settings().core.strings.new_node),e=this._check_unique(d,e.find("\x3e ul \x3e li")));"rename_node"==c.func&&(d.push(c.args[1]),f=this._get_node(c.args[0]),(e=this._get_parent(f))&&-1!==e||(e=this.get_container()),e=this._check_unique(d,e.find("\x3e ul \x3e li").not(f)));if(!e)return a.stopPropagation(),!1},this))},_fn:{_check_unique:function(a,c){var d=[];c.children("a").each(function(){d.push(b(this).text().replace(/^\s+/g,""))});if(!d.length||!a.length)return!0;d=d.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",");return d.length+a.length!=d.concat(a).sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g,"$1$2$4").replace(/,,+/g,",").replace(/,$/,"").split(",").length?!1:!0},check_move:function(){if(!this.__call_old())return!1;var a=this._get_move(),c=[];return a.o&&a.o.length?(a.o.children("a").each(function(){c.push(b(this).text().replace(/^\s+/g,""))}),this._check_unique(c,a.np.find("\x3e ul \x3e li").not(a.o))):!0}}})})(jQuery);
</script>