<!-- jstree与jquery.jstree.js 有冲突 该页暂时不做pjax请求 研究结果：后期从jquery指定js方法入手 -->
#if($!session.getAttribute("HTTP_X_PJAX") == "true")
	#set($layout="/sys/role.vm")
	$session.setAttribute("HTTP_X_PJAX","false")
#end
<!-- TableSorter -->
<div id="panel-tablesorter" class="panel panel-default">
	<input type="hidden" id="pageFlag" value="role"/>
    <div class="panel-heading bg-white">
        <div class="panel-actions" >
            <button  title="refresh" class="btn-panel" onclick="refresh();" id="refresh">
                <i class="fa fa-refresh"></i>
            </button>
            <button data-expand="#panel-tablesorter" title="expand" class="btn-panel">
                <i class="fa fa-expand"></i>
            </button>
            <button data-collapse="#panel-tablesorter" title="collapse" class="btn-panel">
                <i class="fa fa-caret-down"></i>
            </button>
            <button data-close="#panel-tablesorter" title="close" class="btn-panel">
                <i class="fa fa-times"></i>
            </button>
        </div><!-- /panel-actions -->
        <h3 class="panel-title">&nbsp;</h3>
    </div><!-- /panel-heading -->
    <div class="panel-body">
        <div class="row">
    		<div class="col-xs-12">
    			<div class="pull-right">
    				<button type="button" class="btn btn-success" id="btnAdd" onclick="accessAddModule();"
						data-toggle="modal" href="#editModal">
						添加 <i class="fa fa-plus"></i></button>
        			<button type="button" class="btn btn-success" id="btnEdit" onclick="accessEditModule();"
						data-toggle="modal" href="#editModal">
						修改角色 <i class="fa fa-edit"></i></button>
					<button type="button" class="btn btn-success" id="btnAuth" onclick="accessAuthModule();"
						data-toggle="modal" href="#authModal">
						编辑权限 <i class="fa fa-sitemap"></i></button>
        			<button type="button" class="btn btn-success" id="btnDel" onclick="doDel();">
						删除 <i class="fa fa-times"></i></button>
                </div>
    		</div>
			<div class="col-xs-12" style="height: 10px;">
			</div>
    	</div>
        <div class="table-responsive table-responsive-datatables">
        	<table class="tablesorter table table-hover table-bordered">
				<thead>
					<tr>
						<th style="text-align:center;">角色ID</th>
						<th style="text-align:center;">角色名称</th>
						<th style="text-align:center;">录入人</th>
						<th style="text-align:center;">录入时间</th>
						<th style="text-align:center;">变更人</th>
						<th style="text-align:center;">变更时间</th>
					</tr>
				</thead><!--/thead-->
				<tbody>
                </tbody>
				<tfoot>
                    <tr>
                        <th colspan="6" class="ts-pager form-horizontal">
                            #parse("/layout/page.vm")
                        </th>
                    </tr>
                </tfoot><!--/tfoot-->
			</table><!--/table tools-->
        </div><!--/table-responsive-->
		<form id="editModal" data-validate="form" class="modal fade" tabindex="-1">
			<input type="hidden" name="roleId"/>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title"><strong></strong></h4>
					</div>
					<div class="modal-body">
						<div class="form-horizontal">
							<div class="form-group">
								<label class="col-sm-3 control-label" for="name">角色名称:</label> 
    							<div class="col-sm-7">
    								<input class="form-control" type="text" name="roleName" required maxlength="32"/>
								</div>
                            </div>
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-cloud" data-dismiss="modal" >
							 取消 <i class="fa fa-mail-reply"></i>
						</button>
						<button class="btn btn-success" type="button">
							 保存 <i class="fa fa-check"></i>
						</button>
					</div>
				</div>
			</div>
		</form>
		<form id="authModal" data-validate="form" class="modal fade" tabindex="-1">
			<input type="hidden" name="roleId"/>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title"><strong>编辑角色权限</strong></h4>
					</div>
					<div class="modal-body">
                        <div class="form-horizontal" id="jstree2"></div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-cloud" data-dismiss="modal" >
							 取消 <i class="fa fa-mail-reply"></i>
						</button>
						<button class="btn btn-success" type="button" onclick="saveAuth();">
							 保存 <i class="fa fa-check"></i>
						</button>
					</div>
				</div>
			</div>
		</form>
	</div><!--/panel-body-->
</div><!--/panel-tablesorter-->
<link href="$request.getContextPath()/stilearn2.0/scripts/custom/themes/default/style.min.css" rel="stylesheet">
<script type="text/javascript">
globleUrl = "$request.getContextPath()/sys/role/";
title = "系统角色";

// 编辑窗口数据初始化-回调函数
function editInitCallBack(msg){
	$("#editModal input[name='roleId']").val(msg.roleId);
	$("#editModal input[name='roleName']").val(msg.roleName);
}

// 删除准备数据
function delDate(){
	var idArr=[];
	$("table.tablesorter tbody tr").each(function(){
		if($(this).find("td:eq(0)").css("background-color") == colorRgb){
			var id = $(this).find("td:eq(0)").text();
			var name = $(this).find("td:eq(1)").text();
			idArr.push({"id":id,"name":name});
		}
	});
	return idArr;
}

// 取得菜单权限数据
function accessAuthModule(){
	var id = "";
	$("table.tablesorter tbody tr").each(function(){
		if($(this).find("td:eq(0)").css("background-color") == colorRgb){
			id = $(this).children().eq(0).text();
			$("#authModal input[name='roleId']").val(id);
			return false;//退出循环
		}
	});
	var url = globleUrl + "auth/data/"+ id +".shtml";
	AjaxGet(url,{},function(msg){
		$('#jstree2').data('jstree', false);
		$('#jstree2').jstree({'plugins':["wholerow","checkbox"], 'core' : {
			'data' :jQuery.parseJSON(msg) // json转json对象;若是对象转json则JSON.stringify(xxxx);
		}});
	}); 
}
// 保存角色权限
function saveAuth(){
	var roleId = $("#authModal input[name='roleId']").val();
	var selectIds = $("#jstree2").jstree("get_selected");
	// 获取半选的父节点ID
	var halfSel = "";
	$(".jstree-undetermined").each(function(){
		halfSel = halfSel + "," + $(this).parent().parent().attr("id");
	});
	// 统计选中的节点
	var menuIds = "";
	for ( var i = 0; i < selectIds.length; i++) {
		menuIds = menuIds + "," + selectIds[i];
	}
	// 统计全部选中的节点(完全选中+半选)
	menuIds = menuIds + halfSel;
	if(menuIds.length>0){
		menuIds = menuIds.substring(1);
	}
	AjaxPost(globleUrl + "auth/update.shtml",{"menuIds":menuIds,"roleId":roleId},function(msg){
		$("#authModal").modal("hide");
    	bootbox.alert(msg);
	});
}

// 压缩版的jstree.js 有部分修改
/*globals jQuery, define, exports, require, window, document */(function(h){"function"===typeof define&&define.amd?define(["jquery"],h):"object"===typeof exports?h(require("jquery")):h(jQuery)})(function(h,q){var M=0,z=!1,y=!1,F=!1,J=[],H=h("script:last").attr("src"),C=document,G=C.createElement("LI"),A;G.setAttribute("role","treeitem");A=C.createElement("I");A.className="jstree-icon jstree-ocl";G.appendChild(A);A=C.createElement("A");A.className="jstree-anchor";A.setAttribute("href","#");C=C.createElement("I");C.className="jstree-icon jstree-themeicon";A.appendChild(C);G.appendChild(A);A=C=null;h.jstree={version:"3.0.0",defaults:{plugins:[]},plugins:{},path:H&&-1!==H.indexOf("/")?H.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&'".,=\- \/]/g};h.jstree.create=function(a,b){var c=new h.jstree.core(++M),f=b;b=h.extend(!0,{},h.jstree.defaults,b);f&&f.plugins&&(b.plugins=f.plugins);h.each(b.plugins,function(a,f){"core"!==a&&(c=c.plugin(f,b[f]))});c.init(a,b);return c};h.jstree.core=function(a){this._id=a;this._cnt=0;this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{}}}};h.jstree.reference=function(a){var b=null,c=null;a&&a.id&&(a=a.id);if(!c||!c.length)try{c=h(a)}catch(f){}if(!c||!c.length)try{c=h("#"+a.replace(h.jstree.idregex,"\\$\x26"))}catch(f){}c&&c.length&&(c=c.closest(".jstree")).length&&(c=c.data("jstree"))?b=c:h(".jstree").each(function(){var c=h(this).data("jstree");if(c&&c._model.data[a])return b=c,!1});return b};h.fn.jstree=function(a){var b="string"===typeof a,c=Array.prototype.slice.call(arguments,1),f=null;this.each(function(){var d=h.jstree.reference(this),e=b&&d?d[a]:null;f=b&&e?e.apply(d,c):null;d||b||a!==q&&!h.isPlainObject(a)||h(this).data("jstree",new h.jstree.create(this,a));if(d&&!b||!0===a)f=d||!1;if(null!==f&&f!==q)return!1});return null!==f&&f!==q?f:this};h.expr[":"].jstree=h.expr.createPseudo(function(a){return function(a){return h(a).hasClass("jstree")&&h(a).data("jstree")!==q}});h.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:h.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!0},expand_selected_onload:!0};h.jstree.core.prototype={plugin:function(a,b){var c=h.jstree.plugins[a];return c?(this._data[a]={},c.prototype=this,new c(b,this)):this},init:function(a,b){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this.element=h(a).addClass("jstree jstree-"+this._id);this.settings=b;this.element.bind("destroyed",h.proxy(this.teardown,this));this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" \x3e ul \x3e li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();this.element.html("\x3cul class\x3d'jstree-container-ul'\x3e\x3cli class\x3d'jstree-initial-node jstree-loading jstree-leaf jstree-last'\x3e\x3ci class\x3d'jstree-icon jstree-ocl'\x3e\x3c/i\x3e\x3ca class\x3d'jstree-anchor' href\x3d'#'\x3e\x3ci class\x3d'jstree-icon jstree-themeicon-hidden'\x3e\x3c/i\x3e"+this.get_string("Loading ...")+"\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e");this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||18;this.trigger("loading");this.load_node("#")},destroy:function(){this.element.unbind("destroyed",this.teardown);this.teardown()},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^\x3d'jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(b){}}}).on("click.jstree",".jstree-ocl",h.proxy(function(a){this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",h.proxy(function(a){a.preventDefault();h(a.currentTarget).focus();this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",h.proxy(function(a){if("INPUT"===a.target.tagName)return!0;var b=null;switch(a.which){case 13:case 32:a.type="click";h(a.currentTarget).trigger(a);break;case 37:a.preventDefault();this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(b=this.get_prev_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 38:a.preventDefault();(b=this.get_prev_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 39:a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):(b=this.get_next_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 40:a.preventDefault();(b=this.get_next_dom(a.currentTarget))&&b.length&&b.children(".jstree-anchor").focus();break;case 46:a.preventDefault();(b=this.get_node(a.currentTarget))&&b.id&&"#"!==b.id&&(b=this.is_selected(b)?this.get_selected():b);break;case 113:a.preventDefault(),b=this.get_node(a.currentTarget)}},this)).on("load_node.jstree",h.proxy(function(a,b){if(b.status&&("#"!==b.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){this._data.core.ready=!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var c=[],f,d;f=0;for(d=this._data.core.selected.length;f<d;f++)c=c.concat(this._model.data[this._data.core.selected[f]].parents);c=h.vakata.array_unique(c);f=0;for(d=c.length;f<d;f++)this.open_node(c[f],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(h.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",h.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots;this._data.core.themes.stripes=a.stripes;this._data.core.themes.icons=a.icons;this.set_theme(a.name||"default",a.url);this.set_theme_variant(a.variant)},this)).on("loading.jstree",h.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("focus.jstree",".jstree-anchor",h.proxy(function(a){this.element.find(".jstree-hovered").not(a.currentTarget).mouseleave();h(a.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",h.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",h.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree");h(document).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={});b.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children("ul:eq(0)")},get_string:function(a){var b=this.settings.core.strings;return h.isFunction(b)?b.call(this,a):b&&b[a]?b[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,b){a&&a.id&&(a=a.id);var c;try{if(this._model.data[a])a=this._model.data[a];else if(((c=h(a,this.element)).length||(c=h("#"+a.replace(h.jstree.idregex,"\\$\x26"),this.element)).length)&&this._model.data[c.closest("li").attr("id")])a=this._model.data[c.closest("li").attr("id")];else if((c=h(a,this.element)).length&&c.hasClass("jstree"))a=this._model.data["#"];else return!1;b&&(a="#"===a.id?this.element:h("#"+a.id.replace(h.jstree.idregex,"\\$\x26"),this.element));return a}catch(f){return!1}},get_path:function(a,b,c){a=a.parents?a:this.get_node(a);if(!a||"#"===a.id||!a.parents)return!1;var f,d,e=[];e.push(c?a.id:a.text);f=0;for(d=a.parents.length;f<d;f++)e.push(c?a.parents[f]:this.get_text(a.parents[f]));e=e.reverse().slice(1);return b?e.join(b):e},get_next_dom:function(a,b){var c;a=this.get_node(a,!0);return a[0]===this.element[0]?(c=this._firstChild(this.get_container_ul()[0]))?h(c):!1:a&&a.length?b?(c=this._nextSibling(a[0]))?h(c):!1:a.hasClass("jstree-open")?(c=this._firstChild(a.children("ul")[0]))?h(c):!1:null!==(c=this._nextSibling(a[0]))?h(c):a.parentsUntil(".jstree","li").next("li").eq(0):!1},get_prev_dom:function(a,b){var c;a=this.get_node(a,!0);if(a[0]===this.element[0])return(c=this.get_container_ul()[0].lastChild)?h(c):!1;if(!a||!a.length)return!1;if(b)return(c=this._previousSibling(a[0]))?h(c):!1;if(null!==(c=this._previousSibling(a[0]))){for(a=h(c);a.hasClass("jstree-open");)a=a.children("ul:eq(0)").children("li:last");return a}return(c=a[0].parentNode.parentNode)&&"LI"===c.tagName?h(c):!1},get_parent:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,!0);return a[0]===this.element[0]?this.get_container_ul().children("li"):a&&a.length?a.children("ul").children("li"):!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,b){var c,f,d,e,g;if(h.isArray(a)){a=a.slice();c=0;for(f=a.length;c<f;c++)this.load_node(a[c],b);return!0}a=this.get_node(a);if(!a)return b&&b.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;c=0;for(f=a.children_d.length;c<f;c++){d=0;for(e=a.parents.length;d<e;d++)this._model.data[a.parents[d]].children_d=h.vakata.array_remove_item(this._model.data[a.parents[d]].children_d,a.children_d[c]);this._model.data[a.children_d[c]].state.selected&&(g=!0,this._data.core.selected=h.vakata.array_remove_item(this._data.core.selected,a.children_d[c]));delete this._model.data[a.children_d[c]]}a.children=[];a.children_d=[];g&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading");this._load_node(a,h.proxy(function(c){a.state.loading=!1;a.state.loaded=c;var f=this.get_node(a,!0);a.state.loaded&&!a.children.length&&f&&f.length&&!f.hasClass("jstree-leaf")&&f.removeClass("jstree-closed jstree-open").addClass("jstree-leaf");f.removeClass("jstree-loading");this.trigger("load_node",{node:a,status:c});b&&b.call(this,a,c)},this));return!0},_load_nodes:function(a,b,c){var f=!0,d=function(){this._load_nodes(a,b,!0)},e=this._model.data,g,h;g=0;for(h=a.length;g<h;g++)!e[a[g]]||e[a[g]].state.loaded&&c||(this.is_loading(a[g])||this.load_node(a[g],d),f=!1);f&&!b.done&&(b.call(this,a),b.done=!0)},_load_node:function(a,b){var c=this.settings.core.data;if(!c)return b.call(this,"#"===a.id?this._append_html_data(a,this._data.core.original_container_html.clone(!0)):!1);if(h.isFunction(c))return c.call(this,a,h.proxy(function(c){return!1===c?b.call(this,!1):b.call(this,this["string"===typeof c?"_append_html_data":"_append_json_data"](a,"string"===typeof c?h(c):c))},this));if("object"===typeof c){if(c.url)return c=h.extend(!0,{},c),h.isFunction(c.url)&&(c.url=c.url.call(this,a)),h.isFunction(c.data)&&(c.data=c.data.call(this,a)),h.ajax(c).done(h.proxy(function(c,d,e){d=e.getResponseHeader("Content-Type");if(-1!==d.indexOf("json")||"object"===typeof c)return b.call(this,this._append_json_data(a,c));if(-1!==d.indexOf("html")||"string"===typeof c)return b.call(this,this._append_html_data(a,h(c)));this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:e})};return b.call(this,!1)},this)).fail(h.proxy(function(c){b.call(this,!1);this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:c})};this.settings.core.error.call(this,this._data.core.last_error)},this));c=h.isArray(c)||h.isPlainObject(c)?JSON.parse(JSON.stringify(c)):c;"#"!==a.id&&(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})});return b.call(this,"#"===a.id?this._append_json_data(a,c):!1)}return"string"===typeof c?("#"!==a.id&&(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})}),b.call(this,"#"===a.id?this._append_html_data(a,h(c)):!1)):b.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&this._model.changed.push(a.id)},_append_html_data:function(a,b){a=this.get_node(a);a.children=[];a.children_d=[];var c=b.is("ul")?b.children():b,f=a.id,d=[],e=[],g=this._model.data,m=g[f],k=this._data.core.selected.length,l,n;c.each(h.proxy(function(a,c){if(l=this._parse_model_from_html(h(c),f,m.parents.concat()))d.push(l),e.push(l),g[l].children_d.length&&(e=e.concat(g[l].children_d))},this));m.children=d;m.children_d=e;c=0;for(n=m.parents.length;c<n;c++)g[m.parents[c]].children_d=g[m.parents[c]].children_d.concat(e);this.trigger("model",{nodes:e,parent:f});"#"!==f?(this._node_changed(f),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0));this._data.core.selected.length!==k&&this.trigger("changed",{action:"model",selected:this._data.core.selected});return!0},_append_json_data:function(a,b){a=this.get_node(a);a.children=[];a.children_d=[];var c=b,f=a.id,d=[],e=[],g=this._model.data,m=g[f],k=this._data.core.selected.length,l,n,p;c.d&&(c=c.d,"string"===typeof c&&(c=JSON.parse(c)));h.isArray(c)||(c=[c]);if(c.length&&c[0].id!==q&&c[0].parent!==q){n=0;for(p=c.length;n<p;n++)c[n].children||(c[n].children=[]),g[c[n].id.toString()]=c[n];n=0;for(p=c.length;n<p;n++)g[c[n].parent.toString()].children.push(c[n].id.toString()),m.children_d.push(c[n].id.toString());n=0;for(p=m.children.length;n<p;n++)l=this._parse_model_from_flat_json(g[m.children[n]],f,m.parents.concat()),e.push(l),g[l].children_d.length&&(e=e.concat(g[l].children_d))}else{n=0;for(p=c.length;n<p;n++)if(l=this._parse_model_from_json(c[n],f,m.parents.concat()))d.push(l),e.push(l),g[l].children_d.length&&(e=e.concat(g[l].children_d));m.children=d;m.children_d=e;n=0;for(p=m.parents.length;n<p;n++)g[m.parents[n]].children_d=g[m.parents[n]].children_d.concat(e)}this.trigger("model",{nodes:e,parent:f});"#"!==f?(this._node_changed(f),this.redraw()):this.redraw(!0);this._data.core.selected.length!==k&&this.trigger("changed",{action:"model",selected:this._data.core.selected});return!0},_parse_model_from_html:function(a,b,c){c=c?[].concat(c):[];b&&c.unshift(b);var f,d,e=this._model.data,g={id:!1,text:!1,icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},m;for(m in this._model.default_state)this._model.default_state.hasOwnProperty(m)&&(g.state[m]=this._model.default_state[m]);b=h.vakata.attributes(a,!0);h.each(b,function(a,c){c=h.trim(c);if(!c.length)return!0;g.li_attr[a]=c;"id"===a&&(g.id=c.toString())});b=a.children("a").eq(0);b.length&&(b=h.vakata.attributes(b,!0),h.each(b,function(a,c){c=h.trim(c);c.length&&(g.a_attr[a]=c)}));b=a.children("a:eq(0)").length?a.children("a:eq(0)").clone():a.clone();b.children("ins, i, ul").remove();b=b.html();b=h("\x3cdiv /\x3e").html(b);g.text=b.html();b=a.data();g.data=b?h.extend(!0,{},b):null;g.state.opened=a.hasClass("jstree-open");g.state.selected=a.children("a").hasClass("jstree-clicked");g.state.disabled=a.children("a").hasClass("jstree-disabled");if(g.data&&g.data.jstree)for(m in g.data.jstree)g.data.jstree.hasOwnProperty(m)&&(g.state[m]=g.data.jstree[m]);b=a.children("a").children(".jstree-themeicon");b.length&&(g.icon=b.hasClass("jstree-themeicon-hidden")?!1:b.attr("rel"));g.state.icon&&(g.icon=g.state.icon);b=a.children("ul").children("li");do m="j"+this._id+"_"+ ++this._cnt;while(e[m]);g.id=g.li_attr.id?g.li_attr.id.toString():m;b.length?(b.each(h.proxy(function(a,b){f=this._parse_model_from_html(h(b),g.id,c);d=this._model.data[f];g.children.push(f);d.children_d.length&&(g.children_d=g.children_d.concat(d.children_d))},this)),g.children_d=g.children_d.concat(g.children)):a.hasClass("jstree-closed")&&(g.state.loaded=!1);g.li_attr["class"]&&(g.li_attr["class"]=g.li_attr["class"].replace("jstree-closed","").replace("jstree-open",""));g.a_attr["class"]&&(g.a_attr["class"]=g.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",""));e[g.id]=g;g.state.selected&&this._data.core.selected.push(g.id);return g.id},_parse_model_from_flat_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var f=a.id.toString(),d=this._model.data,e=this._model.default_state,g,h;b={id:f,text:a.text||"",icon:a.icon!==q?a.icon:!0,parent:b,parents:c,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in e)e.hasOwnProperty(g)&&(b.state[g]=e[g]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(b.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(b.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&(b.li_attr[g]=a.li_attr[g]);b.li_attr.id||(b.li_attr.id=f);if(a&&"object"===typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&(b.a_attr[g]=a.a_attr[g]);a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);d[b.id]=b;g=0;for(f=b.children.length;g<f;g++)e=this._parse_model_from_flat_json(d[b.children[g]],b.id,c),h=d[e],b.children_d.push(e),h.children_d.length&&(b.children_d=b.children_d.concat(h.children_d));delete a.data;delete a.children;d[b.id].original=a;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_parse_model_from_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var f,d,e,g,h=this._model.data;e=this._model.default_state;do f="j"+this._id+"_"+ ++this._cnt;while(h[f]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==q?a.icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(d in e)e.hasOwnProperty(d)&&(b.state[d]=e[d]);a&&a.id&&(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(a&&a.data&&(b.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&(b.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&(b.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&(b.li_attr[d]=a.li_attr[d]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=f);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(b.a_attr[d]=a.a_attr[d]);if(a&&a.children&&a.children.length){d=0;for(f=a.children.length;d<f;d++)e=this._parse_model_from_json(a.children[d],b.id,c),g=h[e],b.children.push(e),g.children_d.length&&(b.children_d=b.children_d.concat(g.children_d));b.children_d=b.children_d.concat(b.children)}a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;h[b.id]=b;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),b=document.createElement("UL"),c,f,d;f=0;for(d=a.length;f<d;f++)(c=this.redraw_node(a[f],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&b.appendChild(c);this._model.force_full_redraw&&(b.className=this.get_container_ul()[0].className,this.element.empty().append(b));this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=!0);this._redraw()},redraw_node:function(a,b,c){var f=this.get_node(a),d=!1,e=!1,g=!1,m=!1,k=!1,l=!1,l="",n=document,p=this._model.data,r=!1,u=!1;if(!f)return!1;if("#"===f.id)return this.redraw(!0);b=b||0===f.children.length;if(a=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(f.id[0])?"\\3"+f.id[0]+" "+f.id.substr(1).replace(h.jstree.idregex,"\\$\x26"):f.id.replace(h.jstree.idregex,"\\$\x26"))):document.getElementById(f.id))a=h(a),c||(d=a.parent().parent()[0],d===this.element[0]&&(d=null),e=a.index()),b||!f.children.length||a.children("ul").length||(b=!0),b||(g=a.children("UL")[0]),u=a.attr("aria-selected"),r=a.children(".jstree-anchor")[0]===document.activeElement,a.remove();else if(b=!0,!c){d="#"!==f.parent?h("#"+f.parent.replace(h.jstree.idregex,"\\$\x26"),this.element)[0]:null;if(!(null===d||d&&p[f.parent].state.opened))return!1;e=h.inArray(f.id,null===d?p["#"].children:p[f.parent].children)}a=G.cloneNode(!0);l="jstree-node ";for(m in f.li_attr)f.li_attr.hasOwnProperty(m)&&"id"!==m&&("class"!==m?a.setAttribute(m,f.li_attr[m]):l+=f.li_attr[m]);u&&"false"!==u&&a.setAttribute("aria-selected",!0);f.state.loaded&&!f.children.length?l+=" jstree-leaf":(l+=f.state.opened&&f.state.loaded?" jstree-open":" jstree-closed",a.setAttribute("aria-expanded",f.state.opened&&f.state.loaded));null!==f.parent&&p[f.parent].children[p[f.parent].children.length-1]===f.id&&(l+=" jstree-last");a.id=f.id;a.className=l;l=(f.state.selected?" jstree-clicked":"")+(f.state.disabled?" jstree-disabled":"");for(k in f.a_attr)!f.a_attr.hasOwnProperty(k)||"href"===k&&"#"===f.a_attr[k]||("class"!==k?a.childNodes[1].setAttribute(k,f.a_attr[k]):l+=" "+f.a_attr[k]);l.length&&(a.childNodes[1].className="jstree-anchor "+l);if(f.icon&&!0!==f.icon||!1===f.icon)!1===f.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===f.icon.indexOf("/")&&-1===f.icon.indexOf(".")?a.childNodes[1].childNodes[0].className+=" "+f.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage="url("+f.icon+")",a.childNodes[1].childNodes[0].style.backgroundPosition="center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");a.childNodes[1].innerHTML+=f.text;if(b&&f.children.length&&f.state.opened&&f.state.loaded){l=n.createElement("UL");l.setAttribute("role","group");l.className="jstree-children";m=0;for(k=f.children.length;m<k;m++)l.appendChild(this.redraw_node(f.children[m],b,!0));a.appendChild(l)}g&&a.appendChild(g);c||(d||(d=this.element[0]),d.getElementsByTagName("UL").length?d=d.getElementsByTagName("UL")[0]:(m=n.createElement("UL"),m.setAttribute("role","group"),m.className="jstree-children",d.appendChild(m),d=m),e<d.childNodes.length?d.insertBefore(a,d.childNodes[e]):d.appendChild(a),r&&a.childNodes[1].focus());f.state.opened&&!f.state.loaded&&(f.state.opened=!1,setTimeout(h.proxy(function(){this.open_node(f.id,!1,0)},this),0));return a},open_node:function(a,b,c){var f,d,e;if(h.isArray(a)){a=a.slice();f=0;for(d=a.length;f<d;f++)this.open_node(a[f],b,c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=c===q?this.settings.core.animation:c;if(!this.is_closed(a))return b&&b.call(this,a,!1),!1;if(this.is_loaded(a))f=this.get_node(a,!0),e=this,f.length&&(a.children.length&&!this._firstChild(f.children("ul")[0])&&(a.state.opened=!0,this.redraw_node(a,!0),f=this.get_node(a,!0)),c?(this.trigger("before_open",{node:a}),f.children("ul").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children("ul").stop(!0,!0).slideDown(c,function(){this.style.display="";e.trigger("after_open",{node:a})})):(this.trigger("before_open",{node:a}),f[0].className=f[0].className.replace("jstree-closed","jstree-open"),f[0].setAttribute("aria-expanded",!0))),a.state.opened=!0,b&&b.call(this,a,!0),f.length||this.trigger("before_open",{node:a}),this.trigger("open_node",{node:a}),c&&f.length||this.trigger("after_open",{node:a});else{if(this.is_loading(a))return setTimeout(h.proxy(function(){this.open_node(a,b,c)},this),500);this.load_node(a,function(a,f){return f?this.open_node(a,b,c):b?b.call(this,a,!1):!1})}},_open_to:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b,c,f=a.parents;b=0;for(c=f.length;b<c;b+=1)"#"!==b&&this.open_node(f[b],!1,0);return h("#"+a.id.replace(h.jstree.idregex,"\\$\x26"),this.element)},close_node:function(a,b){var c,f,d,e;if(h.isArray(a)){a=a.slice();c=0;for(f=a.length;c<f;c++)this.close_node(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id||this.is_closed(a))return!1;b=b===q?this.settings.core.animation:b;d=this;e=this.get_node(a,!0);e.length&&(b?e.children("ul").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children("ul").stop(!0,!0).slideUp(b,function(){this.style.display="";e.children("ul").remove();d.trigger("after_close",{node:a})}):(e[0].className=e[0].className.replace("jstree-open","jstree-closed"),e.attr("aria-expanded",!1).children("ul").remove()));a.state.opened=!1;this.trigger("close_node",{node:a});b&&e.length||this.trigger("after_close",{node:a})},toggle_node:function(a){var b,c;if(h.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.toggle_node(a[b]);return!0}if(this.is_closed(a))return this.open_node(a);if(this.is_open(a))return this.close_node(a)},open_all:function(a,b,c){a||(a="#");a=this.get_node(a);if(!a)return!1;var f="#"===a.id?this.get_container_ul():this.get_node(a,!0),d,e;if(!f.length){f=0;for(d=a.children_d.length;f<d;f++)this.is_closed(this._model.data[a.children_d[f]])&&(this._model.data[a.children_d[f]].state.opened=!0);return this.trigger("open_all",{node:a})}c=c||f;e=this;f=this.is_closed(a)?f.find("li.jstree-closed").addBack():f.find("li.jstree-closed");f.each(function(){e.open_node(this,function(a,f){f&&this.is_parent(a)&&this.open_all(a,b,c)},b||0)});0===c.find("li.jstree-closed").length&&this.trigger("open_all",{node:this.get_node(c)})},close_all:function(a,b){a||(a="#");a=this.get_node(a);if(!a)return!1;var c="#"===a.id?this.get_container_ul():this.get_node(a,!0),f=this,d;if(!c.length){c=0;for(d=a.children_d.length;c<d;c++)this._model.data[a.children_d[c]].state.opened=!1;return this.trigger("close_all",{node:a})}c=this.is_open(a)?c.find("li.jstree-open").addBack():c.find("li.jstree-open");h(c.get().reverse()).each(function(){f.close_node(this,b||0)});this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var b,c;if(h.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.enable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled");this.trigger("enable_node",{node:a})},disable_node:function(a){var b,c;if(h.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.disable_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.state.disabled=!0;this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled");this.trigger("disable_node",{node:a})},activate_node:function(a,b){if(this.is_disabled(a))return!1;this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==q?this.get_node(this._data.core.last_clicked.id):null;this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&(!b.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(b.shiftKey){var c=this.get_node(a).id,f=this._data.core.last_clicked.id,d=this.get_node(this._data.core.last_clicked.parent).children,e=!1,g,h;g=0;for(h=d.length;g<h;g+=1)d[g]===c&&(e=!e),d[g]===f&&(e=!e),e||d[g]===c||d[g]===f?this.select_node(d[g],!1,!1,b):this.deselect_node(d[g],!1,!1,b)}else this.is_selected(a)?this.deselect_node(a,!1,!1,b):this.select_node(a,!1,!1,b);else!this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&this.is_selected(a)?this.deselect_node(a,!1,!1,b):(this.deselect_all(!0),this.select_node(a,!1,!1,b),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a)})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b);a.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(a)});setTimeout(function(){c.attr("aria-activedescendant",a[0].id);a.attr("aria-selected",!0)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,b,c,f){var d,e;if(h.isArray(a)){a=a.slice();d=0;for(e=a.length;d<e;d++)this.select_node(a[d],b,c,f);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;d=this.get_node(a,!0);a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),c||(d=this._open_to(a)),d&&d.length&&d.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:f}),b||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:f}))},deselect_node:function(a,b,c){var f,d;if(h.isArray(a)){a=a.slice();f=0;for(d=a.length;f<d;f++)this.deselect_node(a[f],b,c);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;f=this.get_node(a,!0);a.state.selected&&(a.state.selected=!1,this._data.core.selected=h.vakata.array_remove_item(this._data.core.selected,a.id),f.length&&f.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:c}),b||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:c}))},select_all:function(a){var b=this._data.core.selected.concat([]),c,f;this._data.core.selected=this._model.data["#"].children_d.concat();c=0;for(f=this._data.core.selected.length;c<f;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:b})},deselect_all:function(a){var b=this._data.core.selected.concat([]),c,f;c=0;for(f=this._data.core.selected.length;c<f;c++)this._model.data[this._data.core.selected[c]]&&(this._model.data[this._data.core.selected[c]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked");this.trigger("deselect_all",{selected:this._data.core.selected,node:b});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.state.selected:!1},get_selected:function(a){return a?h.map(this._data.core.selected,h.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected},get_top_selected:function(a){var b=this.get_selected(!0),c={},f,d,e,g;f=0;for(d=b.length;f<d;f++)c[b[f].id]=b[f];f=0;for(d=b.length;f<d;f++)for(e=0,g=b[f].children_d.length;e<g;e++)c[b[f].children_d[e]]&&delete c[b[f].children_d[e]];b=[];for(f in c)c.hasOwnProperty(f)&&b.push(f);return a?h.map(b,h.proxy(function(a){return this.get_node(a)},this)):b},get_bottom_selected:function(a){var b=this.get_selected(!0),c=[],f,d;f=0;for(d=b.length;f<d;f++)b[f].children.length||c.push(b[f].id);return a?h.map(c,h.proxy(function(a){return this.get_node(a)},this)):c},get_state:function(){var a={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},b;for(b in this._model.data)this._model.data.hasOwnProperty(b)&&"#"!==b&&(this._model.data[b].state.opened&&a.core.open.push(b),this._model.data[b].state.selected&&a.core.selected.push(b));return a},set_state:function(a,b){if(a){if(a.core){var c,f,d,e;if(a.core.open){if(!h.isArray(a.core.open))return delete a.core.open,this.set_state(a,b),!1;c=!0;f=!1;d=this;h.each(a.core.open.concat([]),function(g,e){if(f=d.get_node(e))d.is_loaded(e)?(d.is_closed(e)&&d.open_node(e,!1,0),a&&a.core&&a.core.open&&h.vakata.array_remove_item(a.core.open,e)):(d.is_loading(e)||d.open_node(e,h.proxy(function(c,f){!f&&a&&a.core&&a.core.open&&h.vakata.array_remove_item(a.core.open,c.id);this.set_state(a,b)},d),0),c=!1)});c&&(delete a.core.open,this.set_state(a,b));return!1}if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==q&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==q&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,b),!1;if(a.core.selected)return e=this,this.deselect_all(),h.each(a.core.selected,function(a,c){e.select_node(c)}),delete a.core.selected,this.set_state(a,b),!1;if(h.isEmptyObject(a.core))return delete a.core,this.set_state(a,b),!1}return h.isEmptyObject(a)?(a=null,b&&b.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a){this._data.core.state=this.get_state();this._cnt=0;this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var b=this.get_container_ul()[0].className;a||this.element.html("\x3cul class\x3d'jstree-container-ul'\x3e\x3cli class\x3d'jstree-initial-node jstree-loading jstree-leaf jstree-last'\x3e\x3ci class\x3d'jstree-icon jstree-ocl'\x3e\x3c/i\x3e\x3ca class\x3d'jstree-anchor' href\x3d'#'\x3e\x3ci class\x3d'jstree-icon jstree-themeicon-hidden'\x3e\x3c/i\x3e"+this.get_string("Loading ...")+"\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e");this.load_node("#",function(a,f){f&&(this.get_container_ul()[0].className=b,this.set_state(h.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(a){a=this.get_node(a);if(!a||"#"===a.id)return!1;var b=[];this._data.core.selected.concat([]);!0===a.state.opened&&b.push(a.id);this.get_node(a,!0).find(".jstree-open").each(function(){b.push(this.id)});this._load_nodes(b,h.proxy(function(c){this.open_node(c,!1,0);this.select_node(this._data.core.selected);this.trigger("refresh_node",{node:a,nodes:c})},this))},set_id:function(a,b){a=this.get_node(a);if(!a||"#"===a.id)return!1;var c,f,d=this._model.data;b=b.toString();d[a.parent].children[h.inArray(a.id,d[a.parent].children)]=b;c=0;for(f=a.parents.length;c<f;c++)d[a.parents[c]].children_d[h.inArray(a.id,d[a.parents[c]].children_d)]=b;c=0;for(f=a.children.length;c<f;c++)d[a.children[c]].parent=b;c=0;for(f=a.children_d.length;c<f;c++)d[a.children_d[c]].parents[h.inArray(a.id,d[a.children_d[c]].parents)]=b;c=h.inArray(a.id,this._data.core.selected);-1!==c&&(this._data.core.selected[c]=b);(c=this.get_node(a.id,!0))&&c.attr("id",b);delete d[a.id];a.id=b;d[b]=a;return!0},get_text:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.text:!1},set_text:function(a,b){var c,f;if(h.isArray(a)){a=a.slice();c=0;for(f=a.length;c<f;c++)this.set_text(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;a.text=b;c=this.get_node(a,!0);c.length&&(c=c.children(".jstree-anchor:eq(0)"),f=c.children("I").clone(),c.html(b).prepend(f),this.trigger("set_text",{obj:a,text:b}));return!0},get_json:function(a,b,c){a=this.get_node(a||"#");if(!a)return!1;b&&b.flat&&!c&&(c=[]);var f={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:a.li_attr,a_attr:a.a_attr,state:{},data:b&&b.no_data?!1:a.data},d,e;b&&b.flat?f.parent=a.parent:f.children=[];if(!b||!b.no_state)for(d in a.state)a.state.hasOwnProperty(d)&&(f.state[d]=a.state[d]);b&&b.no_id&&(delete f.id,f.li_attr&&f.li_attr.id&&delete f.li_attr.id);b&&b.flat&&"#"!==a.id&&c.push(f);if(!b||!b.no_children)for(d=0,e=a.children.length;d<e;d++)b&&b.flat?this.get_json(a.children[d],b,c):f.children.push(this.get_json(a.children[d],b));return b&&b.flat?c:"#"===a.id?f.children:f},create_node:function(a,b,c,f,d){null===a&&(a="#");a=this.get_node(a);if(!a)return!1;c=c===q?"last":c;if(!c.toString().match(/^(before|after)$/)&&!d&&!this.is_loaded(a))return this.load_node(a,function(){this.create_node(a,b,c,f,!0)});b||(b={text:this.get_string("New node")});b.text===q&&(b.text=this.get_string("New node"));var e,g,m;"#"===a.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":d=this.get_node(a.parent);c=h.inArray(a.id,d.children);a=d;break;case "after":d=this.get_node(a.parent);c=h.inArray(a.id,d.children)+1;a=d;break;case "inside":case "first":c=0;break;case "last":c=a.children.length;break;default:c||(c=0)}c>a.children.length&&(c=a.children.length);b.id||(b.id=!0);if(!this.check("create_node",b,a,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;!0===b.id&&delete b.id;b=this._parse_model_from_json(b,a.id,a.parents.concat());if(!b)return!1;d=this.get_node(b);e=[];e.push(b);e=e.concat(d.children_d);this.trigger("model",{nodes:e,parent:a.id});a.children_d=a.children_d.concat(e);g=0;for(m=a.parents.length;g<m;g++)this._model.data[a.parents[g]].children_d=this._model.data[a.parents[g]].children_d.concat(e);b=d;d=[];g=0;for(m=a.children.length;g<m;g++)d[g>=c?g+1:g]=a.children[g];d[c]=b.id;a.children=d;this.redraw_node(a,!0);f&&f.call(this,this.get_node(b));this.trigger("create_node",{node:this.get_node(b),parent:a.id,position:c});return b.id},rename_node:function(a,b){var c,f;if(h.isArray(a)){a=a.slice();c=0;for(f=a.length;c<f;c++)this.rename_node(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;c=a.text;if(!this.check("rename_node",a,this.get_parent(a),b))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,b);this.trigger("rename_node",{node:a,text:b,old:c});return!0},delete_node:function(a){var b,c,f,d,e,g,m,k;if(h.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.delete_node(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;b=this.get_node(a.parent);c=h.inArray(a.id,b.children);k=!1;if(!this.check("delete_node",a,b,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;-1!==c&&(b.children=h.vakata.array_remove(b.children,c));f=a.children_d.concat([]);f.push(a.id);g=0;for(m=f.length;g<m;g++){d=0;for(e=a.parents.length;d<e;d++)c=h.inArray(f[g],this._model.data[a.parents[d]].children_d),-1!==c&&(this._model.data[a.parents[d]].children_d=h.vakata.array_remove(this._model.data[a.parents[d]].children_d,c));this._model.data[f[g]].state.selected&&(k=!0,c=h.inArray(f[g],this._data.core.selected),-1!==c&&(this._data.core.selected=h.vakata.array_remove(this._data.core.selected,c)))}this.trigger("delete_node",{node:a,parent:b.id});k&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:b.id});g=0;for(m=f.length;g<m;g++)delete this._model.data[f[g]];this.redraw_node(b,!0);return!0},check:function(a,b,c,f,d){b=b&&b.id?b:this.get_node(b);c=c&&c.id?c:this.get_node(c);var e=a.match(/^move_node|copy_node|create_node$/i)?c:b,g=this.settings.core.check_callback;if(!("move_node"!==a&&"copy_node"!==a||d&&d.is_multi||b.id!==c.id&&h.inArray(b.id,c.children)!==f&&-1===h.inArray(c.id,b.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:f,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1;e&&e.data&&(e=e.data);return e&&e.functions&&(!1===e.functions[a]||!0===e.functions[a])?(!1===e.functions[a]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})}),e.functions[a]):!1===g||h.isFunction(g)&&!1===g.call(this,a,b,c,f,d)||g&&!1===g[a]?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},move_node:function(a,b,c,f,d){var e,g,m,k,l,n,p,r,u;if(h.isArray(a)){a=a.reverse().slice();e=0;for(g=a.length;e<g;e++)this.move_node(a[e],b,c,f,d);return!0}a=a&&a.id?a:this.get_node(a);b=this.get_node(b);c=c===q?0:c;if(!b||!a||"#"===a.id)return!1;if(!c.toString().match(/^(before|after)$/)&&!d&&!this.is_loaded(b))return this.load_node(b,function(){this.move_node(a,b,c,f,!0)});e=(a.parent||"#").toString();g=c.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;m=a.instance?a.instance:this._model.data[a.id]?this:h.jstree.reference(a.id);if(!m||!m._id||this._id!==m._id)return this.copy_node(a,b,c,f,d)?(m&&m.delete_node(a),!0):!1;"#"===g.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":c=h.inArray(b.id,g.children);break;case "after":c=h.inArray(b.id,g.children)+1;break;case "inside":case "first":c=0;break;case "last":c=g.children.length;break;default:c||(c=0)}c>g.children.length&&(c=g.children.length);if(!this.check("move_node",a,g,c,{core:!0,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===g.id){d=g.children.concat();k=h.inArray(a.id,d);-1!==k&&(d=h.vakata.array_remove(d,k),c>k&&c--);k=[];l=0;for(n=d.length;l<n;l++)k[l>=c?l+1:l]=d[l];k[c]=a.id;g.children=k;this._node_changed(g.id);this.redraw("#"===g.id)}else{k=a.children_d.concat();k.push(a.id);l=0;for(n=a.parents.length;l<n;l++){d=[];u=m._model.data[a.parents[l]].children_d;p=0;for(r=u.length;p<r;p++)-1===h.inArray(u[p],k)&&d.push(u[p]);m._model.data[a.parents[l]].children_d=d}m._model.data[e].children=h.vakata.array_remove_item(m._model.data[e].children,a.id);l=0;for(n=g.parents.length;l<n;l++)this._model.data[g.parents[l]].children_d=this._model.data[g.parents[l]].children_d.concat(k);d=[];l=0;for(n=g.children.length;l<n;l++)d[l>=c?l+1:l]=g.children[l];d[c]=a.id;g.children=d;g.children_d.push(a.id);g.children_d=g.children_d.concat(a.children_d);a.parent=g.id;k=g.parents.concat();k.unshift(g.id);u=a.parents.length;a.parents=k;k=k.concat();l=0;for(n=a.children_d.length;l<n;l++)this._model.data[a.children_d[l]].parents=this._model.data[a.children_d[l]].parents.slice(0,-1*u),Array.prototype.push.apply(this._model.data[a.children_d[l]].parents,k);this._node_changed(e);this._node_changed(g.id);this.redraw("#"===e||"#"===g.id)}f&&f.call(this,a,g,c);this.trigger("move_node",{node:a,parent:g.id,position:c,old_parent:e,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id,old_instance:m,new_instance:this});return!0},copy_node:function(a,b,c,f,d){var e,g,m,k,l,n;if(h.isArray(a)){a=a.reverse().slice();e=0;for(g=a.length;e<g;e++)this.copy_node(a[e],b,c,f,d);return!0}a=a&&a.id?a:this.get_node(a);b=this.get_node(b);c=c===q?0:c;if(!b||!a||"#"===a.id)return!1;if(!c.toString().match(/^(before|after)$/)&&!d&&!this.is_loaded(b))return this.load_node(b,function(){this.copy_node(a,b,c,f,!0)});g=(a.parent||"#").toString();l=c.toString().match(/^(before|after)$/)&&"#"!==b.id?this.get_node(b.parent):b;n=a.instance?a.instance:this._model.data[a.id]?this:h.jstree.reference(a.id);"#"===l.id&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":c=h.inArray(b.id,l.children);break;case "after":c=h.inArray(b.id,l.children)+1;break;case "inside":case "first":c=0;break;case "last":c=l.children.length;break;default:c||(c=0)}c>l.children.length&&(c=l.children.length);if(!this.check("copy_node",a,l,c,{core:!0,is_multi:n&&n._id&&n._id!==this._id,is_foreign:!n||!n._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;m=n?n.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):a;if(!m)return!1;!0===m.id&&delete m.id;m=this._parse_model_from_json(m,l.id,l.parents.concat());if(!m)return!1;e=this.get_node(m);a&&a.state&&!1===a.state.loaded&&(e.state.loaded=!1);d=[];d.push(m);d=d.concat(e.children_d);this.trigger("model",{nodes:d,parent:l.id});m=0;for(k=l.parents.length;m<k;m++)this._model.data[l.parents[m]].children_d=this._model.data[l.parents[m]].children_d.concat(d);d=[];m=0;for(k=l.children.length;m<k;m++)d[m>=c?m+1:m]=l.children[m];d[c]=e.id;l.children=d;l.children_d.push(e.id);l.children_d=l.children_d.concat(e.children_d);this._node_changed(l.id);this.redraw("#"===l.id);f&&f.call(this,e,l,c);this.trigger("copy_node",{node:e,original:a,parent:l.id,position:c,old_parent:g,is_multi:n&&n._id&&n._id!==this._id,is_foreign:!n||!n._id,old_instance:n,new_instance:this});return e.id},cut:function(a){a||(a=this._data.core.selected.concat());h.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,f,d;f=0;for(d=a.length;f<d;f++)(c=this.get_node(a[f]))&&c.id&&"#"!==c.id&&b.push(c);if(!b.length)return!1;z=b;F=this;y="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());h.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,f,d;f=0;for(d=a.length;f<d;f++)(c=this.get_node(a[f]))&&c.id&&"#"!==c.id&&b.push(c);if(!b.length)return!1;z=b;F=this;y="copy_node";this.trigger("copy",{node:a})},get_buffer:function(){return{mode:y,node:z,inst:F}},can_paste:function(){return!1!==y&&!1!==z},paste:function(a,b){a=this.get_node(a);if(!(a&&y&&y.match(/^(copy_node|move_node)$/)&&z))return!1;this[y](z,a,b)&&this.trigger("paste",{parent:a.id,node:z,mode:y});F=y=z=!1},edit:function(a,b){a=this._open_to(a);if(!a||!a.length)return!1;var c=this._data.core.rtl,f=this.element.width(),d=a.children(".jstree-anchor"),e=h("\x3cspan\x3e"),g="string"===typeof b?b:this.get_text(a),m=h("\x3cdiv /\x3e",{css:{position:"absolute",top:"-200px",left:c?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),k=h("\x3cinput /\x3e",{value:g,"class":"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:h.proxy(function(){var c=e.children(".jstree-rename-input").val();""===c&&(c=g);m.remove();e.replaceWith(d);e.remove();this.set_text(a,g);!1===this.rename_node(a,c)&&this.set_text(a,g)},this),keydown:function(a){var c=a.which;27===c&&(this.value=g);27!==c&&13!==c&&37!==c&&38!==c&&39!==c&&40!==c&&32!==c||a.stopImmediatePropagation();if(27===c||13===c)a.preventDefault(),this.blur()},click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){k.width(Math.min(m.text("pW"+this.value).width(),f))},keypress:function(a){if(13===a.which)return!1}}),c={fontFamily:d.css("fontFamily")||"",fontSize:d.css("fontSize")||"",fontWeight:d.css("fontWeight")||"",fontStyle:d.css("fontStyle")||"",fontStretch:d.css("fontStretch")||"",fontVariant:d.css("fontVariant")||"",letterSpacing:d.css("letterSpacing")||"",wordSpacing:d.css("wordSpacing")||""};this.set_text(a,"");e.attr("class",d.attr("class")).append(d.contents().clone()).append(k);d.replaceWith(e);m.css(c);k.css(c).width(Math.min(m.text("pW"+k[0].value).width(),f))[0].select()},set_theme:function(a,b){if(!a)return!1;if(!0===b){var c=this.settings.core.themes.dir;c||(c=h.jstree.path+"/themes");b=c+"/"+a+"/style.css"}b&&-1===h.inArray(b,J)&&(h("head").append('\x3clink rel\x3d"stylesheet" href\x3d"'+b+'" type\x3d"text/css" /\x3e'),J.push(b));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(a,b){var c,f;if(h.isArray(a)){a=a.slice();c=0;for(f=a.length;c<f;c++)this.set_icon(a[c],b);return!0}a=this.get_node(a);if(!a||"#"===a.id)return!1;f=a.icon;a.icon=b;c=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");!1===b?this.hide_icon(a):!0===b?c.removeClass("jstree-themeicon-custom "+f).css("background","").removeAttr("rel"):-1===b.indexOf("/")&&-1===b.indexOf(".")?(c.removeClass(f).css("background",""),c.addClass(b+" jstree-themeicon-custom").attr("rel",b)):(c.removeClass(f).css("background",""),c.addClass("jstree-themeicon-custom").css("background","url('"+b+"') center center no-repeat").attr("rel",b));return!0},get_icon:function(a){return(a=this.get_node(a))&&"#"!==a.id?a.icon:!1},hide_icon:function(a){var b,c;if(h.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.hide_icon(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;a.icon=!1;this.get_node(a,!0).children("a").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var b,c;if(h.isArray(a)){a=a.slice();b=0;for(c=a.length;b<c;b++)this.show_icon(a[b]);return!0}a=this.get_node(a);if(!a||"#"===a)return!1;b=this.get_node(a,!0);a.icon=b.length?b.children("a").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);b.children("a").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return!0}};h.vakata={};h.vakata.attributes=function(a,b){a=h(a)[0];var c=b?{}:[];a&&a.attributes&&h.each(a.attributes,function(a,d){-1===h.inArray(d.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==d.nodeValue&&""!==h.trim(d.nodeValue)&&(b?c[d.nodeName]=d.nodeValue:c.push(d.nodeName))});return c};h.vakata.array_unique=function(a){var b=[],c,f,d;c=0;for(d=a.length;c<d;c++){for(f=0;f<=c&&a[c]!==a[f];f++);f===c&&b.push(a[c])}return b};h.vakata.array_remove=function(a,b,c){c=a.slice((c||b)+1||a.length);a.length=0>b?a.length+b:b;a.push.apply(a,c);return a};h.vakata.array_remove_item=function(a,b){var c=h.inArray(b,a);return-1!==c?h.vakata.array_remove(a,c):a};(function(){var a,b,c={};a=window.navigator.userAgent;a=a.toLowerCase();b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];a=b[1]||"";b=b[2]||"0";a&&(c[a]=!0,c.version=b);c.chrome?c.webkit=!0:c.webkit&&(c.safari=!0);h.vakata.browser=c})();h.vakata.browser.msie&&8>h.vakata.browser.version&&(h.jstree.defaults.core.animation=0);var K=document.createElement("I");K.className="jstree-icon jstree-checkbox";h.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0};h.jstree.plugins.checkbox=function(a,b){this.bind=function(){b.bind.call(this);this._data.checkbox.uto=!1;this.element.on("init.jstree",h.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked")},this)).on("loading.jstree",h.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(this.settings.checkbox.three_state)this.element.on("changed.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",h.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(h.proxy(this._undetermined,this),50)},this)).on("model.jstree",h.proxy(function(a,b){var d=this._model.data,e=d[b.parent],g=b.nodes,m=[],k,l,n,p;if(e.state.selected){k=0;for(l=g.length;k<l;k++)d[g[k]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(g)}else for(k=0,l=g.length;k<l;k++)if(d[g[k]].state.selected){n=0;for(p=d[g[k]].children_d.length;n<p;n++)d[d[g[k]].children_d[n]].state.selected=!0;this._data.core.selected=this._data.core.selected.concat(d[g[k]].children_d)}k=0;for(l=e.children_d.length;k<l;k++)d[e.children_d[k]].children.length||m.push(d[e.children_d[k]].parent);m=h.vakata.array_unique(m);n=0;for(p=m.length;n<p;n++)for(e=d[m[n]];e&&"#"!==e.id;){k=g=0;for(l=e.children.length;k<l;k++)g+=d[e.children[k]].state.selected;if(g===l)e.state.selected=!0,this._data.core.selected.push(e.id),(k=this.get_node(e,!0))&&k.length&&k.children(".jstree-anchor").addClass("jstree-clicked");else break;e=this.get_node(e.parent)}this._data.core.selected=h.vakata.array_unique(this._data.core.selected)},this)).on("select_node.jstree",h.proxy(function(a,b){var d=b.node,e=this._model.data,g=this.get_node(d.parent),m=this.get_node(d,!0),k,l,n;this._data.core.selected=h.vakata.array_unique(this._data.core.selected.concat(d.children_d));k=0;for(l=d.children_d.length;k<l;k++)n=e[d.children_d[k]],n.state.selected=!0,n&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1);for(;g&&"#"!==g.id;){k=d=0;for(l=g.children.length;k<l;k++)d+=e[g.children[k]].state.selected;if(d===l)g.state.selected=!0,this._data.core.selected.push(g.id),(n=this.get_node(g,!0))&&n.length&&n.children(".jstree-anchor").addClass("jstree-clicked");else break;g=this.get_node(g.parent)}m.length&&m.find(".jstree-anchor").addClass("jstree-clicked")},this)).on("deselect_all.jstree",h.proxy(function(a,b){var d=this.get_node("#"),e=this._model.data,g,h,k;g=0;for(h=d.children_d.length;g<h;g++)(k=e[d.children_d[g]])&&k.original&&k.original.state&&k.original.state.undetermined&&(k.original.state.undetermined=!1)},this)).on("deselect_node.jstree",h.proxy(function(a,b){var d=b.node,e=this.get_node(d,!0),g,m,k;d&&d.original&&d.original.state&&d.original.state.undetermined&&(d.original.state.undetermined=!1);g=0;for(m=d.children_d.length;g<m;g++)k=this._model.data[d.children_d[g]],k.state.selected=!1,k&&k.original&&k.original.state&&k.original.state.undetermined&&(k.original.state.undetermined=!1);g=0;for(m=d.parents.length;g<m;g++)k=this._model.data[d.parents[g]],k.state.selected=!1,k&&k.original&&k.original.state&&k.original.state.undetermined&&(k.original.state.undetermined=!1),(k=this.get_node(d.parents[g],!0))&&k.length&&k.children(".jstree-anchor").removeClass("jstree-clicked");k=[];g=0;for(m=this._data.core.selected.length;g<m;g++)-1===h.inArray(this._data.core.selected[g],d.children_d)&&-1===h.inArray(this._data.core.selected[g],d.parents)&&k.push(this._data.core.selected[g]);this._data.core.selected=h.vakata.array_unique(k);e.length&&e.find(".jstree-anchor").removeClass("jstree-clicked")},this)).on("delete_node.jstree",h.proxy(function(a,b){for(var d=this.get_node(b.parent),e=this._model.data,g,h,k;d&&"#"!==d.id;){g=k=0;for(h=d.children.length;g<h;g++)k+=e[d.children[g]].state.selected;if(k===h)d.state.selected=!0,this._data.core.selected.push(d.id),(g=this.get_node(d,!0))&&g.length&&g.children(".jstree-anchor").addClass("jstree-clicked");else break;d=this.get_node(d.parent)}},this)).on("move_node.jstree",h.proxy(function(a,b){var d=b.is_multi,e=b.old_parent,g=this.get_node(b.parent),m=this._model.data,k,l;if(!d)for(d=this.get_node(e);d&&"#"!==d.id;){k=e=0;for(l=d.children.length;k<l;k++)e+=m[d.children[k]].state.selected;if(e===l)d.state.selected=!0,this._data.core.selected.push(d.id),(e=this.get_node(d,!0))&&e.length&&e.children(".jstree-anchor").addClass("jstree-clicked");else break;d=this.get_node(d.parent)}for(d=g;d&&"#"!==d.id;){k=e=0;for(l=d.children.length;k<l;k++)e+=m[d.children[k]].state.selected;if(e===l)d.state.selected||(d.state.selected=!0,this._data.core.selected.push(d.id),(e=this.get_node(d,!0))&&e.length&&e.children(".jstree-anchor").addClass("jstree-clicked"));else if(d.state.selected)d.state.selected=!1,this._data.core.selected=h.vakata.array_remove_item(this._data.core.selected,d.id),(e=this.get_node(d,!0))&&e.length&&e.children(".jstree-anchor").removeClass("jstree-clicked");else break;d=this.get_node(d.parent)}},this))};this._undetermined=function(){var a,b,d=this._model.data,e=this._data.core.selected,g=[],m=this;a=0;for(b=e.length;a<b;a++)d[e[a]]&&d[e[a]].parents&&(g=g.concat(d[e[a]].parents));this.element.find(".jstree-closed").not(":has(ul)").each(function(){var e=m.get_node(this),h;if(e.state.loaded)for(a=0,b=e.children_d.length;a<b;a++)h=d[e.children_d[a]],!h.state.loaded&&h.original&&h.original.state&&h.original.state.undetermined&&!0===h.original.state.undetermined&&(g.push(h.id),g=g.concat(h.parents));else e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined&&(g.push(e.id),g=g.concat(e.parents))});g=h.vakata.array_unique(g);g=h.vakata.array_remove_item(g,"#");this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");a=0;for(b=g.length;a<b;a++)d[g[a]].state.selected||(e=this.get_node(g[a],!0))&&e.length&&e.children("a").children(".jstree-checkbox").addClass("jstree-undetermined")};this.redraw_node=function(a,f,d){if(a=b.redraw_node.call(this,a,f,d))f=a.getElementsByTagName("A")[0],f.insertBefore(K.cloneNode(!1),f.childNodes[0]);!d&&this.settings.checkbox.three_state&&(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(h.proxy(this._undetermined,this),50));return a};this.activate_node=function(a,f){if(this.settings.checkbox.whole_node||h(f.target).hasClass("jstree-checkbox"))f.ctrlKey=!0;return b.activate_node.call(this,a,f)};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.element.children("ul").removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.element.children("ul").addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()}};h.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,b){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(a){var b=h.jstree.reference(a.reference);a=b.get_node(a.reference);b.create_node(a,{},"last",function(a){setTimeout(function(){b.edit(a)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var b=h.jstree.reference(a.reference);a=b.get_node(a.reference);b.edit(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var b=h.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.delete_node(b.get_selected()):b.delete_node(a)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(a){var b=h.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.cut(b.get_selected()):b.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var b=h.jstree.reference(a.reference);a=b.get_node(a.reference);b.is_selected(a)?b.copy(b.get_selected()):b.copy(a)}},paste:{separator_before:!1,icon:!1,_disabled:function(a){return!h.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",action:function(a){var b=h.jstree.reference(a.reference);a=b.get_node(a.reference);b.paste(a)}}}}}}};h.jstree.plugins.contextmenu=function(a,b){this.bind=function(){b.bind.call(this);var a=0;this.element.on("contextmenu.jstree",".jstree-anchor",h.proxy(function(b){b.preventDefault();a=b.ctrlKey?b.timeStamp:0;this.is_loading(b.currentTarget)||this.show_contextmenu(b.currentTarget,b.pageX,b.pageY,b)},this)).on("click.jstree",".jstree-anchor",h.proxy(function(b){this._data.contextmenu.visible&&(!a||250<b.timeStamp-a)&&h.vakata.context.hide()},this));h(document).on("context_hide.vakata",h.proxy(function(){this._data.contextmenu.visible=!1},this))};this.teardown=function(){this._data.contextmenu.visible&&h.vakata.context.hide();b.teardown.call(this)};this.show_contextmenu=function(a,b,d,e){a=this.get_node(a);if(!a||"#"===a.id)return!1;var g=this.settings.contextmenu,m=this.get_node(a,!0).children(".jstree-anchor"),k=!1,k=!1;if(g.show_at_node||b===q||d===q)k=m.offset(),b=k.left,d=k.top+this._data.core.li_height;this.settings.contextmenu.select_node&&!this.is_selected(a)&&(this.deselect_all(),this.select_node(a,!1,!1,e));k=g.items;h.isFunction(k)&&(k=k.call(this,a,h.proxy(function(e){this._show_contextmenu(a,b,d,e)},this)));h.isPlainObject(k)&&this._show_contextmenu(a,b,d,k)};this._show_contextmenu=function(a,b,d,e){var g=this.get_node(a,!0).children(".jstree-anchor");h(document).one("context_show.vakata",h.proxy(function(a,c){var b="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";h(c.element).addClass(b)},this));this._data.contextmenu.visible=!0;h.vakata.context.show(g,{x:b,y:d},e);this.trigger("show_contextmenu",{node:a,x:b,y:d})}};(function(a){var b=!1,c=!1,f=!1,d=0,e=0,g=[],h="",k=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(document).triggerHandler("context_"+b+".vakata",{reference:f,element:c,position:{x:d,y:e}})},_execute:function(b){return(b=g[b])&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:f,element:c}))&&b.action?b.action.call(null,{item:b,reference:f,element:c,position:{x:d,y:e}}):!1},_parse:function(b,d){if(!b)return!1;d||(h="",g=[]);var e="",k=!1,u;d&&(e+="\x3cul\x3e");a.each(b,function(b,d){if(!d)return!0;g.push(d);!k&&d.separator_before&&(e+="\x3cli class\x3d'vakata-context-separator'\x3e\x3ca href\x3d'#' "+(a.vakata.context.settings.icons?"":'style\x3d"margin-left:0px;"')+"\x3e\x26#160;\x3c/a\x3e\x3c/li\x3e");k=!1;e+="\x3cli class\x3d'"+(d._class||"")+(!0===d._disabled||a.isFunction(d._disabled)&&d._disabled({item:d,reference:f,element:c})?" vakata-contextmenu-disabled ":"")+"' "+(d.shortcut?" data-shortcut\x3d'"+d.shortcut+"' ":"")+"\x3e";e+="\x3ca href\x3d'#' rel\x3d'"+(g.length-1)+"'\x3e";a.vakata.context.settings.icons&&(e+="\x3ci ",d.icon&&(e=-1!==d.icon.indexOf("/")||-1!==d.icon.indexOf(".")?e+(" style\x3d'background:url(\""+d.icon+"\") center center no-repeat' "):e+(" class\x3d'"+d.icon+"' ")),e+="\x3e\x3c/i\x3e\x3cspan class\x3d'vakata-contextmenu-sep'\x3e\x26#160;\x3c/span\x3e");e+=(a.isFunction(d.label)?d.label({item:b,reference:f,element:c}):d.label)+(d.shortcut?' \x3cspan class\x3d"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+d.shortcut+'"\x3e'+(d.shortcut_label||"")+"\x3c/span\x3e":"")+"\x3c/a\x3e";d.submenu&&(u=a.vakata.context._parse(d.submenu,!0))&&(e+=u);e+="\x3c/li\x3e";d.separator_after&&(e+="\x3cli class\x3d'vakata-context-separator'\x3e\x3ca href\x3d'#' "+(a.vakata.context.settings.icons?"":'style\x3d"margin-left:0px;"')+"\x3e\x26#160;\x3c/a\x3e\x3c/li\x3e",k=!0)});e=e.replace(/<li class\='vakata-context-separator'\><\/li\>$/,"");d&&(e+="\x3c/ul\x3e");d||(h=e,a.vakata.context._trigger("parse"));return 10<e.length?e:!1},_show_submenu:function(c){c=a(c);if(c.length&&c.children("ul").length){var d=c.children("ul"),f=c.offset().left+c.outerWidth(),e=c.offset().top,g=d.width(),h=d.height(),m=a(window).width()+a(window).scrollLeft(),k=a(window).height()+a(window).scrollTop();if(b)c[0>f-(g+10+c.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else c[f+g+10>m?"addClass":"removeClass"]("vakata-context-right");e+h+10>k&&d.css("bottom","-1px");d.show()}},show:function(l,n,p){var r,u,D,q;c&&c.length&&c.width("");switch(!0){case !n&&!l:return!1;case !!n&&!!l:f=l;d=n.x;e=n.y;break;case !n&&!!l:f=l;n=l.offset();d=n.left+l.outerHeight();e=n.top;break;case !!n&&!l:d=n.x,e=n.y}l&&!p&&a(l).data("vakata_contextmenu")&&(p=a(l).data("vakata_contextmenu"));a.vakata.context._parse(p)&&c.html(h);g.length&&(l=c,p=d,n=e,r=l.width(),u=l.height(),D=a(window).width()+a(window).scrollLeft(),q=a(window).height()+a(window).scrollTop(),b&&(p-=l.outerWidth(),p<a(window).scrollLeft()+20&&(p=a(window).scrollLeft()+20)),p+r+20>D&&(p=D-(r+20)),n+u+20>q&&(n=q-(u+20)),c.css({left:p,top:n}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),k=!0,a.vakata.context._trigger("show"))},hide:function(){k&&(c.hide().find("ul").hide().end().find(":focus").blur(),k=!1,a.vakata.context._trigger("hide"))}};a(function(){b="rtl"===a("body").css("direction");var d=!1;c=a("\x3cul class\x3d'vakata-context'\x3e\x3c/ul\x3e");c.on("mouseenter","li",function(b){b.stopImmediatePropagation();a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(c){a.contains(this,c.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(c){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(c){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(a){a.preventDefault()}).on("mouseup","a",function(c){a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(b){var d;switch(b.which){case 13:case 32:b.type="mouseup";b.preventDefault();a(b.currentTarget).trigger(b);break;case 37:k&&(c.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 38:k&&(d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 39:k&&(c.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 40:k&&(d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",function(a){a.preventDefault();a=c.find(".vakata-contextmenu-shortcut-"+a.which).parent();a.parent().not(".vakata-context-disabled")&&a.mouseup()}).appendTo("body");a(document).on("mousedown",function(b){k&&!a.contains(c[0],b.target)&&a.vakata.context.hide()}).on("context_show.vakata",function(a,d){c.find("li:has(ul)").children("a").addClass("vakata-context-parent");b&&c.addClass("vakata-context-rtl").css("direction","rtl");c.find("ul").hide().end()})})})(h);h.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1};h.jstree.plugins.dnd=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",h.proxy(function(a){var b=this.get_node(a.target),d=this.is_selected(b)?this.get_selected().length:1;if(b&&b.id&&"#"!==b.id&&(1===a.which||"touchstart"===a.type)&&(!0===this.settings.dnd.is_draggable||h.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<d?this.get_selected(!0):[b])))return this.element.trigger("mousedown.jstree"),h.vakata.dnd.start(a,{jstree:!0,origin:this,obj:this.get_node(b,!0),nodes:1<d?this.get_selected():[b.id]},'\x3cdiv id\x3d"jstree-dnd" class\x3d"jstree-'+this.get_theme()+'"\x3e\x3ci class\x3d"jstree-icon jstree-er"\x3e\x3c/i\x3e'+(1<d?d+" "+this.get_string("nodes"):this.get_text(a.currentTarget,!0))+'\x3cins class\x3d"jstree-copy" style\x3d"display:none;"\x3e+\x3c/ins\x3e\x3c/div\x3e')},this))}};h(function(){var a=!1,b=!1,c=!1,f=h('\x3cdiv id\x3d"jstree-marker"\x3e\x26#160;\x3c/div\x3e').hide().appendTo("body");h(document).bind("dnd_start.vakata",function(c,b){a=!1}).bind("dnd_move.vakata",function(d,e){c&&clearTimeout(c);if(e.data.jstree&&(!e.event.target.id||"jstree-marker"!==e.event.target.id)){var g=h.jstree.reference(e.event.target),m=!1,k=!1,l=!1,n,p,r,u,D,q,x,t,w,v,B,L;if(g&&g._data&&g._data.dnd)if(f.attr("class","jstree-"+g.get_theme()),e.helper.children().attr("class","jstree-"+g.get_theme()).find(".jstree-copy:eq(0)")[e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"show":"hide"](),e.event.target!==g.element[0]&&e.event.target!==g.get_container_ul()[0]||0!==g.get_container_ul().children().length){if((m=h(e.event.target).closest("a"))&&m.length&&m.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(k=m.offset(),l=e.event.pageY-k.top,r=m.height(),q=l<r/3?["b","i","a"]:l>r-r/3?["a","i","b"]:l>r/2?["i","a","b"]:["i","b","a"],h.each(q,function(d,l){switch(l){case "b":n=k.left-6;p=k.top-5;u=g.get_parent(m);D=m.parent().index();break;case "i":n=k.left-2;p=k.top-5+r/2+1;u=g.get_node(m.parent()).id;D=0;break;case "a":n=k.left-6,p=k.top-5+r,u=g.get_parent(m),D=m.parent().index()+1}x=!0;t=0;for(w=e.data.nodes.length;t<w;t++)if(v=e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"copy_node":"move_node",B=D,"move_node"===v&&"a"===l&&e.data.origin&&e.data.origin===g&&u===g.get_parent(e.data.nodes[t])&&(L=g.get_node(u),B>h.inArray(e.data.nodes[t],L.children)&&--B),x=x&&(g&&g.settings&&g.settings.dnd&&!1===g.settings.dnd.check_while_dragging||g.check(v,e.data.origin&&e.data.origin!==g?e.data.origin.get_node(e.data.nodes[t]):e.data.nodes[t],u,B,{dnd:!0,ref:g.get_node(m.parent()),pos:l,is_multi:e.data.origin&&e.data.origin!==g,is_foreign:!e.data.origin})),!x){g&&g.last_error&&(b=g.last_error());break}if(x)return"i"===l&&m.parent().is(".jstree-closed")&&g.settings.dnd.open_timeout&&(c=setTimeout(function(a,c){return function(){a.open_node(c)}}(g,m),g.settings.dnd.open_timeout)),a={ins:g,par:u,pos:D},f.css({left:n+"px",top:p+"px"}).show(),e.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),b={},q=!0,!1}),!0===q))return}else{x=!0;t=0;for(w=e.data.nodes.length;t<w&&(x=x&&g.check(e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"copy_node":"move_node",e.data.origin&&e.data.origin!==g?e.data.origin.get_node(e.data.nodes[t]):e.data.nodes[t],"#","last",{dnd:!0,ref:g.get_node("#"),pos:"i",is_multi:e.data.origin&&e.data.origin!==g,is_foreign:!e.data.origin}),x);t++);if(x){a={ins:g,par:"#",pos:"last"};f.hide();e.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok");return}}a=!1;e.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");f.hide()}}).bind("dnd_scroll.vakata",function(c,b){b.data.jstree&&(f.hide(),a=!1,b.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(d,e){c&&clearTimeout(c);if(e.data.jstree){f.hide();var g,m,k=[];if(a){g=0;for(m=e.data.nodes.length;g<m;g++)k[g]=e.data.origin?e.data.origin.get_node(e.data.nodes[g]):e.data.nodes[g],e.data.origin&&(k[g].instance=e.data.origin);a.ins[e.data.origin&&(e.data.origin.settings.dnd.always_copy||e.data.origin.settings.dnd.copy&&(e.event.metaKey||e.event.ctrlKey))?"copy_node":"move_node"](k,a.par,a.pos)}else g=h(e.event.target).closest(".jstree"),g.length&&b&&b.error&&"check"===b.error&&(g=g.jstree(!0))&&g.settings.core.error.call(this,b)}}).bind("keyup keydown",function(a,c){c=h.vakata.dnd._get();if(c.data&&c.data.jstree)c.helper.find(".jstree-copy:eq(0)")[c.data.origin&&(c.data.origin.settings.dnd.always_copy||c.data.origin.settings.dnd.copy&&(a.metaKey||a.ctrlKey))?"show":"hide"]()})});(function(a){var b=!1,c=!1,f=!1,d=!1,e=0,g=!1,h=0,k=0,l=0,n=0,p=!1,r=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5},_trigger:function(c,b){var d=a.vakata.dnd._get();d.event=b;a(document).triggerHandler("dnd_"+c+".vakata",d)},_get:function(){return{data:g,element:b,helper:d}},_clean:function(){d&&d.remove();r&&(clearInterval(r),r=!1);d=f=c=b=!1;e=0;g=!1;n=l=k=h=0;r=p=!1;a(document).off("mousemove touchmove",a.vakata.dnd.drag);a(document).off("mouseup touchend",a.vakata.dnd.stop)},_scroll:function(c){if(!p||!l&&!n)return r&&(clearInterval(r),r=!1),!1;if(!r)return r=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===c)return!1;c=p.scrollTop();var b=p.scrollLeft();p.scrollTop(c+n*a.vakata.dnd.settings.scroll_speed);p.scrollLeft(b+l*a.vakata.dnd.settings.scroll_speed);c===p.scrollTop()&&b===p.scrollLeft()||a.vakata.dnd._trigger("scroll",p)},start:function(e,l,n){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.target=document.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset));f&&a.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.MozUserSelect="none")}catch(p){}h=e.pageX;k=e.pageY;g=l;c=!0;b=e.currentTarget;!1!==n&&(d=a("\x3cdiv id\x3d'vakata-dnd'\x3e\x3c/div\x3e").html(n).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(document).bind("mousemove touchmove",a.vakata.dnd.drag);a(document).bind("mouseup touchend",a.vakata.dnd.stop);return!1},drag:function(b){"touchmove"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,b.target=document.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(c){if(!f)if(Math.abs(b.pageX-h)>a.vakata.dnd.settings.threshold||Math.abs(b.pageY-k)>a.vakata.dnd.settings.threshold)d&&(d.appendTo("body"),e=d.outerWidth()),f=!0,a.vakata.dnd._trigger("start",b);else return;var g=!1,r=!1,q=!1,t=!1,w=!1,v=r=!1,B=!1,t=g=!1;l=n=0;p=!1;a(a(b.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var c=a(this),d=c.offset();this.scrollHeight>this.offsetHeight&&(d.top+c.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(n=1),b.pageY-d.top<a.vakata.dnd.settings.scroll_proximity&&(n=-1));this.scrollWidth>this.offsetWidth&&(d.left+c.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(l=1),b.pageX-d.left<a.vakata.dnd.settings.scroll_proximity&&(l=-1));if(n||l)return p=a(this),!1});!p&&(g=a(document),r=a(window),q=g.height(),t=r.height(),w=g.width(),r=r.width(),v=g.scrollTop(),B=g.scrollLeft(),q>t&&b.pageY-v<a.vakata.dnd.settings.scroll_proximity&&(n=-1),q>t&&t-(b.pageY-v)<a.vakata.dnd.settings.scroll_proximity&&(n=1),w>r&&b.pageX-B<a.vakata.dnd.settings.scroll_proximity&&(l=-1),w>r&&r-(b.pageX-B)<a.vakata.dnd.settings.scroll_proximity&&(l=1),n||l)&&(p=g);p&&a.vakata.dnd._scroll(!0);d&&(g=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),t=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),q&&g+25>q&&(g=q-50),w&&t+e>w&&(t=w-(e+2)),d.css({left:t+"px",top:g+"px"}));a.vakata.dnd._trigger("move",b)}},stop:function(c){"touchend"===c.type&&c.originalEvent&&c.originalEvent.changedTouches&&c.originalEvent.changedTouches[0]&&(c.pageX=c.originalEvent.changedTouches[0].pageX,c.pageY=c.originalEvent.changedTouches[0].pageY,c.target=document.elementFromPoint(c.originalEvent.changedTouches[0].pageX-window.pageXOffset,c.originalEvent.changedTouches[0].pageY-window.pageYOffset));f&&a.vakata.dnd._trigger("stop",c);a.vakata.dnd._clean()}}})(jQuery);h.jstree.defaults.search={ajax:!1,fuzzy:!0,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1};h.jstree.plugins.search=function(a,b){this.bind=function(){b.bind.call(this);this._data.search.str="";this._data.search.dom=h();this._data.search.res=[];this._data.search.opn=[];this.element.on("before_open.jstree",h.proxy(function(a,b){var d,e,g,m=this._data.search.res,k=[],l=h();if(m&&m.length){this._data.search.dom=h();d=0;for(e=m.length;d<e;d++)if(k=k.concat(this.get_node(m[d]).parents),g=this.get_node(m[d],!0))this._data.search.dom=this._data.search.dom.add(g);k=h.vakata.array_unique(k);d=0;for(e=k.length;d<e;d++)"#"!==k[d]&&(g=this.get_node(k[d],!0))&&(l=l.add(g));this._data.search.dom.children(".jstree-anchor").addClass("jstree-search");this.settings.search.show_only_matches&&this._data.search.res.length&&(this.element.find("li").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),l=l.add(this._data.search.dom),l.parentsUntil(".jstree").addBack().show().filter("ul").each(function(){h(this).children("li:visible").eq(-1).addClass("jstree-last")}))}},this));if(this.settings.search.show_only_matches)this.element.on("search.jstree",function(a,b){b.nodes.length&&(h(this).find("li").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),b.nodes.parentsUntil(".jstree").addBack().show().filter("ul").each(function(){h(this).children("li:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(a,b){b.nodes.length&&h(this).find("li").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})};this.search=function(a,b){if(!1===a||""===h.trim(a))return this.clear_search();var d=this.settings.search,e=d.ajax?d.ajax:!1,g=null,m=[],k=[],l,n;this._data.search.res.length&&this.clear_search();if(!b&&!1!==e){if(h.isFunction(e))return e.call(this,a,h.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(h.isArray(b)?b:[],function(){this.search(a,!0)})},this));e=h.extend({},e);e.data||(e.data={});e.data.str=a;return h.ajax(e).fail(h.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(e)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(h.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(h.isArray(b)?b:[],function(){this.search(a,!0)})},this))}this._data.search.str=a;this._data.search.dom=h();this._data.search.res=[];this._data.search.opn=[];g=new h.vakata.search(a,!0,{caseSensitive:d.case_sensitive,fuzzy:d.fuzzy});h.each(this._model.data,function(a,c){c.text&&g.search(c.text).isMatch&&(!d.search_leaves_only||c.state.loaded&&0===c.children.length)&&(m.push(a),k=k.concat(c.parents))});if(m.length){k=h.vakata.array_unique(k);this._search_open(k);l=0;for(n=m.length;l<n;l++)if(g=this.get_node(m[l],!0))this._data.search.dom=this._data.search.dom.add(g);this._data.search.res=m;this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:a,res:this._data.search.res})};this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search");this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=h()};this._search_open=function(a){var b=this;h.each(a.concat([]),function(d,e){if("#"===e)return!0;try{e=h("#"+e.replace(h.jstree.idregex,"\\$\x26"),b.element)}catch(g){}e&&e.length&&b.is_closed(e)&&(b._data.search.opn.push(e[0].id),b.open_node(e,function(){b._search_open(a)},0))})}};(function(a){a.vakata.search=function(a,c,f){f=f||{};!1!==f.fuzzy&&(f.fuzzy=!0);a=f.caseSensitive?a:a.toLowerCase();var d=f.location||0,e=f.distance||100,g=f.threshold||.6,h=a.length,k,l,n,p;32<h&&(f.fuzzy=!1);f.fuzzy&&(k=1<<h-1,l=function(){var c={},d;for(d=0;d<h;d++)c[a.charAt(d)]=0;for(d=0;d<h;d++)c[a.charAt(d)]|=1<<h-d-1;return c}(),n=function(a,c){var b=a/h,f=Math.abs(d-c);return e?b+f/e:f?1:b});p=function(c){c=f.caseSensitive?c:c.toLowerCase();if(a===c||-1!==c.indexOf(a))return{isMatch:!0,score:0};if(!f.fuzzy)return{isMatch:!1,score:1};var e,p,q=c.length,x=g,t=c.indexOf(a,d),w,v,B=h+q,y,A,z=1,C=[];-1!==t&&(x=Math.min(n(0,t),x),t=c.lastIndexOf(a,d+h),-1!==t&&(x=Math.min(n(0,t),x)));t=-1;for(e=0;e<h;e++){w=0;for(v=B;w<v;)n(e,d+v)<=x?w=v:B=v,v=Math.floor((B-w)/2+w);B=v;w=Math.max(1,d-v+1);p=Math.min(d+v,q)+h;v=Array(p+2);for(v[p+1]=(1<<e)-1;p>=w;p--)if(A=l[c.charAt(p-1)],v[p]=0===e?(v[p+1]<<1|1)&A:(v[p+1]<<1|1)&A|(y[p+1]|y[p])<<1|1|y[p+1],v[p]&k&&(z=n(e,p-1),z<=x))if(x=z,t=p-1,C.push(t),t>d)w=Math.max(1,2*d-t);else break;if(n(e+1,d)>x)break;y=v}return{isMatch:0<=t,score:z}};return!0===c?{search:p}:p(c)}})(jQuery);h.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1};h.jstree.plugins.sort=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("model.jstree",h.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",h.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1);this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",h.proxy(function(a,b){this.sort(b.parent,!1);this.redraw_node(b.parent,!0)},this))};this.sort=function(a,b){var d,e;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(h.proxy(this.settings.sort,this)),b))for(d=0,e=a.children_d.length;d<e;d++)this.sort(a.children_d[d],!1)}};var I=!1;h.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1};h.jstree.plugins.state=function(a,b){this.bind=function(){b.bind.call(this);var a=h.proxy(function(){this.element.on(this.settings.state.events,h.proxy(function(){I&&clearTimeout(I);I=setTimeout(h.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",h.proxy(function(b,d){this.element.one("restore_state.jstree",a);this.restore_state()||a()},this))};this.save_state=function(){var a={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};h.vakata.storage.set(this.settings.state.key,JSON.stringify(a))};this.restore_state=function(){var a=h.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(b){return!1}if(a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl)return!1;a&&a.state&&(a=a.state);a&&h.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a));return a?(this.element.one("set_state.jstree",function(b,d){d.instance.trigger("restore_state",{state:h.extend(!0,{},a)})}),this.set_state(a),!0):!1};this.clear_state=function(){return h.vakata.storage.del(this.settings.state.key)}};(function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}})(jQuery);h.jstree.defaults.types={"#":{},"default":{}};h.jstree.plugins.types=function(a,b){this.init=function(a,f){var d,e;if(f&&f.types&&f.types["default"])for(d in f.types)if("default"!==d&&"#"!==d&&f.types.hasOwnProperty(d))for(e in f.types["default"])f.types["default"].hasOwnProperty(e)&&f.types[d][e]===q&&(f.types[d][e]=f.types["default"][e]);b.init.call(this,a,f);this._model.data["#"].type="#"};this.refresh=function(a){b.refresh.call(this,a);this._model.data["#"].type="#"};this.bind=function(){this.element.on("model.jstree",h.proxy(function(a,b){var d=this._model.data,e=b.nodes,g=this.settings.types,h,k,l;h=0;for(k=e.length;h<k;h++)l="default",d[e[h]].original&&d[e[h]].original.type&&g[d[e[h]].original.type]&&(l=d[e[h]].original.type),d[e[h]].data&&d[e[h]].data.jstree&&d[e[h]].data.jstree.type&&g[d[e[h]].data.jstree.type]&&(l=d[e[h]].data.jstree.type),d[e[h]].type=l,!0===d[e[h]].icon&&g[l].icon!==q&&(d[e[h]].icon=g[l].icon)},this));b.bind.call(this)};this.get_json=function(a,f,d){var e=this._model.data,g=f?h.extend(!0,{},f,{no_id:!1}):{},g=b.get_json.call(this,a,g,d);if(!1===g)return!1;if(h.isArray(g))for(a=0,d=g.length;a<d;a++)g[a].type=g[a].id&&e[g[a].id]&&e[g[a].id].type?e[g[a].id].type:"default",f&&f.no_id&&(delete g[a].id,g[a].li_attr&&g[a].li_attr.id&&delete g[a].li_attr.id);else g.type=g.id&&e[g.id]&&e[g.id].type?e[g.id].type:"default",f&&f.no_id&&(g=this._delete_ids(g));return g};this._delete_ids=function(a){if(h.isArray(a)){for(var b=0,d=a.length;b<d;b++)a[b]=this._delete_ids(a[b]);return a}delete a.id;a.li_attr&&a.li_attr.id&&delete a.li_attr.id;a.children&&h.isArray(a.children)&&(a.children=this._delete_ids(a.children));return a};this.check=function(a,f,d,e,g){if(!1===b.check.call(this,a,f,d,e,g))return!1;f=f&&f.id?f:this.get_node(f);d=d&&d.id?d:this.get_node(d);g=f&&f.id?h.jstree.reference(f.id):null;var m,k,l,n;g=g&&g._model&&g._model.data?g._model.data:null;switch(a){case "create_node":case "move_node":case "copy_node":if("move_node"!==a||-1===h.inArray(f.id,d.children)){m=this.get_rules(d);if(m.max_children!==q&&-1!==m.max_children&&m.max_children===d.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:f&&f.id?f.id:!1,par:d&&d.id?d.id:!1})},!1;if(m.valid_children!==q&&-1!==m.valid_children&&-1===h.inArray(f.type,m.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:f&&f.id?f.id:!1,par:d&&d.id?d.id:!1})},!1;if(g&&f.children_d&&f.parents){l=k=0;for(n=f.children_d.length;l<n;l++)k=Math.max(k,g[f.children_d[l]].parents.length);k=k-f.parents.length+1}if(0>=k||k===q)k=1;do{if(m.max_depth!==q&&-1!==m.max_depth&&m.max_depth<k)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:f&&f.id?f.id:!1,par:d&&d.id?d.id:!1})},!1;d=this.get_node(d.parent);m=this.get_rules(d);k++}while(d)}}return!0};this.get_rules=function(a){a=this.get_node(a);if(!a)return!1;a=this.get_type(a,!0);a.max_depth===q&&(a.max_depth=-1);a.max_children===q&&(a.max_children=-1);a.valid_children===q&&(a.valid_children=-1);return a};this.get_type=function(a,b){return(a=this.get_node(a))?b?h.extend({type:a.type},this.settings.types[a.type]):a.type:!1};this.set_type=function(a,b){var d,e,g;if(h.isArray(a)){a=a.slice();d=0;for(e=a.length;d<e;d++)this.set_type(a[d],b);return!0}d=this.settings.types;a=this.get_node(a);if(!d[b]||!a)return!1;e=a.type;g=this.get_icon(a);a.type=b;(!0===g||d[e]&&d[e].icon&&g===d[e].icon)&&this.set_icon(a,d[b].icon!==q?d[b].icon:!0);return!0}};h.jstree.plugins.unique=function(a,b){this.check=function(a,f,d,e,g){if(!1===b.check.call(this,a,f,d,e,g))return!1;f=f&&f.id?f:this.get_node(f);d=d&&d.id?d:this.get_node(d);if(!d||!d.children)return!0;g="rename_node"===a?e:f.text;var m=[],k=this._model.data,l,n;l=0;for(n=d.children.length;l<n;l++)m.push(k[d.children[l]].text);switch(a){case "rename_node":case "copy_node":return l=-1===h.inArray(g,m),l||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+g+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:e,obj:f&&f.id?f.id:!1,par:d&&d.id?d.id:!1})}),l;case "move_node":return l=f.parent===d.id||-1===h.inArray(g,m),l||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+g+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:e,obj:f&&f.id?f.id:!1,par:d&&d.id?d.id:!1})}),l}return!0}};var E=document.createElement("DIV");E.setAttribute("unselectable","on");E.className="jstree-wholerow";E.innerHTML="\x26#160;";h.jstree.plugins.wholerow=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("loading",h.proxy(function(){E.style.height=this._data.core.li_height+"px"},this)).on("ready.jstree set_state.jstree",h.proxy(function(){this.hide_dots()},this)).on("ready.jstree",h.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",h.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",h.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var d,e,g;e=0;for(g=b.selected.length;e<g;e++)(d=this.get_node(b.selected[e],!0))&&d.length&&d.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",h.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",h.proxy(function(a,b){this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",h.proxy(function(a){a.preventDefault();var b=h.Event("contextmenu",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});h(a.currentTarget).closest("li").children("a:eq(0)").trigger(b)},this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=h.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});h(a.currentTarget).closest("li").children("a:eq(0)").trigger(b).focus()}).on("click.jstree",".jstree-leaf \x3e .jstree-ocl",h.proxy(function(a){a.stopImmediatePropagation();var b=h.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});h(a.currentTarget).closest("li").children("a:eq(0)").trigger(b).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",h.proxy(function(a){a.stopImmediatePropagation();this.hover_node(a.currentTarget);return!1},this)).on("mouseleave.jstree",".jstree-node",h.proxy(function(a){this.dehover_node(a.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();b.teardown.call(this)};this.redraw_node=function(a,f,d){if(a=b.redraw_node.call(this,a,f,d))f=E.cloneNode(!0),-1!==h.inArray(a.id,this._data.core.selected)&&(f.className+=" jstree-wholerow-clicked"),a.insertBefore(f,a.childNodes[0]);return a}}});
</script>